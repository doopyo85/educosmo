<!-- í•™ìƒ ê´€ë¦¬ í˜ì´ì§€ -->
<link rel="stylesheet" href="/css/teacher/student-management.css">

<div class="student-management-page">
    <!-- Compact Header -->
    <div class="compact-header">
        <div class="page-branding">
            <h3 class="page-title">í•™ìƒ ê´€ë¦¬</h3>

            <div class="header-tabs">
                <ul class="nav nav-tabs" id="studentTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="progress-tab" data-bs-toggle="tab"
                            data-bs-target="#student-progress" type="button" role="tab">
                            <i class="bi bi-graph-up-arrow"></i>í•™ìŠµ ì§„ë„
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="list-tab" data-bs-toggle="tab" data-bs-target="#student-list"
                            type="button" role="tab">
                            <i class="bi bi-people-fill"></i>í•™ìƒ ëª©ë¡
                        </button>
                    </li>
                </ul>
            </div>
        </div>

        <div class="header-controls">
            <!-- Search Inputs (Toggled via JS) -->
            <div class="search-wrapper" id="progressSearchWrapper">
                <i class="bi bi-search search-icon"></i>
                <input type="text" id="progressSearch" class="form-control" placeholder="í•™ìƒ ì´ë¦„/ì•„ì´ë”” ê²€ìƒ‰..." />
            </div>

            <div class="search-wrapper" id="studentSearchWrapper" style="display: none;">
                <i class="bi bi-search search-icon"></i>
                <input type="text" id="studentSearch" class="form-control" placeholder="í•™ìƒ ì´ë¦„/ì•„ì´ë”” ê²€ìƒ‰..." />
            </div>

            <!-- Add Button (Only visible on list tab) -->
            <button class="btn btn-primary rounded-pill btn-sm px-3" id="addStudentBtn" style="display: none;">
                <i class="bi bi-person-plus me-1"></i> ì¶”ê°€
            </button>
        </div>
    </div>

    <!-- íƒ­ ì½˜í…ì¸  -->
    <div class="tab-content" id="studentTabContent">
        <!-- í•™ìŠµ ì§„ë„ íƒ­ -->
        <div class="tab-pane fade show active" id="student-progress" role="tabpanel">
            <!-- ì§„ë„í‘œ í…Œì´ë¸” -->
            <div class="content-card">
                <div class="table-responsive">
                    <table class="premium-table">
                        <thead>
                            <tr>
                                <th>í”„ë¡œí•„</th>
                                <th>CT</th>
                                <th>ì´ë¦„</th>
                                <th>ì•„ì´ë””</th>
                                <th>í˜„ì¬ í”Œë«í¼</th>
                                <th>ì§„ë„ìœ¨</th>
                                <th>ì™„ë£Œ ìˆ˜ / ì „ì²´</th>
                                <th>ìŠ¤í† ë¦¬ì§€</th>
                                <th>ìµœê·¼ í•™ìŠµì¼</th>
                            </tr>
                        </thead>
                        <tbody id="progressTableBody">
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- í•™ìƒ ëª©ë¡ íƒ­ -->
        <div class="tab-pane fade" id="student-list" role="tabpanel">
            <!-- í•™ìƒ ëª©ë¡ í…Œì´ë¸” -->
            <div class="content-card">
                <div class="table-responsive">
                    <table class="premium-table" id="studentTable">
                        <thead>
                            <tr>
                                <th width="80px">í”„ë¡œí•„</th>
                                <th>ì´ë¦„</th>
                                <th>ì•„ì´ë””</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ê°€ì…ì¼</th>
                                <th>ìµœê·¼ ì ‘ì†</th>
                                <th width="120px">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="studentTableBody">
                            <!-- ë™ì  ìƒì„± -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- í•™ìƒ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal fade" id="studentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">í•™ìƒ ì¶”ê°€</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="studentForm">
                    <input type="hidden" id="studentId">

                    <div class="mb-3">
                        <label class="form-label">ì•„ì´ë”” <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="userID" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ì´ë¦„ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="name" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ì´ë©”ì¼</label>
                        <input type="email" class="form-control" id="email">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ë¹„ë°€ë²ˆí˜¸ <small class="text-muted">(ìˆ˜ì • ì‹œ ê³µë€ì´ë©´ ë³€ê²½ ì•ˆ í•¨)</small></label>
                        <input type="password" class="form-control" id="password">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" class="form-control" id="phone">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ìƒë…„ì›”ì¼</label>
                        <input type="date" class="form-control" id="birthdate">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                <button type="button" class="btn btn-primary" id="saveStudentBtn">ì €ì¥</button>
            </div>
        </div>
    </div>
</div>

<!-- ğŸ”¥ S3 íŒŒì¼ ë¸Œë¼ìš°ì € ëª¨ë‹¬ -->
<div class="modal fade" id="s3BrowserModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-body p-0">
                <iframe id="s3BrowserFrame" src="" style="width: 100%; height: 100%; border: none;" frameborder="0">
                </iframe>
            </div>
        </div>
    </div>
</div>

<!-- ğŸ”¥ S3 ëª¨ë‹¬ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    // í•™ìƒ S3 í´ë” ì—´ê¸° í•¨ìˆ˜
    function openStudentS3Folder(userID) {
        const iframe = document.getElementById('s3BrowserFrame');
        // S3 ë¸Œë¼ìš°ì €ì— í•™ìƒ í´ë” ê²½ë¡œ ì „ë‹¬
        iframe.src = `/s3/browser?initialPath=users/${encodeURIComponent(userID)}/`;
        const modal = new bootstrap.Modal(document.getElementById('s3BrowserModal'));
        modal.show();
    }

    // ëª¨ë‹¬ì´ ë‹«í ë•Œ iframe src ì´ˆê¸°í™” (ë©”ëª¨ë¦¬ ì ˆì•½)
    document.getElementById('s3BrowserModal').addEventListener('hidden.bs.modal', function () {
        const iframe = document.getElementById('s3BrowserFrame');
        iframe.src = '';
    });
</script>

<!-- í•™ìƒ ê´€ë¦¬ ì „ìš© ìŠ¤í¬ë¦½íŠ¸ -->
<script src="/js/teacher/student-management.js"></script>