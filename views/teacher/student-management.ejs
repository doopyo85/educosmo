<!-- 학생 관리 페이지 -->
<div class="student-management-page">
    <div class="page-header">
        <h3>학생 관리</h3>
        <p class="text-muted">우리 센터 학생들의 목록과 학습 진도를 관리할 수 있습니다.</p>
    </div>

    <!-- 탭 네비게이션 -->
    <ul class="nav nav-tabs mb-4" id="studentTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="progress-tab" data-bs-toggle="tab" data-bs-target="#student-progress" type="button" role="tab">
                <i class="bi bi-graph-up-arrow me-2"></i>학습 진도
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="list-tab" data-bs-toggle="tab" data-bs-target="#student-list" type="button" role="tab">
                <i class="bi bi-people-fill me-2"></i>학생 목록
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="files-tab" data-bs-toggle="tab" data-bs-target="#student-files" type="button" role="tab">
                <i class="bi bi-folder-open me-2"></i>학생 파일
            </button>
        </li>
    </ul>

    <!-- 탭 콘텐츠 -->
    <div class="tab-content" id="studentTabContent">
        <!-- 학습 진도 탭 -->
        <div class="tab-pane fade show active" id="student-progress" role="tabpanel">
            <!-- 검색창 -->
            <div class="mb-3">
                <input type="text" id="progressSearch" class="form-control" placeholder="학생 이름 또는 아이디 검색..." />
            </div>

            <!-- 진도표 테이블 -->
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                    <tr>
                        <th>프로필</th>
                        <th>이름</th>
                        <th>아이디</th>
                        <th>완료 수 / 전체</th>
                        <th>진도율</th>
                        <th>현재 플랫폼</th>
                        <th>CT 레벨</th>
                        <th>최근 학습일</th>
                        <th>관리</th>
                    </tr>
                </thead>
                <tbody id="progressTableBody">
                    <!-- 동적으로 로드 -->
                </tbody>
            </table>
        </div>

        <!-- 학생 목록 탭 -->
        <div class="tab-pane fade" id="student-list" role="tabpanel">
            <!-- 상단 액션 바 -->
            <div class="action-bar">
                <div class="search-box">
                    <i class="bi bi-search"></i>
                    <input type="text" id="studentSearch" placeholder="학생 이름 또는 아이디 검색...">
                </div>
                <button class="btn btn-primary" id="addStudentBtn">
                    <i class="bi bi-person-plus"></i> 학생 추가
                </button>
            </div>
            
            <!-- 학생 목록 테이블 -->
            <div class="student-list-container">
                <table class="table table-hover" id="studentTable">
                    <thead>
                        <tr>
                            <th width="60px"></th>
                            <th>이름</th>
                            <th>아이디</th>
                            <th>이메일</th>
                            <th>가입일</th>
                            <th>최근 접속</th>
                            <th width="100px">관리</th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody">
                        <!-- 동적 생성 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 🔥 학생 파일 탭 -->
        <div class="tab-pane fade" id="student-files" role="tabpanel">
            <div class="text-center py-5">
                <i class="bi bi-folder-open" style="font-size: 4rem; color: #0d6efd;"></i>
                <h4 class="mt-3">학생 파일 브라우저</h4>
                <p class="text-muted">소속 학생들의 저장 파일을 조회할 수 있습니다.</p>
                <button class="btn btn-primary btn-lg mt-3" data-bs-toggle="modal" data-bs-target="#s3BrowserModal">
                    <i class="bi bi-folder-open me-2"></i>파일 브라우저 열기
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 학생 추가/수정 모달 -->
<div class="modal fade" id="studentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">학생 추가</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="studentForm">
                    <input type="hidden" id="studentId">
                    
                    <div class="mb-3">
                        <label class="form-label">아이디 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="userID" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">이름 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="name" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">이메일</label>
                        <input type="email" class="form-control" id="email">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">비밀번호 <small class="text-muted">(수정 시 공란이면 변경 안 함)</small></label>
                        <input type="password" class="form-control" id="password">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">전화번호</label>
                        <input type="tel" class="form-control" id="phone">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">생년월일</label>
                        <input type="date" class="form-control" id="birthdate">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" id="saveStudentBtn">저장</button>
            </div>
        </div>
    </div>
</div>

<!-- 🔥 S3 파일 브라우저 모달 -->
<div class="modal fade" id="s3BrowserModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-body p-0">
                <iframe id="s3BrowserFrame" 
                        src="" 
                        style="width: 100%; height: 100%; border: none;"
                        frameborder="0">
                </iframe>
            </div>
        </div>
    </div>
</div>

<!-- 🔥 S3 모달 초기화 스크립트 -->
<script>
    // 모달이 열릴 때 iframe src 설정
    document.getElementById('s3BrowserModal').addEventListener('show.bs.modal', function () {
        const iframe = document.getElementById('s3BrowserFrame');
        iframe.src = '/s3';
    });
    
    // 모달이 닫힐 때 iframe src 초기화 (메모리 절약)
    document.getElementById('s3BrowserModal').addEventListener('hidden.bs.modal', function () {
        const iframe = document.getElementById('s3BrowserFrame');
        iframe.src = '';
    });
</script>

<!-- 학생 관리 전용 스크립트 -->
<script src="/js/teacher/student-management.js"></script>