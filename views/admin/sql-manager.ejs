<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL 관리 - Admin</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css">
    <style>
        .table-container { max-height: 600px; overflow-y: auto; }
        .sql-editor { font-family: 'Courier New', monospace; min-height: 150px; }
        .editable-cell { cursor: pointer; }
        .editable-cell:hover { background-color: #f0f0f0; }

        /* ✅ 테이블 목록 높이 조정 (화면 전체 높이에 맞춤) */
        #tableList {
            max-height: calc(100vh - 160px); /* 헤더 등 여백 고려 */
            overflow-y: auto;
            min-height: 400px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <%- include('../partials/header') %>
    
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- 사이드바: 테이블 목록 -->
            <div class="col-md-2">
                <h5>테이블 목록</h5>
                <div class="list-group" id="tableList">
                    <% tables.forEach(table => { %>
                        <button class="list-group-item list-group-item-action" 
                                data-table="<%= table %>">
                            <%= table %>
                        </button>
                    <% }); %>
                </div>
            </div>
            
            <!-- 메인: 데이터 조회/수정 -->
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 id="currentTable">테이블을 선택하세요</h5>
                        <div>
                            <button class="btn btn-sm btn-primary" id="refreshBtn">
                                <i class="bi bi-arrow-clockwise"></i> 새로고침
                            </button>
                            <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#csvUploadModal">
                                <i class="bi bi-upload"></i> CSV 업로드
                            </button>
                            <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#sqlExecuteModal">
                                <i class="bi bi-code-square"></i> SQL 실행
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- 테이블 구조 -->
                        <div id="tableStructure" class="mb-3" style="display: none;">
                            <h6>테이블 구조</h6>
                            <table class="table table-sm table-bordered" id="structureTable"></table>
                        </div>
                        
                        <!-- 데이터 테이블 -->
                        <div class="table-container">
                            <table class="table table-striped table-hover" id="dataTable">
                                <thead></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <nav id="pagination" style="display: none;">
                            <ul class="pagination justify-content-center"></ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CSV 업로드 모달 -->
    <div class="modal fade" id="csvUploadModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">CSV 업로드</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="csvUploadForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="csvFile" class="form-label">CSV 파일 선택</label>
                            <input type="file" class="form-control" id="csvFile" accept=".csv" required>
                        </div>
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i>
                            주의: 현재 선택된 테이블에 데이터가 추가됩니다.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" id="uploadCsvBtn">업로드</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SQL 실행 모달 -->
    <div class="modal fade" id="sqlExecuteModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">SQL 직접 실행</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <textarea class="form-control sql-editor" id="sqlEditor" 
                              placeholder="SELECT * FROM Users LIMIT 10;"></textarea>
                    <div id="sqlResult" class="mt-3"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                    <button type="button" class="btn btn-primary" id="executeSqlBtn">실행</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/admin-sql.js"></script>
</body>
</html>
