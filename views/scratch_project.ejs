<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scratch í”„ë¡œì íŠ¸ ì„ íƒ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.5.0/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/card_project.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="/header.js"></script>

    <script>
        const projectType = 'scratch';
    </script>
</head>

<body>
    <%- include('partials/header') %>
        <input type="hidden" id="user-role" value="<%= role %>">
        <input type="hidden" id="user-id" value="<%= userID %>">
        <input type="hidden" id="center-id" value="<%= centerID %>">

        <div class="container-fluid mt-5" style="max-width: 1700px;">
            <!-- ğŸ”¥ ì¹´í…Œê³ ë¦¬ë³„ íƒ­ + ìƒˆ í”„ë¡œì íŠ¸ ë²„íŠ¼ (Toolbar Layout) -->
            <div class="text-center mb-4">
                <h1 class="fw-bold">Scratch í”„ë¡œì íŠ¸</h1>
                <p class="text-muted">CPS / COS êµìœ¡ê³¼ì •ì„ ìœ„í•œ Scratch ì½˜í…ì¸ ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>

                <!-- ğŸ”¥ ë²„íŠ¼ ë° íƒ­ í†µí•© ê·¸ë£¹ (Apple Style) -->
                <div class="apple-toolbar-container">
                    <!-- ê³ ì • ë²„íŠ¼ (ì™¼ìª½) -->
                    <div class="d-flex align-items-center gap-2">
                        <button id="newProjectBtn" class="apple-btn-primary">
                            <i class="bi bi-plus-lg"></i> ìƒˆë¡œ ì‹œì‘í•˜ê¸°
                        </button>
                        <a href="https://scratch.mit.edu" target="_blank" class="apple-btn-primary">
                            <i class="bi bi-box-arrow-up-right"></i> scratch.mit.edu
                        </a>
                        <!-- ğŸ”¥ ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ ì¶”ê°€ -->
                        <button onclick="openScratchProjectLoadModal()" class="apple-btn-primary">
                            <i class="bi bi-folder2-open"></i> ë¶ˆëŸ¬ì˜¤ê¸°
                        </button>
                        <div class="apple-divider mx-3"></div>
                    </div>

                    <!-- ë™ì  íƒ­ (ì˜¤ë¥¸ìª½) -->
                    <ul class="nav nav-pills apple-nav-pills" id="categoryTabs" role="tablist"></ul>
                </div>
            </div>

            <!-- ğŸ”¥ ì¹´í…Œê³ ë¦¬ë³„ ì½˜í…ì¸  -->
            <div id="edu-content">
                <div id="content-container" class="tab-content mt-3"></div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/js/card_project.js"></script>
        <!-- ğŸ”¥ í†µí•© ì €ì¥ì†Œ ëª¨ë‹¬ -->
        <script src="/js/components/storage/ProjectStorageModal.js"></script>

        <script>
            /**
             * ğŸ”¥ Scratch í”„ë¡œì íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° (ProjectStorageModal ì‚¬ìš©)
             */
            function openScratchProjectLoadModal() {
                const modal = new ProjectStorageModal({
                    platform: 'scratch',
                    onLoad: (data) => {
                        console.log('ğŸ“‚ Scratch í”„ë¡œì íŠ¸ ì„ íƒë¨:', data);
                        if (data.projectId || data.fileId) {
                            // í”„ë¡œì íŠ¸ IDë¥¼ ì‚¬ìš©í•˜ì—¬ Scratch ì—ë””í„° ì—´ê¸°
                            const projectId = data.projectId || data.fileId;
                            const scratchEditorUrl = `/scratch?projectId=${projectId}`;
                            window.open(scratchEditorUrl, '_blank');
                        } else if (data.url) {
                            // S3 URLì„ ì‚¬ìš©í•˜ì—¬ Scratch ì—ë””í„° ì—´ê¸°
                            const scratchEditorUrl = `/scratch?s3Url=${encodeURIComponent(data.url)}`;
                            window.open(scratchEditorUrl, '_blank');
                        } else {
                            alert('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        }
                    }
                });
                modal.openLoadModal();
            }

            // ğŸ”¥ ìƒˆë¡œ ì‹œì‘í•˜ê¸° ë²„íŠ¼
            document.getElementById('newProjectBtn').addEventListener('click', function () {
                console.log('ğŸ¯ ìƒˆë¡œ ì‹œì‘í•˜ê¸° ë²„íŠ¼ í´ë¦­');

                // Scratch ì—ë””í„°ë¡œ ì´ë™ (ìì²´ ì„œë²„)
                window.open('/scratch', '_blank');

                // í•™ìŠµ í™œë™ ê¸°ë¡
                try {
                    fetch('/learning/log', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'scratch_new_project',
                            data: {
                                userID: document.getElementById('user-id').value,
                                timestamp: new Date().toISOString()
                            }
                        })
                    });
                } catch (error) {
                    console.error('ë¡œê·¸ ê¸°ë¡ ì˜¤ë¥˜:', error);
                }
            });
        </script>
</body>

</html>