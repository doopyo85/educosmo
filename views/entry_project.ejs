<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—”íŠ¸ë¦¬ í”„ë¡œì íŠ¸ ì„ íƒ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.5.0/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/card_project.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="/header.js"></script>
    <script src="/js/extension-bridge.js"></script>

    <script>
        const projectType = 'entry';
    </script>
</head>

<body>
    <%- include('partials/header') %>
        <input type="hidden" id="user-role" value="<%= role %>">
        <input type="hidden" id="user-id" value="<%= userID %>">
        <input type="hidden" id="center-id" value="<%= centerID %>">

        <div class="container-fluid mt-5" style="max-width: 1700px;">
            <!-- ğŸ”¥ CPE / CPA êµìœ¡ ì½˜í…ì¸ ë§Œ ì¶œë ¥ -->
            <div class="text-center mb-4">
                <h1 class="fw-bold">Entry í”„ë¡œì íŠ¸</h1>
                <p class="text-muted">CPE / CPA êµìœ¡ê³¼ì •ì„ ìœ„í•œ Entry ì½˜í…ì¸ ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>

                <!-- ğŸ”¥ ë²„íŠ¼ ë° íƒ­ í†µí•© ê·¸ë£¹ (Apple Style) -->
                <div class="apple-toolbar-container">
                    <!-- ê³ ì • ë²„íŠ¼ (ì™¼ìª½) -->
                    <div class="d-flex align-items-center gap-2">
                        <!-- ğŸ”¥ External Link -->
                        <!-- ğŸ”¥ External Link (Extension Bridge) -->
                        <a href="#" class="apple-btn-primary" id="openOfficialEntryBtn" data-action="open-editor"
                            data-platform="entry" data-mission-id="entry_new_project" data-user-id="<%= userID %>"
                            data-mission-title="ìƒˆ í”„ë¡œì íŠ¸">
                            <i class="bi bi-box-arrow-up-right"></i> Entry ê³µì‹ ì—ë””í„° ì—´ê¸°
                        </a>

                        <a href="https://playentry.org" target="_blank" class="apple-btn-secondary">
                            <i class="bi bi-link"></i> playentry.org
                        </a>

                        <!-- ğŸ”¥ ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ ì¶”ê°€ -->
                        <button onclick="openEntryProjectLoadModal()" class="apple-btn-primary">
                            <i class="bi bi-folder2-open"></i> ë‚´ í”„ë¡œì íŠ¸ ë³´ê¸°
                        </button>
                        <div class="apple-divider mx-3"></div>
                    </div>

                    <!-- ë™ì  íƒ­ (ì˜¤ë¥¸ìª½) -->
                    <ul class="nav nav-pills apple-nav-pills" id="categoryTabs" role="tablist"></ul>
                </div>
            </div>

            <!-- ğŸ”¥ CPE / CPA êµìœ¡ ì½˜í…ì¸ ë§Œ ì¶œë ¥ -->
            <div id="edu-content">
                <div id="content-container" class="tab-content mt-3"></div>
            </div>

            <!-- ğŸ”¥ ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div class="alert alert-info text-center mt-4">
                <i class="bi bi-info-circle-fill"></i>
                ì½”ë”©ì•¤í”Œë ˆì´ í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•˜ë©´ ê³µì‹ ì—ë””í„°ì—ì„œ ì‘ì„±í•œ ì½”ë“œë¥¼ ë°”ë¡œ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/js/card_project.js"></script>
        <!-- ğŸ”¥ í†µí•© ì €ì¥ì†Œ ëª¨ë‹¬ -->
        <script src="/js/components/storage/ProjectStorageModal.js"></script>

        <script>
            /**
             * ğŸ”¥ Entry í”„ë¡œì íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° (ë‹¤ìš´ë¡œë“œ ì œê³µ)
             */
            function openEntryProjectLoadModal() {
                const modal = new ProjectStorageModal({
                    platform: 'entry',
                    onLoad: (data) => {
                        console.log('ğŸ“‚ Entry í”„ë¡œì íŠ¸ ì„ íƒë¨:', data);
                        if (data.url) {
                            // ë°”ë¡œ ë‹¤ìš´ë¡œë“œ
                            const link = document.createElement('a');
                            link.href = data.url;
                            link.download = data.title || 'project.ent';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            alert('í”„ë¡œì íŠ¸ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. Entry ê³µì‹ ì—ë””í„°ì—ì„œ "ì˜¤í”„ë¼ì¸ ì‘í’ˆ ë¶ˆëŸ¬ì˜¤ê¸°"ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.');
                        } else {
                            alert('í”„ë¡œì íŠ¸ URLì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        }
                    }
                });
                modal.openLoadModal();
            }

            // ğŸ”¥ ê³µì‹ ì‚¬ì´íŠ¸ ì´ë™ ë¡œê·¸
            document.getElementById('openOfficialEntryBtn').addEventListener('click', function () {
                console.log('Target: Official Entry');
                // í•™ìŠµ í™œë™ ê¸°ë¡
                try {
                    fetch('/learning/log', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'entry_open_official',
                            data: {
                                userID: document.getElementById('user-id').value,
                                timestamp: new Date().toISOString()
                            }
                        })
                    });
                } catch (error) {
                    console.error('ë¡œê·¸ ê¸°ë¡ ì˜¤ë¥˜:', error);
                }
            });
        </script>
</body>

</html>