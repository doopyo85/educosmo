<link rel="stylesheet" href="/css/nuguri.css">

<div id="nuguri-widget-container" data-user-id="<%= locals.userID || 'Guest' %>"
    data-user-role="<%= locals.role || 'guest' %>" data-center-id="<%= locals.centerID || '' %>"
    data-center-name="<%= locals.centerName || '' %>">
    <!-- Chat Modal -->
    <div class="nuguri-modal" id="nuguriModal">
        <div class="nuguri-header">
            <div class="nuguri-title">
                <img src="https://kr.object.ncloudstorage.com/educodingnplaycontents/thumbs/nuguri.png" width="24"
                    height="24">
                너구리톡
            </div>
            <button class="nuguri-close" id="closeNuguriBtn"><i class="bi bi-x"></i></button>
        </div>

        <div class="nuguri-tabs">
            <button class="nuguri-tab-btn active" data-tab="chat">💬 대화창</button>
            <button class="nuguri-tab-btn" data-tab="users">👥 접속자 <span id="userCountBadge">(0)</span></button>
            <button class="nuguri-tab-btn" data-tab="workroom">🛠 작업실</button>

        </div>

        <div class="nuguri-content">
            <!-- Chat Tab -->
            <div class="nuguri-tab-pane active" id="pane-chat">
                <div class="nuguri-chat-list" id="nuguriChatList">
                    <div class="empty-state">
                        <i class="bi bi-chat-heart"></i>
                        <p>너구리톡에 오신 것을 환영합니다!<br>자유롭게 대화를 나눠보세요.</p>
                    </div>
                </div>
                <div class="nuguri-input-area">
                    <% if (locals.role==='teacher' || locals.role==='admin' || locals.role==='manager' ) { %>
                        <div class="secret-toggle-wrapper">
                            <input type="checkbox" id="secretToggle" class="secret-toggle-input">
                            <label for="secretToggle" class="secret-toggle-label" title="비밀 메시지 모드">
                                <i class="bi bi-shield-lock-fill"></i>
                            </label>
                        </div>
                        <% } %>
                            <input type="text" class="nuguri-input" id="nuguriInput" placeholder="메시지를 입력하세요..."
                                autocomplete="off">
                            <button class="nuguri-send-btn" id="nuguriSendBtn">
                                <i class="bi bi-send-fill"></i>
                            </button>
                </div>
            </div>

            <!-- Users Tab -->
            <div class="nuguri-tab-pane" id="pane-users">
                <div id="nuguriUserList">
                    <!-- Users will be injected here -->
                </div>
            </div>

            <!-- Workroom Tab -->
            <div class="nuguri-tab-pane" id="pane-workroom">
                <div class="workroom-container">
                    <img src="/resource/coding_nuguri.webp" class="workroom-img" id="workroomImg">
                    <div class="speech-bubble-sm" id="workroomStatus">열심히 코딩하는 중...</div>

                    <div class="task-list-sm">
                        <div class="task-item-sm">
                            <div class="task-status-icon">🔄</div>
                            <div class="task-content">
                                <h6>게시판 시스템 고도화</h6>
                                <p>파일 첨부 기능 개선 중</p>
                            </div>
                        </div>
                        <div class="task-item-sm">
                            <div class="task-status-icon">✅</div>
                            <div class="task-content">
                                <h6>너구리톡 UI 리뉴얼</h6>
                                <p>투명 위젯 및 에어로 글래스 적용</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



        </div>
    </div>

    <!-- Floating Icon -->
    <div class="nuguri-icon" id="nuguriFloatIcon" title="너구리톡 열기">
        <div class="nuguri-online-indicator" id="nuguriOnlineIndicator">✅</div>
        <img src="https://kr.object.ncloudstorage.com/educodingnplaycontents/thumbs/nuguri.png" alt="Nuguri Talk">
        <div class="nuguri-badge" id="nuguriUnreadBadge">0</div>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="/js/nuguri.js"></script>