<!DOCTYPE html>
<html lang="ko">

<head>
    <%- include('../partials/header') %>
        <style>
            .page-container {
                display: flex;
                max-width: 1400px;
                margin: 0 auto;
                min-height: calc(100vh - 200px);
            }

            /* Sidebar Styling */
            .sidebar {
                width: 250px;
                background: #fff;
                border-right: 1px solid #dee2e6;
                padding: 30px 20px;
                flex-shrink: 0;
            }

            .sidebar-title {
                font-size: 1.25rem;
                font-weight: 700;
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 2px solid #333;
            }

            .sidebar-menu {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            .sidebar-menu li {
                margin-bottom: 8px;
            }

            .sidebar-menu a {
                display: block;
                padding: 10px 15px;
                color: #555;
                text-decoration: none;
                border-radius: 6px;
                transition: all 0.2s;
                font-weight: 500;
            }

            .sidebar-menu a:hover,
            .sidebar-menu a.active {
                background-color: #f8f9fa;
                color: #007bff;
                font-weight: 700;
            }

            .sidebar-menu i {
                margin-right: 8px;
                width: 20px;
                text-align: center;
            }

            /* Main Content Styling */
            .main-content {
                flex-grow: 1;
                padding: 40px;
                background: #f8f9fa;
            }

            /* Subject Card */
            .content-card {
                background: white;
                border-radius: 12px;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
                padding: 30px;
                margin-bottom: 30px;
            }

            .card-header-styled {
                text-align: center;
                margin-bottom: 30px;
            }

            .card-title {
                font-size: 1.8rem;
                font-weight: 800;
                color: #333;
                margin-bottom: 20px;
            }

            /* Subject Tabs */
            .subject-tabs {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-bottom: 30px;
                border-bottom: 1px solid #eee;
                padding-bottom: 15px;
            }

            .subject-tab {
                padding: 8px 24px;
                border-radius: 20px;
                background: #f1f3f5;
                color: #555;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s;
                border: 1px solid transparent;
            }

            .subject-tab.active {
                background: #007bff;
                color: white;
                box-shadow: 0 4px 6px rgba(0, 123, 255, 0.2);
            }

            /* Grid Table */
            .exam-table {
                width: 100%;
                border-collapse: separate;
                border-spacing: 0 8px;
            }

            .exam-table th {
                text-align: center;
                padding: 15px;
                font-weight: 700;
                color: #555;
                border-bottom: 2px solid #dee2e6;
            }

            .exam-row {
                background: white;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
                transition: transform 0.2s;
            }

            .exam-row:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            }

            .exam-row td {
                padding: 15px;
                vertical-align: middle;
                background: white;
                /* Needed for border-radius on modern browsers when separate */
                border-top: 1px solid #eee;
                border-bottom: 1px solid #eee;
            }

            .exam-row td:first-child {
                border-left: 1px solid #eee;
                border-top-left-radius: 8px;
                border-bottom-left-radius: 8px;
                font-weight: 700;
                color: #444;
                text-align: center;
            }

            .exam-row td:last-child {
                border-right: 1px solid #eee;
                border-top-right-radius: 8px;
                border-bottom-right-radius: 8px;
            }

            /* Button Groups */
            .btn-group-custom {
                display: flex;
                gap: 6px;
                justify-content: center;
            }

            .btn-custom {
                padding: 6px 14px;
                font-size: 0.85rem;
                border-radius: 4px;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s;
                border: 1px solid #ddd;
                font-weight: 500;
            }

            .btn-sol {
                color: #555;
                background: #fff;
            }

            .btn-sol:hover {
                background-color: #f8f9fa;
                color: #333;
                border-color: #ccc;
            }

            .btn-ans {
                color: #007bff;
                background: #e7f1ff;
                border-color: #b3d7ff;
            }

            .btn-ans:hover {
                background-color: #007bff;
                color: white;
                border-color: #007bff;
            }

            .type-label {
                display: block;
                text-align: center;
                font-size: 0.8rem;
                color: #888;
                margin-bottom: 4px;
            }
        </style>
</head>

<body>

    <div class="page-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-title">Certification</div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active"><i class="bi bi-journal-text"></i> ITQ 기출문제</a></li>
                <li><a href="#"><i class="bi bi-laptop"></i> COS (준비중)</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-card">
                <div class="card-header-styled">
                    <div class="card-title">ITQ 기출문제 통합 다운로드</div>
                    <div class="subject-tabs">
                        <div class="subject-tab active" onclick="filterSubject('h', this)">아래한글</div>
                        <div class="subject-tab" onclick="filterSubject('e', this)">한글엑셀</div>
                        <div class="subject-tab" onclick="filterSubject('p', this)">파워포인트</div>
                    </div>
                </div>

                <table class="exam-table">
                    <thead>
                        <tr>
                            <th width="15%">회차</th>
                            <th width="28%">A형</th>
                            <th width="28%">B형</th>
                            <th width="28%">C형</th>
                        </tr>
                    </thead>
                    <tbody id="examTableBody">
                        <!-- JS will populate -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <%- include('../partials/footer') %>

        <script>
            const examData = <% - JSON.stringify(examData || []) %>;
            const NCP_BASE_URL = "https://kr.object.ncloudstorage.com/educodingnplaycontents/ITQ/";

            // Group Data: Subject -> Date -> Type
            const grouped = {};
            examData.forEach(item => {
                if (!grouped[item.subject]) grouped[item.subject] = {};
                if (!grouped[item.subject][item.date]) grouped[item.subject][item.date] = {};
                grouped[item.subject][item.date][item.type] = item;
            });

            // Initial render
            document.addEventListener('DOMContentLoaded', () => {
                filterSubject('h', document.querySelector('.subject-tab.active'));
            });

            function filterSubject(subject, tabEl) {
                // Update tabs
                document.querySelectorAll('.subject-tab').forEach(t => t.classList.remove('active'));
                tabEl.classList.add('active');

                const tbody = document.getElementById('examTableBody');
                tbody.innerHTML = '';

                const subjectData = grouped[subject];
                if (!subjectData) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4">데이터가 없습니다.</td></tr>';
                    return;
                }

                // Sort dates descending
                const dates = Object.keys(subjectData).sort((a, b) => b.localeCompare(a));

                dates.forEach(date => {
                    const rowData = subjectData[date];
                    const dateStr = `${date.substring(0, 4)}년 ${date.substring(4, 6)}월`;

                    const tr = document.createElement('tr');
                    tr.className = 'exam-row';

                    // Date Cell
                    let html = `<td>${dateStr}</td>`;

                    // Types A, B, C
                    ['a', 'b', 'c'].forEach(type => {
                        const item = rowData[type];
                        if (item) {
                            // Problem Link (PDF Viewer Request) -> Linking to PDF file for now as per web viewer standard
                            // User's screenshot implied an HTML wrapper, but organize_content made PDFs.
                            // We will link to the PDF directly. Browsers view PDFs well.
                            // Wait, user said "problem files are html" earlier. 
                            // But organize_content copies PDFs as q_file. 
                            // CHECK: Did I change organize_content to make HTMLs? NO, print_html.py does that.
                            // But organize_content.py COPIES PDFs.
                            // Let's check if the HTMLs exist in s3/contents/itq/ITQ/ folder?
                            // My previous list_dir showed them! e.g. 20250317_itq_ha_p01.html
                            // BUT those are PAGE specific. "p01".
                            // The grid shows just "A Type".
                            // If I link to the PDF, it's the full paper.
                            // Users usually want the Full Paper PDF.
                            // The "p01.html" are likely for a specific slide-by-slide viewer.
                            // I will link the PDF for "Question" and File for "Answer".

                            const qLink = item.q_file ? `${NCP_BASE_URL}${item.q_file}` : '#';
                            const aLink = item.a_file ? `${NCP_BASE_URL}${item.a_file}` : '#';

                            const qBtn = item.q_file ? `<a href="${qLink}" target="_blank" class="btn-custom btn-sol">문제보기</a>` : '';
                            const aBtn = item.a_file ? `<a href="${aLink}" class="btn-custom btn-ans" download>정답</a>` : '';

                            html += `
                        <td>
                            <div class="btn-group-custom">
                                ${qBtn}
                                ${aBtn}
                            </div>
                        </td>
                    `;
                        } else {
                            html += `<td><span class="text-muted">-</span></td>`;
                        }
                    });

                    tr.innerHTML = html;
                    tbody.appendChild(tr);
                });
            }
        </script>

</body>

</html>