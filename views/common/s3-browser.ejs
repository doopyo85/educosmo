<!-- S3 ë¸Œë¼ìš°ì € ëª¨ë‹¬ (í†µí•© ë²„ì „) -->
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css">

    <!-- S3 Browser CSS -->
    <!-- S3 Browser CSS -->
    <link rel="stylesheet" href="/css/admin/s3-browser.css">
    <!-- Teacher Board Layout CSS -->
    <link rel="stylesheet" href="/css/board-layout.css">
</head>

<body>
    <!-- ê³µí†µ í—¤ë” í¬í•¨ -->
    <%- include('../partials/header') %>

        <% if (role==='teacher' || role==='manager' ) { %>
            <!-- ğŸ”¥ Teacher Dashboard Style Override for S3 Browser -->
            <style>
                /* 1. Use board-layout structure */
                .board-layout-container {
                    max-width: 1400px;
                    margin: 20px auto;
                    display: flex;
                    gap: 20px;
                    align-items: flex-start;
                    padding: 0 15px;
                }

                /* 2. S3 Wrapper - transparent wrapper */
                .s3-browser-wrapper {
                    border: none !important;
                    background: transparent !important;
                    box-shadow: none !important;
                    width: 100% !important;
                    margin: 0 !important;
                    padding: 0 !important;
                }

                /* 3. Breadcrumb & Platform Filter - hide */
                .breadcrumb-container,
                .platform-filter {
                    display: none !important;
                }

                /* 4. S3 Browser Content - board-layoutê³¼ ì •í™•íˆ í†µì¼ */
                .s3-browser-content {
                    display: flex !important;
                    flex-direction: row !important;
                    gap: 20px !important;
                    align-items: flex-start !important;
                    height: auto !important;
                }

                /* 5. Folder Tree -> board-sidebar ì •í™•íˆ ë³µì œ */
                .folder-tree-container {
                    width: 250px !important;
                    min-width: 250px !important;
                    flex-shrink: 0 !important;
                    position: sticky !important;
                    top: 90px !important;
                    height: fit-content !important;
                    max-height: calc(100vh - 110px) !important;
                    overflow-y: auto !important;
                    background-color: #fff !important;
                    border: 1px solid #e0e0e0 !important;
                    border-radius: 8px !important;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
                }

                /* Folder Tree Header -> board-sidebar-header ì •í™•íˆ ë³µì œ */
                .folder-tree-header {
                    background-color: #495057 !important;
                    color: white !important;
                    padding: 15px !important;
                    font-weight: bold !important;
                    border-radius: 8px 8px 0 0 !important;
                    border-bottom: none !important;
                }

                .folder-tree-header h4 {
                    color: white !important;
                    font-size: 1rem !important;
                    font-weight: bold !important;
                    margin: 0 !important;
                }

                /* folder-item -> board-category-item ì •í™•íˆ ë³µì œ */
                .folder-item {
                    padding: 12px 20px !important;
                    border-bottom: 1px solid #f1f3f4 !important;
                    cursor: pointer !important;
                    transition: background-color 0.2s !important;
                    color: #6c757d !important;
                    text-decoration: none !important;
                    display: block !important;
                    gap: 0 !important;
                    border-radius: 0 !important;
                }

                .folder-item:hover {
                    background-color: #f8f9fa !important;
                    color: #495057 !important;
                    text-decoration: none !important;
                }

                .folder-item.active {
                    background-color: #e3f2fd !important;
                    color: #1976d2 !important;
                    font-weight: 500 !important;
                }

                .folder-icon {
                    margin-right: 8px !important;
                    width: 16px !important;
                }

                /* 6. File List -> board-main-content ì •í™•íˆ ë³µì œ */
                .file-list-container {
                    flex: 1 !important;
                    min-width: 600px !important;
                    background-color: #fff !important;
                    border: 1px solid #e0e0e0 !important;
                    border-radius: 8px !important;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
                    height: auto !important;
                }

                /* Page header - board-layoutê³¼ ë™ì¼í•œ íŒ¨ë”© */
                .s3-browser-header {
                    max-width: 1400px;
                    margin: 0 auto 20px;
                    padding: 0 15px !important;
                    background: transparent !important;
                    border: none !important;
                }
            </style>
            <% } %>

                <!-- Page Header -->
                <div class="s3-browser-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div>
                                <h5 class="mb-1">
                                    <i class="bi bi-folder-open me-2"></i>
                                    <% if (role==='admin' ) { %>
                                        S3 íŒŒì¼ ê´€ë¦¬ (ì „ì²´)
                                        <% } else if (role==='teacher' || role==='manager' ) { %>
                                            í•™ìƒ íŒŒì¼ ê´€ë¦¬ <span class="text-muted fs-6 fw-normal ms-2">(ì„¼í„° <%= centerID
                                                    %>)</span>
                                            <% } else { %>
                                                ë‚´ íŒŒì¼ ê´€ë¦¬
                                                <% } %>
                                </h5>
                                <p class="text-muted mb-0 small">
                                    <% if (role==='admin' ) { %>
                                        ëª¨ë“  ì‚¬ìš©ìì˜ ì €ì¥ íŒŒì¼ì„ ì¡°íšŒí•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                        <% } else if (role==='teacher' || role==='manager' ) { %>
                                            í•™ìƒë“¤ì˜ íŒŒì¼ì„ ì¡°íšŒí•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¢Œì¸¡ í´ë” íŠ¸ë¦¬ì—ì„œ í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”.
                                            <% } else { %>
                                                ë‚˜ì˜ ì €ì¥ íŒŒì¼ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                            <% } %>
                                </p>
                            </div>
                        </div>

                        <div class="d-flex align-items-center gap-3">
                            <div>
                                <% if (role==='admin' ) { %>
                                    <span class="badge bg-danger">Admin</span>
                                    <% } else if (role==='teacher' || role==='manager' ) { %>
                                        <span class="badge bg-success">
                                            <%= role %>
                                        </span>
                                        <span class="badge bg-info">ì„¼í„° <%= centerID %></span>
                                        <% } else { %>
                                            <span class="badge bg-primary">
                                                <%= role %>
                                            </span>
                                            <% } %>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Board Layout Container -->
                <div class="board-layout-container">
                    <!-- S3 ë¸Œë¼ìš°ì € ì»¨í…Œì´ë„ˆ (ì‚¬ì´ë“œë°” + ë©”ì¸ ì»¨í…ì¸ ) -->
                    <div id="s3-browser"></div>
                </div>

                <!-- Bootstrap JS -->
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
                <script src="/js/components/S3Explorer.js"></script>

                <!-- ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
                <script>
                    document.addEventListener('DOMContentLoaded', function () {
                        console.log('ğŸš€ S3 Browser ì´ˆê¸°í™” ì‹œì‘...');

                        const role = '<%= role %>';
                        const userID = '<%= userID %>';
                        const scope = '<%= scope %>';

                        const initialPath = '<%= typeof initialPath !== "undefined" ? initialPath : "" %>'; // ğŸ”¥ ì´ˆê¸° ê²½ë¡œ
                        const s3AssetUrl = '<%= typeof s3AssetUrl !== "undefined" ? s3AssetUrl : "" %>'; // ğŸ”¥ NCP Asset URL

                        // ì—­í• ë³„ ë£¨íŠ¸ ê²½ë¡œ ì„¤ì •
                        let rootPath = '';
                        if (initialPath) {
                            rootPath = initialPath; // ğŸ”¥ ì´ˆê¸° ê²½ë¡œê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©
                        } else if (role === 'admin') {
                            rootPath = '';
                        } else if (role === 'teacher' || role === 'manager') {
                            rootPath = 'users/';
                        } else if (role === 'student') {
                            rootPath = `users/${userID}/`; // âœ… í•™ìƒì€ ë³¸ì¸ í´ë”ì—ì„œ ì‹œì‘
                        }

                        console.log('ğŸ“ Initial Path:', rootPath);

                        // ğŸ”¥ ì—­í• ë³„ ì—…ë¡œë“œ ê¶Œí•œ ì„¤ì •
                        let enableUpload = false;
                        if (role === 'admin') {
                            enableUpload = true;  // Adminì€ ëª¨ë“  ê³³ì— ì—…ë¡œë“œ ê°€ëŠ¥
                        } else if (role === 'teacher' || role === 'manager') {
                            enableUpload = true;  // Teacher/ManagerëŠ” í•™ìƒ í´ë”ì— ì—…ë¡œë“œ ê°€ëŠ¥
                        } else if (role === 'student') {
                            enableUpload = true;  // StudentëŠ” ë³¸ì¸ í´ë”ì— ì—…ë¡œë“œ ê°€ëŠ¥
                        }

                        window.s3Explorer = new S3Explorer({
                            containerId: 's3-browser',
                            apiEndpoint: '/api/s3/browse',
                            scope: scope,
                            rootPath: rootPath,
                            s3AssetUrl: s3AssetUrl, // ğŸ”¥ NCP Asset URL ì „ë‹¬
                            userID: userID,        // âœ… ë°˜ë“œì‹œ ì „ë‹¬
                            userRole: role,        // âœ… ì—­í•  ì „ë‹¬
                            allowedPlatforms: ['scratch', 'entry', 'gallery', 'portfolio'],
                            enableUpload: enableUpload,  // ğŸ”¥ ì—­í• ë³„ ì—…ë¡œë“œ ê¶Œí•œ
                            enableDelete: <%= enableDelete %>,
                            enablePreview: true,
                            onError: function (error) {
                                console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:', error);
                                showModalNotification('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
                            }
                        });

                    console.log('âœ… S3 Browser ì´ˆê¸°í™” ì™„ë£Œ');
                    });

                    function showModalNotification(message, type = 'info') {
                        const alertDiv = document.createElement('div');
                        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                        alertDiv.style.cssText = 'position: absolute; top: 10px; right: 10px; z-index: 9999; min-width: 300px;';
                        alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                        document.body.appendChild(alertDiv);
                        setTimeout(() => alertDiv.remove(), 5000);
                    }

                    window.showModalNotification = showModalNotification;
                </script>

                <style>
                    body {
                        margin: 0;
                        padding: 0;
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
                        background: #f8f9fa;
                    }

                    .s3-browser-header {
                        background: #fff;
                        padding: 20px;
                        border-bottom: 1px solid #dee2e6;
                        max-width: 1400px;
                        margin: 0 auto;
                    }

                    .s3-browser-header h5 {
                        font-size: 1.5rem;
                        font-weight: 700;
                        color: #212529;
                        margin: 0;
                    }

                    .s3-browser-header .text-muted {
                        color: #6c757d !important;
                        font-size: 0.9rem;
                    }

                    .badge {
                        font-size: 0.75rem;
                        padding: 0.4em 0.8em;
                        font-weight: 600;
                        border-radius: 6px;
                        letter-spacing: 0.3px;
                    }
                </style>
</body>

</html>