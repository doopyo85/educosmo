<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPlan - <%= teacherBlog.title %></title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            background-color: #0f1419;
            color: #e1e8ed;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Header */
        .eduplan-header {
            margin-bottom: 40px;
        }

        .eduplan-header h1 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .back-btn {
            display: inline-block;
            margin-bottom: 30px;
            color: #888;
            text-decoration: none;
        }

        .back-btn:hover {
            color: #fff;
        }

        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e2a35 0%, #2d3e50 100%);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }

        .stat-value {
            display: block;
            font-size: 36px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-label {
            display: block;
            color: #888;
            font-size: 14px;
        }

        /* Upload Section */
        .upload-section {
            background-color: #192734;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .upload-section h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background-color: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
        }

        .upload-area input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
        }

        .upload-btn:hover {
            opacity: 0.9;
        }

        /* Posts Table */
        .posts-section {
            background-color: #192734;
            border-radius: 12px;
            padding: 30px;
        }

        .posts-section h2 {
            font-size: 24px;
            margin-bottom: 25px;
        }

        .posts-table {
            width: 100%;
            border-collapse: collapse;
        }

        .posts-table th,
        .posts-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #2d3e50;
        }

        .posts-table th {
            color: #888;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
        }

        .posts-table td {
            color: #e1e8ed;
        }

        .posts-table tr:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background-color: rgba(46, 213, 115, 0.2);
            color: #2ed573;
        }

        .badge-warning {
            background-color: rgba(255, 159, 67, 0.2);
            color: #ff9f43;
        }

        .badge-info {
            background-color: rgba(102, 126, 234, 0.2);
            color: #667eea;
        }

        .action-btn {
            background-color: transparent;
            border: 1px solid #667eea;
            color: #667eea;
            padding: 6px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            margin-right: 5px;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background-color: #667eea;
            color: white;
        }

        .action-btn.danger {
            border-color: #e74c3c;
            color: #e74c3c;
        }

        .action-btn.danger:hover {
            background-color: #e74c3c;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        /* Loading Spinner */
        .spinner {
            display: none;
            border: 3px solid #2d3e50;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Back Button -->
        <a href="/my-universe" class="back-btn">
            <i class="fas fa-arrow-left"></i> MyUniverseë¡œ ëŒì•„ê°€ê¸°
        </a>

        <!-- Header -->
        <div class="eduplan-header">
            <h1>ğŸ“š <%= teacherBlog.title %></h1>
            <p style="color: #888;">êµì•ˆ ê´€ë¦¬ ë° ë¬¸ì œì€í–‰ ì—°ë™</p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <span class="stat-value"><%= stats.totalPosts %></span>
                <span class="stat-label">ì´ êµì•ˆ</span>
            </div>
            <div class="stat-card">
                <span class="stat-value"><%= stats.publishedCount %></span>
                <span class="stat-label">ë¬¸ì œì€í–‰ ë“±ë¡</span>
            </div>
            <div class="stat-card">
                <span class="stat-value"><%= stats.mdFiles %></span>
                <span class="stat-label">Markdown íŒŒì¼</span>
            </div>
            <div class="stat-card">
                <span class="stat-value"><%= stats.pyFiles %></span>
                <span class="stat-label">Python íŒŒì¼</span>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
            <h2>ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ</h2>
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: #667eea; margin-bottom: 15px;"></i>
                    <p style="font-size: 16px; margin-bottom: 5px;">í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</p>
                    <p style="font-size: 14px; color: #888;">.md, .py íŒŒì¼ë§Œ ì§€ì› (ìµœëŒ€ 5MB)</p>
                    <input type="file" id="fileInput" name="file" accept=".md,.py" onchange="uploadFile()">
                </div>
                <div id="uploadStatus" style="text-align: center; margin-top: 15px; color: #888;"></div>
                <div class="spinner" id="uploadSpinner"></div>
            </form>
        </div>

        <!-- Posts List -->
        <div class="posts-section">
            <h2>ğŸ“ êµì•ˆ ëª©ë¡</h2>

            <% if (posts.length === 0) { %>
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“¦</div>
                    <p>ì•„ì§ ì—…ë¡œë“œí•œ êµì•ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p style="font-size: 14px; color: #666;">ìœ„ì—ì„œ íŒŒì¼ì„ ì—…ë¡œë“œí•´ë³´ì„¸ìš”!</p>
                </div>
            <% } else { %>
                <table class="posts-table">
                    <thead>
                        <tr>
                            <th>ì œëª©</th>
                            <th>íŒŒì¼ íƒ€ì…</th>
                            <th>ì‘ì„±ì¼</th>
                            <th>ë¬¸ì œì€í–‰</th>
                            <th>ì•¡ì…˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for (const post of posts) { %>
                            <tr>
                                <td>
                                    <strong><%= post.title %></strong>
                                    <% if (!post.is_published) { %>
                                        <span class="badge badge-warning" style="margin-left: 10px;">ì´ˆì•ˆ</span>
                                    <% } %>
                                </td>
                                <td>
                                    <% if (post.file_type === 'md') { %>
                                        <span class="badge badge-info">Markdown</span>
                                    <% } else if (post.file_type === 'py') { %>
                                        <span class="badge badge-success">Python</span>
                                    <% } else { %>
                                        <span class="badge badge-warning"><%= post.file_type %></span>
                                    <% } %>
                                </td>
                                <td><%= new Date(post.created_at).toLocaleDateString() %></td>
                                <td>
                                    <% if (post.published_to_platform) { %>
                                        <span class="badge badge-success">âœ… ë“±ë¡ë¨</span>
                                    <% } else { %>
                                        <span class="badge badge-warning">â³ ë¯¸ë“±ë¡</span>
                                    <% } %>
                                </td>
                                <td>
                                    <% if (!post.published_to_platform && post.file_type === 'py') { %>
                                        <button class="action-btn" onclick="publishToPlatform(<%= post.id %>)">
                                            ë¬¸ì œì€í–‰ ë“±ë¡
                                        </button>
                                    <% } %>
                                    <button class="action-btn danger" onclick="deletePost(<%= post.id %>)">
                                        ì‚­ì œ
                                    </button>
                                </td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            <% } %>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // íŒŒì¼ ì—…ë¡œë“œ
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            const statusDiv = document.getElementById('uploadStatus');
            const spinner = document.getElementById('uploadSpinner');

            statusDiv.textContent = 'ì—…ë¡œë“œ ì¤‘...';
            statusDiv.style.color = '#667eea';
            spinner.style.display = 'block';

            try {
                const response = await fetch('/api/teacher/upload-file', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    statusDiv.textContent = 'âœ… ì—…ë¡œë“œ ì™„ë£Œ!';
                    statusDiv.style.color = '#2ed573';
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    throw new Error(result.error || 'ì—…ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('Upload error:', error);
                statusDiv.textContent = `âŒ ${error.message}`;
                statusDiv.style.color = '#e74c3c';
            } finally {
                spinner.style.display = 'none';
            }
        }

        // ë¬¸ì œì€í–‰ì— ë“±ë¡
        async function publishToPlatform(postId) {
            if (!confirm('ì´ êµì•ˆì„ ë¬¸ì œì€í–‰ì— ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`/api/teacher/post/${postId}/publish-to-platform`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();

                if (result.success) {
                    alert('âœ… ë¬¸ì œì€í–‰ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    location.reload();
                } else {
                    throw new Error(result.error || 'ë“±ë¡ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('Publish error:', error);
                alert(`âŒ ${error.message}`);
            }
        }

        // êµì•ˆ ì‚­ì œ
        async function deletePost(postId) {
            if (!confirm('ì •ë§ ì´ êµì•ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(`/api/teacher/post/${postId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('âœ… êµì•ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    location.reload();
                } else {
                    throw new Error(result.error || 'ì‚­ì œ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('Delete error:', error);
                alert(`âŒ ${error.message}`);
            }
        }
    </script>
</body>

</html>
