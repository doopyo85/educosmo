<style>
    /* Scoped styles for Observatory partial */
    .observatory-wrapper {
        position: relative;
        width: 100%;
        height: calc(100vh - 150px);
        background-color: #000010;
        overflow: hidden;
        border-radius: 8px;
    }

    #observatory-container {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
    }

    #ui-layer {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 10;
        pointer-events: none;
    }

    .hud-panel {
        background: rgba(0, 20, 40, 0.7);
        border: 1px solid #1e3a8a;
        padding: 15px;
        border-radius: 8px;
        pointer-events: auto;
        backdrop-filter: blur(5px);
    }

    .hud-title {
        font-family: 'Courier New', monospace;
        font-weight: bold;
        color: #4fc3f7;
        margin-bottom: 10px;
    }

    /* Override bootstrap styles if needed within wrapper */
</style>

<div class="observatory-wrapper">
    <!-- UI Overlay -->
    <div id="ui-layer">
        <div class="hud-panel">
            <div class="hud-title">관측소 상태 (STATUS)</div>
            <div>연결 상태: <span id="status-connectome" style="color: lime;">정상 (ONLINE)</span></div>
            <div>나의 성향: <span id="status-persona" style="color: #ffd700;">분석 중...</span></div>
            <div class="mt-2 text-muted" style="font-size: 0.8em;">마우스로 회전 / 휠로 확대 및 축소</div>
        </div>
    </div>

    <!-- 3D Canvas -->
    <div id="observatory-container"></div>
</div>

<!-- Three.js & Controls -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/renderers/CSS2DRenderer.js"></script>

<!-- Component -->
<script src="/js/components/observatory/ObservatoryComponent.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        // Ensure container exists before init
        if (document.getElementById('observatory-container')) {
            const observatory = new ObservatoryComponent('observatory-container');
            await observatory.init();

            // Update Persona UI if available
            if (observatory.data && observatory.data.persona) {
                const personaEl = document.getElementById('status-persona');
                if (personaEl) {
                    personaEl.innerText = observatory.data.persona;
                }
            }
        }
    });
</script>