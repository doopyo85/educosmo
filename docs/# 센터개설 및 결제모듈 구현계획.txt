# ì„¼í„°ê°œì„¤ ë° ê²°ì œëª¨ë“ˆ êµ¬í˜„ê³„íš

**ì‘ì„±ì¼**: 2026-01-22
**ë²„ì „**: 1.0
**ëª©ì **: Pong2 ë¬´ë£Œ ê³„ì • vs ì„¼í„° ìœ ë£Œ ê³„ì • ë¶„ë¦¬ ë° ì„¼í„° ê°œì„¤/ê²°ì œ ì‹œìŠ¤í…œ êµ¬í˜„

---

## ğŸ¯ 1. í•µì‹¬ ìš”êµ¬ì‚¬í•­ ì •ë¦¬

### 1.1 ë„ë©”ì¸ ë¶„ë¦¬ ì „ëµ

| ë„ë©”ì¸ | ìš©ë„ | íšŒì›ê°€ì… ê²½ë¡œ | ê³„ì • íƒ€ì… |
|--------|------|---------------|-----------|
| **pong2.app** | Pong2 ë¬´ë£Œ ê³„ì • ì „ìš© | Pong2 í”„ë¡ íŠ¸ì—”ë“œ ìì²´ íšŒì›ê°€ì… (API: POST /api/pong2/auth/signup) | account_type='pong2' |
| **app.codingnplay.co.kr** | ì„¼í„° ê³„ì • ì „ìš© | í•™ìƒ íšŒì›ê°€ì… / ì„¼í„° ê°œì„¤ | account_type='center_student' ë˜ëŠ” 'center_admin' |

**ì¤‘ìš”**: Pong2ëŠ” ë³„ë„ í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œì íŠ¸(`C:\Users\User\Documents\pioneer\pong2`)ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìœ¼ë©°, ë°±ì—”ë“œ APIëŠ” educosmoì—ì„œ `/api/pong2/*` ê²½ë¡œë¡œ ì œê³µí•©ë‹ˆë‹¤.

### 1.2 ê³„ì • íƒ€ì…ë³„ íŠ¹ì§•

#### Pong2 ê³„ì • (ë¬´ë£Œ) - pong2.app

```
âœ… ì œê³µ ê¸°ëŠ¥:
- ì»¤ë®¤ë‹ˆí‹° (ì•„ì§€íŠ¸, ê´‘ì¥, ê°¤ëŸ¬ë¦¬)
- í¬íŠ¸í´ë¦¬ì˜¤ (ì‘í’ˆ ê³µìœ )
- PongTube (êµìœ¡ ì˜ìƒ ì‹œì²­)
- ê°œì¸ ë¸”ë¡œê·¸ (StarDiary) - ì›” 10ê°œ ê²Œì‹œê¸€ ì œí•œ

âŒ ì°¨ë‹¨ ê¸°ëŠ¥:
- Portal (í•™ìŠµ ìë£Œ)
- CT ë¬¸ì œ ì€í–‰
- Entry/Scratch/Python IDE
- Judge0 ì±„ì  ì‹œìŠ¤í…œ
- êµìœ¡ ì½˜í…ì¸  ì „ì²´

ğŸ’° ìš”ê¸ˆ: ë¬´ë£Œ
ğŸ“¦ ì €ì¥ì†Œ: 500MB
ğŸ“ ë¸”ë¡œê·¸: ì›” 10ê°œ ê²Œì‹œê¸€
â° ë°ì´í„° ë³´ê´€: 6ê°œì›” ë¯¸ì ‘ì† ì‹œ ì‚­ì œ

ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ:
- í”„ë¡ íŠ¸ì—”ë“œ: ìˆœìˆ˜ HTML/CSS/JS (ë³„ë„ ì €ì¥ì†Œ: C:\Users\User\Documents\pioneer\pong2)
- ë°±ì—”ë“œ API: educosmoì˜ /api/pong2/* ê²½ë¡œ
- íšŒì›ê°€ì…: POST /api/pong2/auth/signup (pong2 í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì²˜ë¦¬)
- ì¸ì¦: JWT Bearer Token
```

#### ì„¼í„° ê³„ì • (ìœ ë£Œ) - app.codingnplay.co.kr

**ì„¼í„° í•™ìƒ (center_student)**
```
âœ… ì œê³µ ê¸°ëŠ¥:
- Pong2 ê³„ì • ì „ì²´ ê¸°ëŠ¥
- êµìœ¡ ì½˜í…ì¸  ì „ì²´ ì ‘ê·¼
- ì„¼í„° í´ë¼ìš°ë“œë³´ë“œ (ê³¼ì œ ì œì¶œ)
- ë¬´ì œí•œ ë¸”ë¡œê·¸ ê²Œì‹œê¸€
- ì„¼í„° ê³µë™ ì €ì¥ì†Œ 30GB ì‚¬ìš©

ğŸ’° ìš”ê¸ˆ: ì„¼í„° êµ¬ë…ë£Œì— í¬í•¨
ğŸ“¦ ì €ì¥ì†Œ: ê°œì¸ 2GB + ì„¼í„° 30GB ê³µìœ 
ğŸ“ ë¸”ë¡œê·¸: ë¬´ì œí•œ
â° ë°ì´í„° ë³´ê´€: ë¬´ê¸°í•œ
```

**ì„¼í„° ê´€ë¦¬ì (center_admin)**
```
âœ… ì¶”ê°€ ê¸°ëŠ¥:
- Teacher Dashboard (í•™ìƒ ê´€ë¦¬)
- í•™ìƒ ì§„ë„ ì¶”ì 
- ê³¼ì œ ê´€ë¦¬
- ì„¼í„° í´ë¼ìš°ë“œë³´ë“œ ê´€ë¦¬
- ì´ˆëŒ€ ì½”ë“œ ìƒì„±
- ì„¼í„° í†µê³„/ë¶„ì„

ğŸ’° ìš”ê¸ˆ: ì›” â‚©110,000 (Standard í”Œëœ)
ğŸ“¦ ì €ì¥ì†Œ: ê°œì¸ 5GB + ì„¼í„° 30GB ê³µìœ 
ğŸ“ ë¸”ë¡œê·¸: ë¬´ì œí•œ
â° ë°ì´í„° ë³´ê´€: ë¬´ê¸°í•œ
```

### 1.3 ì„¼í„° ê°œì„¤ í”„ë¡œì„¸ìŠ¤ ìš”êµ¬ì‚¬í•­

**ì„¼í„° ê°œì„¤ì€ ë°˜ë“œì‹œ ë¬¸ì ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.**

```
[Step 1] ì„¼í„° ì •ë³´ ì…ë ¥
    â†“
[Step 2] SMS ë³¸ì¸ ì¸ì¦ (í•„ìˆ˜)
    â†“
[Step 3] 14ì¼ ë¬´ë£Œ ì²´í—˜ ì‹œì‘
    â†“
[Step 4] ì„¼í„° ìë™ ì´ˆê¸°í™”
    - Centers í…Œì´ë¸” ìƒì„±
    - center_blogs ìë™ ìƒì„±
    - center_subscriptions Trial ìƒì„±
    - Users (account_type='center_admin')
    - CenterStorageUsage (30GB)
    â†“
[Step 5] 14ì¼ ì²´í—˜ ì¢…ë£Œ ì „ ê²°ì œ ìœ ë„
```

---

## ğŸ“Š 2. í˜„ì¬ êµ¬í˜„ ìƒíƒœ ë¶„ì„

### 2.1 âœ… ì´ë¯¸ êµ¬í˜„ëœ ê²ƒë“¤

#### 2.1.1 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

```sql
-- Users í…Œì´ë¸”ì— account_type ì¡´ì¬
Users.account_type ENUM('pong2', 'center_student', 'center_admin')
Users.storage_limit_bytes BIGINT (500MB/2GB/5GB)
Users.blog_post_limit INT (10/999999)

-- Centers í…Œì´ë¸” ì™„ì„±
Centers.id, center_name, contact_phone, contact_email, status
Centers.plan_type, storage_limit_bytes, subscription_expiry

-- center_subscriptions ì™„ì„±
center_subscriptions.plan_type ENUM('standard', 'premium')
center_subscriptions.status ENUM('trial', 'active', 'suspended', 'cancelled')
center_subscriptions.trial_ends_at, next_billing_date

-- center_invite_codes ì™„ì„±
center_invite_codes.code VARCHAR(8)
center_invite_codes.max_uses, current_uses, expires_at
```

#### 2.1.2 ì„¼í„° ê°€ì… ì‹œìŠ¤í…œ âœ…

**íŒŒì¼**: `lib_login/auth.js` (Line 525-660)

```javascript
// ì„¼í„° ê°€ì… í˜ì´ì§€
GET /auth/register-center

// ì„¼í„° ê°€ì… ì²˜ë¦¬ (SMS ì¸ì¦ í•„ìˆ˜)
POST /auth/register-center
  - SMS ì¸ì¦ í™•ì¸ (í•„ìˆ˜)
  - Centers ìƒì„±
  - center_blogs ìë™ ìƒì„±
  - center_subscriptions Trial ìƒì„± (14ì¼)
  - Users (account_type='center_admin')
  - CenterStorageUsage (30GB)
```

**SMS ì¸ì¦ ì‹œìŠ¤í…œ**: `lib_auth/smsService.js`, `lib_auth/verificationService.js`
- NCP SMS ì—°ë™ ì™„ë£Œ
- 6ìë¦¬ ì¸ì¦ ì½”ë“œ ë°œì†¡/ê²€ì¦
- 10ë¶„ ìœ íš¨ ê¸°ê°„

#### 2.1.3 ê¶Œí•œ ì œì–´ ë¯¸ë“¤ì›¨ì–´ âœ…

**íŒŒì¼**: `lib_login/accessControl.js`

```javascript
// Pong2 ê³„ì •ì˜ êµìœ¡ ì½˜í…ì¸  ì ‘ê·¼ ì°¨ë‹¨
requireEducationAccess(req, res, next)
  â†’ account_type='pong2' â†’ 403 ì°¨ë‹¨

// ì„¼í„° íšŒì›ë§Œ ì ‘ê·¼ ê°€ëŠ¥
requireCenterUser(req, res, next)
  â†’ account_type='center_student' or 'center_admin' â†’ í—ˆìš©

// ì„¼í„° ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
requireCenterAdmin(req, res, next)
  â†’ account_type='center_admin' â†’ í—ˆìš©
```

#### 2.1.4 ì„¼í„° ê´€ë¦¬ API âœ…

**íŒŒì¼**: `routes/api/centerRouter.js`

```javascript
// ì´ˆëŒ€ ì½”ë“œ ìƒì„±
POST /api/centers/:id/invite-code

// í•™ìƒ ì´ˆëŒ€ ì½”ë“œë¡œ ê°€ì…
POST /api/centers/join
  â†’ account_type='center_student' ìë™ ì„¤ì •
  â†’ storage_limit_bytes=2GB

// ì„¼í„° í†µê³„
GET /api/centers/:id/stats

// í•™ìƒ ëª©ë¡
GET /api/centers/:id/users

// ì„¼í„° ë¸”ë¡œê·¸ ì •ë³´
GET /api/centers/:id/blog
```

### 2.2 âŒ êµ¬í˜„ë˜ì§€ ì•Šì€ ê²ƒë“¤

#### 2.2.1 ê²°ì œ ì‹œìŠ¤í…œ

- [ ] Toss Payments ì—°ë™
- [ ] ê²°ì œ í˜ì´ì§€ (`/subscription/checkout`)
- [ ] í”Œëœ ì„ íƒ í˜ì´ì§€ (`/subscription/plans`)
- [ ] ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨ ì½œë°± ì²˜ë¦¬
- [ ] ì •ê¸° ê²°ì œ ìë™ ê°±ì‹ 

#### 2.2.2 íšŒì›ê°€ì… í˜ì´ì§€ ë¶„ë¦¬

**í˜„ì¬ ìƒíƒœ (âœ… ì´ë¯¸ ë¶„ë¦¬ë¨)**:
```
âœ… Pong2 ê°€ì… (pong2.app)
  - ìœ„ì¹˜: ë³„ë„ í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œì íŠ¸ (C:\Users\User\Documents\pioneer\pong2)
  - API: POST /api/pong2/auth/signup
  - í…Œì´ë¸”: Pong2Users (ë³„ë„ í…Œì´ë¸” ì‚¬ìš©)
  - íŠ¹ì§•: JWT ê¸°ë°˜ ì¸ì¦, ê°„í¸ ê°€ì… (email, password, nickname)

âœ… ì„¼í„° ê°œì„¤ (app.codingnplay.co.kr)
  - ìœ„ì¹˜: GET /auth/register-center
  - API: POST /auth/register-center
  - í…Œì´ë¸”: Users (account_type='center_admin')
  - íŠ¹ì§•: SMS ì¸ì¦ í•„ìˆ˜, Trial 14ì¼ ìë™ ìƒì„±
```

**í˜„ì¬ ë¬¸ì œì **:
```
âŒ educosmoì˜ GET /auth/register
  â†’ ì„¼í„°, í‚¨ë”, ê¸°ê´€ ëª¨ë“  í˜•íƒœ ì„ íƒ ê°€ëŠ¥
  â†’ account_type ì„¤ì • ì—†ìŒ (ê¸°ë³¸ê°’ 'pong2'ë¡œ ìƒì„±ë¨)
  â†’ ì´ ê²½ë¡œëŠ” ì‚¬ì‹¤ìƒ ì‚¬ìš©ë˜ì§€ ì•Šì•„ì•¼ í•¨ (Pong2ëŠ” ë³„ë„ í”„ë¡ íŠ¸ì—”ë“œ, ì„¼í„°ëŠ” /auth/register-center)
```

**í•„ìš”í•œ ê°œì„ **:
```
app.codingnplay.co.kr/auth/register â†’ í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì…ìœ¼ë¡œ ìš©ë„ ë³€ê²½
  â†’ ì„¼í„° ì´ˆëŒ€ ì½”ë“œ ì…ë ¥ í•„ìˆ˜
  â†’ account_type='center_student' ìë™ ì„¤ì •
  â†’ í•´ë‹¹ ì„¼í„°ì— ìë™ ë°°ì •

ë˜ëŠ” ì´ ê²½ë¡œë¥¼ /auth/join-centerë¡œ ë³€ê²½í•˜ê³  /auth/registerëŠ” ë¹„í™œì„±í™”
```

#### 2.2.3 Trial ë§Œë£Œ ì²˜ë¦¬

- [ ] Cron Jobìœ¼ë¡œ ë§¤ì¼ Trial ë§Œë£Œ ì²´í¬
- [ ] Trial ë§Œë£Œ 7ì¼ ì „ ì´ë©”ì¼ ì•Œë¦¼
- [ ] Trial ë§Œë£Œ ì‹œ status='suspended'
- [ ] Trial ë§Œë£Œ í›„ êµìœ¡ ì½˜í…ì¸  ì°¨ë‹¨

#### 2.2.4 êµ¬ë… ê´€ë¦¬ UI

- [ ] ì„¼í„° ê´€ë¦¬ì êµ¬ë… í˜„í™© í˜ì´ì§€
- [ ] ë‹¤ìŒ ê²°ì œì¼ í‘œì‹œ
- [ ] í”Œëœ ì—…ê·¸ë ˆì´ë“œ/ë‹¤ìš´ê·¸ë ˆì´ë“œ
- [ ] êµ¬ë… ì·¨ì†Œ ê¸°ëŠ¥

---

## ğŸš€ 3. êµ¬í˜„ ê³„íš

### Phase 1: íšŒì›ê°€ì… í˜ì´ì§€ ì •ë¦¬ ë° í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì… êµ¬í˜„ (1ì£¼)

#### 3.1.1 í˜„ì¬ ìƒíƒœ í™•ì¸

**âœ… Pong2 ê°€ì… (ì´ë¯¸ ë¶„ë¦¬ë¨)**:
- ìœ„ì¹˜: ë³„ë„ í”„ë¡ íŠ¸ì—”ë“œ (pong2.app)
- API: POST /api/pong2/auth/signup
- í…Œì´ë¸”: Pong2Users
- ì¸ì¦: JWT
- **ìˆ˜ì • ë¶ˆí•„ìš”** (ì´ë¯¸ ì™„ì „íˆ ë¶„ë¦¬ë˜ì–´ ì‘ë™ ì¤‘)

**âœ… ì„¼í„° ê°œì„¤ (ì´ë¯¸ êµ¬í˜„ë¨)**:
- ìœ„ì¹˜: GET /auth/register-center
- API: POST /auth/register-center
- SMS ì¸ì¦ í¬í•¨
- Trial ìë™ ìƒì„±
- **ìˆ˜ì • ë¶ˆí•„ìš”** (ì´ë¯¸ ì™„ë²½íˆ êµ¬í˜„ë¨)

#### 3.1.2 educosmoì˜ GET /auth/register ìš©ë„ ë³€ê²½

**íŒŒì¼**: `lib_login/auth.js` - GET /auth/register (Line 271-319)

**í˜„ì¬ ë¬¸ì œ**:
- ì„¼í„°, í‚¨ë”, ê¸°ê´€ ë“± ëª¨ë“  role ì„ íƒ ê°€ëŠ¥
- account_type ì„¤ì • ì—†ìŒ â†’ ê¸°ë³¸ê°’ 'pong2'ë¡œ ìƒì„±
- Pong2ëŠ” ë³„ë„ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì´ ê²½ë¡œëŠ” ì‚¬ì‹¤ìƒ ë¶ˆí•„ìš”

**ìˆ˜ì • ë°©ì•ˆ A: í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì…ìœ¼ë¡œ ë³€ê²½ (ì¶”ì²œ)**:
```javascript
router.get('/auth/register', async (req, res) => {
  const title = 'í•™ìƒ ê°€ì…';

  const html = template.HTML(title, `
    <h2>ì„¼í„° ì´ˆëŒ€ ì½”ë“œë¡œ ê°€ì…</h2>
    <p>í•™ì›/í•™êµì—ì„œ ë°›ì€ ì´ˆëŒ€ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
    <form id="registerForm">
      <input type="text" name="inviteCode" placeholder="ì´ˆëŒ€ ì½”ë“œ (8ìë¦¬)" maxlength="8" required>
      <button type="button" onclick="verifyCode()">ì½”ë“œ í™•ì¸</button>

      <div id="userForm" style="display:none">
        <p>ì„¼í„°: <span id="centerName"></span></p>
        <input type="text" name="userID" placeholder="ì•„ì´ë””" required>
        <input type="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
        <input type="email" name="email" placeholder="ì´ë©”ì¼">
        <input type="text" name="name" placeholder="ì´ë¦„" required>
        <input type="submit" value="ê°€ì…í•˜ê¸°">
      </div>
    </form>
    <p><a href="/auth/register-center">ì„¼í„° ê°œì„¤í•˜ê¸°</a></p>
  `);

  res.send(html);
});
```

**ìˆ˜ì • ë°©ì•ˆ B: ê²½ë¡œ ìì²´ë¥¼ ë¹„í™œì„±í™”**:
```javascript
// /auth/registerë¥¼ /auth/join-centerë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
router.get('/auth/register', (req, res) => {
  res.redirect('/auth/join-center');
});
```

#### 3.1.3 í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì… ë¡œì§ êµ¬í˜„

**íŒŒì¼**: `lib_login/auth.js` - ì‹ ê·œ API ì¶”ê°€

```javascript
// ì´ˆëŒ€ ì½”ë“œ í™•ì¸ API (ì‹ ê·œ)
router.post('/auth/api/verify-invite-code', async (req, res) => {
  const title = 'ì„¼í„° ê°€ì…';

  const html = template.HTML(title, `
    <h2>ì„¼í„° ì´ˆëŒ€ ì½”ë“œë¡œ ê°€ì…</h2>
    <form id="joinCenterForm">
      <!-- Step 1: ì„¼í„° ì½”ë“œ ì…ë ¥ -->
      <div id="step1">
        <input type="text" name="inviteCode" placeholder="ì´ˆëŒ€ ì½”ë“œ (8ìë¦¬)" maxlength="8" required>
        <button type="button" onclick="verifyCode()">ì½”ë“œ í™•ì¸</button>
      </div>

      <!-- Step 2: íšŒì› ì •ë³´ ì…ë ¥ (ì½”ë“œ í™•ì¸ í›„ í‘œì‹œ) -->
      <div id="step2" style="display:none">
        <p>ì„¼í„°: <span id="centerName"></span></p>
        <input type="text" name="userID" placeholder="ì•„ì´ë””" required>
        <input type="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
        <input type="email" name="email" placeholder="ì´ë©”ì¼">
        <input type="text" name="name" placeholder="ì´ë¦„" required>
        <input type="submit" value="ê°€ì…í•˜ê¸°">
      </div>
    </form>
  `);

  res.send(html);
});

// ì´ˆëŒ€ ì½”ë“œ í™•ì¸ API
router.post('/auth/api/verify-invite-code', async (req, res) => {
  const { code } = req.body;

  const inviteCode = await queryDatabase(`
    SELECT ci.*, c.center_name
    FROM center_invite_codes ci
    JOIN Centers c ON ci.center_id = c.id
    WHERE ci.code = ?
      AND (ci.max_uses IS NULL OR ci.current_uses < ci.max_uses)
      AND (ci.expires_at IS NULL OR ci.expires_at > NOW())
  `, [code]);

  if (inviteCode.length === 0) {
    return res.status(404).json({ success: false, message: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ˆëŒ€ ì½”ë“œì…ë‹ˆë‹¤.' });
  }

  res.json({
    success: true,
    centerName: inviteCode[0].center_name,
    centerId: inviteCode[0].center_id
  });
});

// ì´ˆëŒ€ ì½”ë“œë¡œ íšŒì›ê°€ì… ì²˜ë¦¬
router.post('/auth/join-center', async (req, res) => {
  const { inviteCode, userID, password, email, name } = req.body;

  // 1. ì´ˆëŒ€ ì½”ë“œ ì¬í™•ì¸
  const [code] = await queryDatabase(`
    SELECT center_id FROM center_invite_codes
    WHERE code = ? AND (max_uses IS NULL OR current_uses < max_uses)
  `, [inviteCode]);

  if (!code) {
    return res.status(400).json({ error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ˆëŒ€ ì½”ë“œì…ë‹ˆë‹¤.' });
  }

  // 2. ì‚¬ìš©ì ìƒì„± (account_type='center_student')
  const hashedPassword = await bcrypt.hash(password, 10);

  await queryDatabase(`
    INSERT INTO Users
    (userID, password, email, name, centerID, role, account_type, storage_limit_bytes, blog_post_limit)
    VALUES (?, ?, ?, ?, ?, 'student', 'center_student', 2147483648, 999999)
  `, [userID, hashedPassword, email, name, code.center_id]);

  // 3. ì´ˆëŒ€ ì½”ë“œ ì‚¬ìš© íšŸìˆ˜ ì¦ê°€
  await queryDatabase(`
    UPDATE center_invite_codes
    SET current_uses = current_uses + 1
    WHERE code = ?
  `, [inviteCode]);

  res.json({ success: true, message: 'ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' });
});
```

#### 3.1.4 ë¡œê·¸ì¸ í˜ì´ì§€ ë§í¬ ìˆ˜ì •

**íŒŒì¼**: `lib_login/auth.js` - GET /auth/login (Line 78)

**í˜„ì¬**:
```html
<a href="/auth/register">íšŒì›ê°€ì…</a>
```

**ìˆ˜ì • í›„**:
```html
<a href="/auth/register">ì„¼í„° í•™ìƒ ê°€ì…</a> |
<a href="/auth/register-center">ì„¼í„° ê°œì„¤</a>
```

**ì°¸ê³ **: Pong2 ê°€ì…ì€ ë³„ë„ í”„ë¡ íŠ¸ì—”ë“œ(pong2.app)ì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì´ ë¡œê·¸ì¸ í˜ì´ì§€ì— ë§í¬ ë¶ˆí•„ìš”

---

### Phase 2: ê²°ì œ ì‹œìŠ¤í…œ êµ¬í˜„ (2ì£¼)

#### 3.2.1 Toss Payments ì—°ë™ ì¤€ë¹„

**í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€** (`.env`):
```bash
# Toss Payments
TOSS_CLIENT_KEY=test_ck_...  # ê°œë°œìš©
TOSS_SECRET_KEY=test_sk_...  # ê°œë°œìš©
TOSS_SUCCESS_URL=https://app.codingnplay.co.kr/subscription/success
TOSS_FAIL_URL=https://app.codingnplay.co.kr/subscription/fail
```

**npm íŒ¨í‚¤ì§€ ì„¤ì¹˜**:
```bash
npm install @tosspayments/payment-sdk
```

#### 3.2.2 í”Œëœ ì„ íƒ í˜ì´ì§€

**íŒŒì¼**: `routes/subscriptionRouter.js` (ì‹ ê·œ ìƒì„±)

```javascript
const express = require('express');
const router = express.Router();
const { authenticateUser } = require('../lib_login/authMiddleware');
const { requireCenterAdmin } = require('../lib_login/accessControl');
const { queryDatabase } = require('../lib_login/db');

// í”Œëœ ì„ íƒ í˜ì´ì§€
router.get('/plans', authenticateUser, requireCenterAdmin, async (req, res) => {
  const centerId = req.session.centerID;

  // í˜„ì¬ ì„¼í„° êµ¬ë… ì •ë³´ ì¡°íšŒ
  const [subscription] = await queryDatabase(`
    SELECT plan_type, status, trial_ends_at, next_billing_date, storage_limit_bytes
    FROM center_subscriptions
    WHERE center_id = ?
  `, [centerId]);

  res.render('subscription/plans', {
    currentPlan: subscription || { plan_type: 'trial', status: 'trial' },
    plans: {
      standard: {
        name: 'Standard',
        price: 110000,
        storage: '30GB',
        students: 'ë¬´ì œí•œ',
        features: [
          'êµìœ¡ ì½˜í…ì¸  ì „ì²´ ì ‘ê·¼',
          'ì„¼í„° í´ë¼ìš°ë“œë³´ë“œ',
          'í•™ìƒ ì§„ë„ ê´€ë¦¬',
          'Teacher Dashboard',
          'ì´ˆëŒ€ ì½”ë“œ ë¬´ì œí•œ'
        ]
      },
      premium: {
        name: 'Premium',
        price: 220000,
        storage: '100GB',
        students: 'ë¬´ì œí•œ',
        features: [
          'Standard í”Œëœ ì „ì²´ ê¸°ëŠ¥',
          'í™”ì´íŠ¸ë¼ë²¨',
          'ì»¤ìŠ¤í…€ ë„ë©”ì¸',
          'API ì ‘ê·¼',
          '1:1 ê¸°ìˆ  ì§€ì›'
        ]
      }
    }
  });
});
```

**íŒŒì¼**: `views/subscription/plans.ejs` (ì‹ ê·œ ìƒì„±)

```html
<!DOCTYPE html>
<html>
<head>
  <title>í”Œëœ ì„ íƒ</title>
  <link rel="stylesheet" href="/css/subscription.css">
</head>
<body>
  <div class="plans-container">
    <h1>ì„¼í„° êµ¬ë… í”Œëœ</h1>

    <% if (currentPlan.status === 'trial') { %>
    <div class="trial-notice">
      ğŸ‰ 14ì¼ ë¬´ë£Œ ì²´í—˜ ì¤‘ì…ë‹ˆë‹¤!
      <br>ì²´í—˜ ì¢…ë£Œì¼: <%= new Date(currentPlan.trial_ends_at).toLocaleDateString() %>
    </div>
    <% } %>

    <div class="plan-cards">
      <!-- Standard Plan -->
      <div class="plan-card">
        <h2>Standard</h2>
        <div class="price">â‚©110,000<span>/ì›”</span></div>
        <ul class="features">
          <li>âœ… êµìœ¡ ì½˜í…ì¸  ì „ì²´ ì ‘ê·¼</li>
          <li>âœ… ì„¼í„° í´ë¼ìš°ë“œë³´ë“œ</li>
          <li>âœ… í•™ìƒ ì§„ë„ ê´€ë¦¬</li>
          <li>âœ… 30GB ì €ì¥ì†Œ</li>
          <li>âœ… í•™ìƒ ìˆ˜ ë¬´ì œí•œ</li>
        </ul>
        <button class="subscribe-btn" onclick="subscribe('standard')">
          <%= currentPlan.plan_type === 'standard' ? 'í˜„ì¬ í”Œëœ' : 'êµ¬ë…í•˜ê¸°' %>
        </button>
      </div>

      <!-- Premium Plan -->
      <div class="plan-card premium">
        <div class="badge">ì¶”ì²œ</div>
        <h2>Premium</h2>
        <div class="price">â‚©220,000<span>/ì›”</span></div>
        <ul class="features">
          <li>âœ… Standard ì „ì²´ ê¸°ëŠ¥</li>
          <li>âœ… 100GB ì €ì¥ì†Œ</li>
          <li>âœ… í™”ì´íŠ¸ë¼ë²¨</li>
          <li>âœ… API ì ‘ê·¼</li>
          <li>âœ… 1:1 ê¸°ìˆ  ì§€ì›</li>
        </ul>
        <button class="subscribe-btn" onclick="subscribe('premium')">
          <%= currentPlan.plan_type === 'premium' ? 'í˜„ì¬ í”Œëœ' : 'ì—…ê·¸ë ˆì´ë“œ' %>
        </button>
      </div>
    </div>
  </div>

  <script>
    function subscribe(planType) {
      location.href = `/subscription/checkout?plan=${planType}`;
    }
  </script>
</body>
</html>
```

#### 3.2.3 ê²°ì œ í˜ì´ì§€

**íŒŒì¼**: `routes/subscriptionRouter.js` - ì¶”ê°€

```javascript
// ê²°ì œ í˜ì´ì§€
router.get('/checkout', authenticateUser, requireCenterAdmin, async (req, res) => {
  const planType = req.query.plan;
  const centerId = req.session.centerID;
  const userID = req.session.userID;

  if (!['standard', 'premium'].includes(planType)) {
    return res.status(400).send('ì˜ëª»ëœ í”Œëœì…ë‹ˆë‹¤.');
  }

  const plans = {
    standard: { price: 110000, name: 'Standard' },
    premium: { price: 220000, name: 'Premium' }
  };

  const plan = plans[planType];

  // ì£¼ë¬¸ ID ìƒì„± (planType_centerID_timestamp)
  const orderId = `${planType}_${centerId}_${Date.now()}`;
  const orderName = `ì„¼í„° êµ¬ë… - ${plan.name}`;

  res.render('subscription/checkout', {
    planType,
    planName: plan.name,
    amount: plan.price,
    orderId,
    orderName,
    customerEmail: req.session.email,
    customerName: req.session.name,
    tossClientKey: process.env.TOSS_CLIENT_KEY
  });
});
```

**íŒŒì¼**: `views/subscription/checkout.ejs` (ì‹ ê·œ ìƒì„±)

```html
<!DOCTYPE html>
<html>
<head>
  <title>ê²°ì œí•˜ê¸°</title>
  <script src="https://js.tosspayments.com/v1/payment"></script>
</head>
<body>
  <div class="checkout-container">
    <h1>ê²°ì œ ì •ë³´</h1>

    <div class="order-summary">
      <h3>ì£¼ë¬¸ ë‚´ìš©</h3>
      <p>í”Œëœ: <%= planName %></p>
      <p>ê¸ˆì•¡: â‚©<%= amount.toLocaleString() %></p>
      <p>ì£¼ê¸°: ë§¤ì›” ìë™ ê²°ì œ</p>
    </div>

    <button id="payment-button">ê²°ì œí•˜ê¸°</button>
  </div>

  <script>
    const clientKey = '<%= tossClientKey %>';
    const tossPayments = TossPayments(clientKey);

    document.getElementById('payment-button').addEventListener('click', function() {
      tossPayments.requestPayment('ì¹´ë“œ', {
        amount: <%= amount %>,
        orderId: '<%= orderId %>',
        orderName: '<%= orderName %>',
        customerName: '<%= customerName %>',
        customerEmail: '<%= customerEmail %>',
        successUrl: '<%= process.env.TOSS_SUCCESS_URL %>',
        failUrl: '<%= process.env.TOSS_FAIL_URL %>'
      });
    });
  </script>
</body>
</html>
```

#### 3.2.4 ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨ ì½œë°±

**íŒŒì¼**: `routes/subscriptionRouter.js` - ì¶”ê°€

```javascript
// ê²°ì œ ì„±ê³µ ì½œë°±
router.get('/success', authenticateUser, async (req, res) => {
  const { paymentKey, orderId, amount } = req.query;
  const centerId = req.session.centerID;

  try {
    // Toss Payments APIë¡œ ê²°ì œ ìŠ¹ì¸
    const response = await fetch('https://api.tosspayments.com/v1/payments/confirm', {
      method: 'POST',
      headers: {
        'Authorization': `Basic ${Buffer.from(process.env.TOSS_SECRET_KEY + ':').toString('base64')}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ paymentKey, orderId, amount })
    });

    const payment = await response.json();

    if (payment.status === 'DONE') {
      // orderIdì—ì„œ planType ì¶”ì¶œ (ì˜ˆ: standard_123_1234567890)
      const planType = orderId.split('_')[0];

      // ë‹¤ìŒ ê²°ì œì¼ ê³„ì‚° (1ê°œì›” í›„)
      const nextBillingDate = new Date();
      nextBillingDate.setMonth(nextBillingDate.getMonth() + 1);

      // center_subscriptions ì—…ë°ì´íŠ¸
      await queryDatabase(`
        UPDATE center_subscriptions
        SET plan_type = ?,
            status = 'active',
            storage_limit_bytes = ?,
            price_monthly = ?,
            next_billing_date = ?,
            trial_ends_at = NULL
        WHERE center_id = ?
      `, [
        planType,
        planType === 'premium' ? 107374182400 : 32212254720,  // 100GB or 30GB
        parseInt(amount),
        nextBillingDate,
        centerId
      ]);

      // Payments í…Œì´ë¸”ì— ê¸°ë¡
      await queryDatabase(`
        INSERT INTO Payments
        (centerID, product_name, payment_date, expiry_date, amount, status, payment_key)
        VALUES (?, ?, NOW(), ?, ?, 'completed', ?)
      `, [centerId, `ì„¼í„° êµ¬ë… - ${planType}`, nextBillingDate, amount, paymentKey]);

      res.render('subscription/success', {
        planType,
        amount,
        nextBillingDate: nextBillingDate.toLocaleDateString()
      });
    } else {
      throw new Error('ê²°ì œ ìŠ¹ì¸ ì‹¤íŒ¨');
    }
  } catch (error) {
    console.error('ê²°ì œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
    res.redirect(`/subscription/fail?message=${encodeURIComponent('ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')}`);
  }
});

// ê²°ì œ ì‹¤íŒ¨ ì½œë°±
router.get('/fail', (req, res) => {
  const { code, message } = req.query;
  res.render('subscription/failure', { code, message });
});

module.exports = router;
```

**app.jsì— ë¼ìš°í„° ë“±ë¡**:
```javascript
const subscriptionRouter = require('./routes/subscriptionRouter');
app.use('/subscription', subscriptionRouter);
```

---

### Phase 3: Trial ë§Œë£Œ ì²˜ë¦¬ (1ì£¼)

#### 3.3.1 Cron Job ìƒì„±

**íŒŒì¼**: `lib_cron/trialChecker.js` (ì‹ ê·œ ìƒì„±)

```javascript
const cron = require('node-cron');
const { queryDatabase } = require('../lib_login/db');
const emailService = require('../lib_auth/emailService');

/**
 * ë§¤ì¼ ìì •ì— Trial ë§Œë£Œ ì²´í¬
 */
function startTrialChecker() {
  // ë§¤ì¼ 00:00 ì‹¤í–‰
  cron.schedule('0 0 * * *', async () => {
    console.log('ğŸ” Trial ë§Œë£Œ ì²´í¬ ì‹œì‘:', new Date().toISOString());

    try {
      // 1. ì˜¤ëŠ˜ ë§Œë£Œë˜ëŠ” Trial ì°¾ê¸°
      const expiredTrials = await queryDatabase(`
        SELECT cs.id, cs.center_id, cs.trial_ends_at, c.center_name, c.contact_email
        FROM center_subscriptions cs
        JOIN Centers c ON cs.center_id = c.id
        WHERE cs.status = 'trial'
          AND DATE(cs.trial_ends_at) = CURDATE()
      `);

      for (const trial of expiredTrials) {
        // statusë¥¼ 'suspended'ë¡œ ë³€ê²½
        await queryDatabase(`
          UPDATE center_subscriptions
          SET status = 'suspended'
          WHERE id = ?
        `, [trial.id]);

        console.log(`âŒ Trial ë§Œë£Œ: ${trial.center_name} (ID: ${trial.center_id})`);

        // ë§Œë£Œ ì´ë©”ì¼ ë°œì†¡
        await emailService.sendTrialExpiredEmail(
          trial.contact_email,
          trial.center_name
        );
      }

      // 2. 7ì¼ í›„ ë§Œë£Œ ì˜ˆì • Trial ì°¾ê¸° (ì•Œë¦¼)
      const upcomingExpiry = await queryDatabase(`
        SELECT cs.id, cs.center_id, cs.trial_ends_at, c.center_name, c.contact_email
        FROM center_subscriptions cs
        JOIN Centers c ON cs.center_id = c.id
        WHERE cs.status = 'trial'
          AND DATE(cs.trial_ends_at) = DATE_ADD(CURDATE(), INTERVAL 7 DAY)
      `);

      for (const trial of upcomingExpiry) {
        // 7ì¼ ì „ ì•Œë¦¼ ì´ë©”ì¼
        await emailService.sendTrialExpiryReminderEmail(
          trial.contact_email,
          trial.center_name,
          trial.trial_ends_at
        );

        console.log(`âš ï¸ Trial 7ì¼ ì „ ì•Œë¦¼: ${trial.center_name}`);
      }

      console.log(`âœ… Trial ì²´í¬ ì™„ë£Œ: ë§Œë£Œ ${expiredTrials.length}ê±´, ì•Œë¦¼ ${upcomingExpiry.length}ê±´`);

    } catch (error) {
      console.error('âŒ Trial ì²´í¬ ì˜¤ë¥˜:', error);
    }
  });

  console.log('âœ… Trial ì²´ì»¤ ì‹œì‘ë¨ (ë§¤ì¼ 00:00 ì‹¤í–‰)');
}

module.exports = { startTrialChecker };
```

**app.jsì— Cron ë“±ë¡**:
```javascript
const { startTrialChecker } = require('./lib_cron/trialChecker');

// ì„œë²„ ì‹œì‘ ì‹œ Cron Job ì‹¤í–‰
startTrialChecker();
```

#### 3.3.2 Trial ë§Œë£Œ ì´ë©”ì¼ í…œí”Œë¦¿

**íŒŒì¼**: `lib_auth/emailService.js` - í•¨ìˆ˜ ì¶”ê°€

```javascript
/**
 * Trial ë§Œë£Œ ì´ë©”ì¼ ë°œì†¡
 */
async function sendTrialExpiredEmail(email, centerName) {
  const subject = `[ì½”ë”©ì•¤í”Œë ˆì´] ${centerName} ë¬´ë£Œ ì²´í—˜ ì¢…ë£Œ ì•ˆë‚´`;

  const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2>ë¬´ë£Œ ì²´í—˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h2>

      <p><strong>${centerName}</strong> ì„¼í„°ì˜ 14ì¼ ë¬´ë£Œ ì²´í—˜ ê¸°ê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>

      <div style="background: #fff3cd; padding: 20px; border-radius: 5px; margin: 20px 0;">
        <h3>âš ï¸ í˜„ì¬ ìƒíƒœ</h3>
        <ul>
          <li>êµìœ¡ ì½˜í…ì¸  ì ‘ê·¼ì´ ì œí•œë˜ì—ˆìŠµë‹ˆë‹¤.</li>
          <li>í•™ìƒë“¤ì€ ë¡œê·¸ì¸ì€ ê°€ëŠ¥í•˜ë‚˜ í•™ìŠµ ìë£Œë¥¼ ì´ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
          <li>ë°ì´í„°ëŠ” ì•ˆì „í•˜ê²Œ ë³´ê´€ë˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
        </ul>
      </div>

      <p>
        <strong>ì„œë¹„ìŠ¤ë¥¼ ê³„ì† ì´ìš©í•˜ì‹œë ¤ë©´</strong> ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê²°ì œë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”.
      </p>

      <a href="https://app.codingnplay.co.kr/subscription/plans"
         style="display: inline-block; padding: 15px 30px; background: #4CAF50; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0;">
        ì§€ê¸ˆ êµ¬ë…í•˜ê¸°
      </a>

      <hr style="margin: 30px 0;">

      <h3>Standard í”Œëœ - ì›” â‚©110,000</h3>
      <ul>
        <li>âœ… êµìœ¡ ì½˜í…ì¸  ì „ì²´ ì ‘ê·¼</li>
        <li>âœ… ì„¼í„° í´ë¼ìš°ë“œë³´ë“œ</li>
        <li>âœ… í•™ìƒ ì§„ë„ ê´€ë¦¬</li>
        <li>âœ… 30GB ì €ì¥ì†Œ</li>
        <li>âœ… í•™ìƒ ìˆ˜ ë¬´ì œí•œ</li>
      </ul>

      <p style="color: #666; font-size: 12px;">
        ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ support@codingnplay.co.krë¡œ ì—°ë½ì£¼ì„¸ìš”.
      </p>
    </div>
  `;

  return await sendEmail(email, subject, html);
}

/**
 * Trial 7ì¼ ì „ ì•Œë¦¼ ì´ë©”ì¼
 */
async function sendTrialExpiryReminderEmail(email, centerName, expiryDate) {
  const subject = `[ì½”ë”©ì•¤í”Œë ˆì´] ${centerName} ë¬´ë£Œ ì²´í—˜ 7ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤`;

  const html = `
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
      <h2>ë¬´ë£Œ ì²´í—˜ ì¢…ë£Œê°€ 7ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤</h2>

      <p><strong>${centerName}</strong> ì„¼í„°ì˜ ë¬´ë£Œ ì²´í—˜ì´ ê³§ ì¢…ë£Œë©ë‹ˆë‹¤.</p>

      <div style="background: #e3f2fd; padding: 20px; border-radius: 5px; margin: 20px 0;">
        <h3>ğŸ“… ì¢…ë£Œ ì˜ˆì •ì¼</h3>
        <p style="font-size: 18px; font-weight: bold;">
          ${new Date(expiryDate).toLocaleDateString('ko-KR')}
        </p>
      </div>

      <p>
        ì„œë¹„ìŠ¤ë¥¼ ê³„ì† ì´ìš©í•˜ì‹œë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ êµ¬ë…ì„ ì‹œì‘í•´ì£¼ì„¸ìš”.
      </p>

      <a href="https://app.codingnplay.co.kr/subscription/plans"
         style="display: inline-block; padding: 15px 30px; background: #2196F3; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0;">
        êµ¬ë…í•˜ê¸°
      </a>

      <p style="color: #666;">
        ì²´í—˜ ê¸°ê°„ì´ ì¢…ë£Œë˜ë©´ êµìœ¡ ì½˜í…ì¸  ì ‘ê·¼ì´ ì œí•œë©ë‹ˆë‹¤.<br>
        ë°ì´í„°ëŠ” ì•ˆì „í•˜ê²Œ ë³´ê´€ë˜ë©°, êµ¬ë… í›„ ì¦‰ì‹œ ë³µêµ¬ë©ë‹ˆë‹¤.
      </p>
    </div>
  `;

  return await sendEmail(email, subject, html);
}

module.exports = {
  sendEmail,
  sendVerificationEmail,
  sendCenterWelcomeEmail,
  sendTrialExpiredEmail,
  sendTrialExpiryReminderEmail
};
```

---

## ğŸ“‹ 4. ì „ì²´ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: íšŒì›ê°€ì… í˜ì´ì§€ ì •ë¦¬ ë° í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì… êµ¬í˜„ (1ì£¼)

- [âœ…] **Pong2 ê°€ì… (ì´ë¯¸ ì™„ë£Œ)**
  - [âœ…] ë³„ë„ í”„ë¡ íŠ¸ì—”ë“œ(pong2.app)ì—ì„œ ì²˜ë¦¬
  - [âœ…] API: POST /api/pong2/auth/signup
  - [âœ…] í…Œì´ë¸”: Pong2Users (ë³„ë„)
  - [âœ…] ì¸ì¦: JWT Bearer Token
  - **ìˆ˜ì • ë¶ˆí•„ìš”**

- [ ] **educosmo GET /auth/register ìš©ë„ ë³€ê²½**
  - [ ] `lib_login/auth.js:271` GET /auth/register - í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì…ìœ¼ë¡œ ë³€ê²½
  - [ ] ì´ˆëŒ€ ì½”ë“œ ì…ë ¥ â†’ ì„¼í„° í™•ì¸ â†’ íšŒì›ì •ë³´ ì…ë ¥ UI
  - [ ] ë˜ëŠ” /auth/join-centerë¡œ ê²½ë¡œ ë³€ê²½

- [ ] **í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì… API ì‹ ê·œ ìƒì„±**
  - [ ] POST /auth/api/verify-invite-code - ì½”ë“œ í™•ì¸ API
  - [ ] POST /auth/register ë˜ëŠ” POST /auth/join-center - account_type='center_student' ìë™ ì„¤ì •

- [âœ…] **ì„¼í„° ê°œì„¤ í˜ì´ì§€ (ì´ë¯¸ ì™„ë£Œ)**
  - [âœ…] GET /auth/register-center
  - [âœ…] POST /auth/register-center (SMS ì¸ì¦ í¬í•¨)
  - [âœ…] account_type='center_admin' ìë™ ì„¤ì •
  - [âœ…] Trial 14ì¼ ìë™ ìƒì„±
  - **ìˆ˜ì • ë¶ˆí•„ìš”**

- [ ] **ë¡œê·¸ì¸ í˜ì´ì§€ ë§í¬ ìˆ˜ì •**
  - [ ] `lib_login/auth.js:78` - "ì„¼í„° í•™ìƒ ê°€ì…" | "ì„¼í„° ê°œì„¤" ë§í¬ ì¶”ê°€

- [ ] **í…ŒìŠ¤íŠ¸**
  - [âœ…] Pong2 ê°€ì… â†’ Pong2Users í…Œì´ë¸” í™•ì¸ (ì´ë¯¸ ì‘ë™ ì¤‘)
  - [ ] í•™ìƒ ê°€ì… â†’ account_type='center_student' í™•ì¸
  - [âœ…] ì„¼í„° ê°œì„¤ â†’ account_type='center_admin' + Trial í™•ì¸ (ì´ë¯¸ ì‘ë™ ì¤‘)

### Phase 2: ê²°ì œ ì‹œìŠ¤í…œ êµ¬í˜„ (2ì£¼)

- [ ] **Toss Payments ì—°ë™**
  - [ ] .envì— TOSS_CLIENT_KEY, TOSS_SECRET_KEY ì¶”ê°€
  - [ ] npm install @tosspayments/payment-sdk
  - [ ] Toss Payments ê°œë°œì ì„¼í„°ì—ì„œ API Key ë°œê¸‰

- [ ] **ë¼ìš°í„° ìƒì„±**
  - [ ] `routes/subscriptionRouter.js` ìƒì„±
  - [ ] GET /subscription/plans - í”Œëœ ì„ íƒ í˜ì´ì§€
  - [ ] GET /subscription/checkout - ê²°ì œ í˜ì´ì§€
  - [ ] GET /subscription/success - ê²°ì œ ì„±ê³µ ì½œë°±
  - [ ] GET /subscription/fail - ê²°ì œ ì‹¤íŒ¨ ì½œë°±

- [ ] **ë·° ìƒì„±**
  - [ ] `views/subscription/plans.ejs`
  - [ ] `views/subscription/checkout.ejs`
  - [ ] `views/subscription/success.ejs`
  - [ ] `views/subscription/failure.ejs`

- [ ] **CSS ìŠ¤íƒ€ì¼**
  - [ ] `public/css/subscription.css` ìƒì„±

- [ ] **í…ŒìŠ¤íŠ¸**
  - [ ] Sandbox í™˜ê²½ì—ì„œ ì¹´ë“œ ê²°ì œ í…ŒìŠ¤íŠ¸
  - [ ] ê²°ì œ ì„±ê³µ ì‹œ center_subscriptions ì—…ë°ì´íŠ¸ í™•ì¸
  - [ ] Payments í…Œì´ë¸” ê¸°ë¡ í™•ì¸

### Phase 3: Trial ë§Œë£Œ ì²˜ë¦¬ (1ì£¼)

- [ ] **Cron Job ìƒì„±**
  - [ ] `lib_cron/trialChecker.js` ìƒì„±
  - [ ] ë§¤ì¼ 00:00 Trial ë§Œë£Œ ì²´í¬
  - [ ] Trial ë§Œë£Œ ì‹œ status='suspended'
  - [ ] 7ì¼ ì „ ì•Œë¦¼ ì´ë©”ì¼ ë°œì†¡

- [ ] **ì´ë©”ì¼ í…œí”Œë¦¿**
  - [ ] `lib_auth/emailService.js`ì— í•¨ìˆ˜ ì¶”ê°€
  - [ ] sendTrialExpiredEmail()
  - [ ] sendTrialExpiryReminderEmail()

- [ ] **app.js ë“±ë¡**
  - [ ] startTrialChecker() í˜¸ì¶œ

- [ ] **í…ŒìŠ¤íŠ¸**
  - [ ] Trial ë§Œë£Œì¼ ìˆ˜ë™ ë³€ê²½ í›„ Cron ì‹¤í–‰
  - [ ] ì´ë©”ì¼ ë°œì†¡ í™•ì¸
  - [ ] status='suspended' í™•ì¸

### Phase 4: êµ¬ë… ê´€ë¦¬ UI (1ì£¼)

- [ ] **ì„¼í„° ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ**
  - [ ] GET /center/subscription - êµ¬ë… í˜„í™© í˜ì´ì§€
  - [ ] ë‹¤ìŒ ê²°ì œì¼, í”Œëœ, ì‚¬ìš© ì¤‘ì¸ ì €ì¥ì†Œ í‘œì‹œ
  - [ ] í”Œëœ ì—…ê·¸ë ˆì´ë“œ ë²„íŠ¼

- [ ] **í…ŒìŠ¤íŠ¸ & ë°°í¬**
  - [ ] ì „ì²´ ê¸°ëŠ¥ í†µí•© í…ŒìŠ¤íŠ¸
  - [ ] ì½”ë”©ì•¤í”Œë ˆì´ í”„ëœì°¨ì´ì¦ˆ 50ê°œ Professional ë¬´ë£Œ ì œê³µ
  - [ ] í”„ë¡œë•ì…˜ ë°°í¬

---

## ğŸ¯ 5. ìš°ì„ ìˆœìœ„ ì‘ì—… (ì´ë²ˆ ì£¼)

### Day 1-2: educosmo íšŒì›ê°€ì… í˜ì´ì§€ ìš©ë„ ë³€ê²½

```bash
# âœ… Pong2 ê°€ì…ì€ ì´ë¯¸ ë³„ë„ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì²˜ë¦¬ ì¤‘ - ìˆ˜ì • ë¶ˆí•„ìš”
# âœ… ì„¼í„° ê°œì„¤ì€ ì´ë¯¸ ì™„ë²½íˆ êµ¬í˜„ë¨ (/auth/register-center) - ìˆ˜ì • ë¶ˆí•„ìš”

# 1. GET /auth/registerë¥¼ í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì…ìœ¼ë¡œ ë³€ê²½
# íŒŒì¼: lib_login/auth.js:271

# 2. ë¡œê·¸ì¸ í˜ì´ì§€ ë§í¬ ìˆ˜ì • (Pong2 ë§í¬ ì œê±°, í•™ìƒ ê°€ì… ì¶”ê°€)
# íŒŒì¼: lib_login/auth.js:78
```

### Day 3-4: í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì… API êµ¬í˜„

```bash
# 1. POST /auth/api/verify-invite-code API ì¶”ê°€
# 2. POST /auth/register ìˆ˜ì • (ì´ˆëŒ€ ì½”ë“œ ê¸°ë°˜ íšŒì›ê°€ì…)
#    - account_type='center_student' ìë™ ì„¤ì •
#    - storage_limit_bytes=2GB
#    - blog_post_limit=999999
# íŒŒì¼: lib_login/auth.js (660ì¤„ ì´í›„ ì¶”ê°€)
```

### Day 5-7: ê²°ì œ ì‹œìŠ¤í…œ ê¸°ë³¸ êµ¬ì¡°

```bash
# 1. Toss Payments ê°œë°œì ë“±ë¡ ë° API Key ë°œê¸‰
# 2. routes/subscriptionRouter.js ìƒì„±
# 3. views/subscription/plans.ejs ìƒì„±
# 4. í”Œëœ ì„ íƒ í˜ì´ì§€ í…ŒìŠ¤íŠ¸
```

---

## ğŸ“Š 6. ì˜ˆìƒ ì¼ì • ë° ë¦¬ì†ŒìŠ¤

| Week | Phase | ì‘ì—… ë‚´ìš© | ì‚°ì¶œë¬¼ | ë‹´ë‹¹ |
|------|-------|-----------|--------|------|
| 1ì£¼ì°¨ | Phase 1 | íšŒì›ê°€ì… í˜ì´ì§€ ë¶„ë¦¬ | auth.js ìˆ˜ì • + ì‹ ê·œ ë¼ìš°íŠ¸ | ë°±ì—”ë“œ |
| 2-3ì£¼ì°¨ | Phase 2 | ê²°ì œ ì‹œìŠ¤í…œ êµ¬í˜„ | subscriptionRouter.js + ë·° 4ê°œ | ë°±ì—”ë“œ + í”„ë¡ íŠ¸ |
| 4ì£¼ì°¨ | Phase 3 | Trial ë§Œë£Œ ì²˜ë¦¬ | trialChecker.js + ì´ë©”ì¼ í…œí”Œë¦¿ | ë°±ì—”ë“œ |
| 5ì£¼ì°¨ | Phase 4 | êµ¬ë… ê´€ë¦¬ UI + í…ŒìŠ¤íŠ¸ | ì„¼í„° ëŒ€ì‹œë³´ë“œ + í†µí•© í…ŒìŠ¤íŠ¸ | í’€ìŠ¤íƒ |

**ì´ ì†Œìš” ê¸°ê°„**: 5ì£¼ (1.25ê°œì›”)

---

## ğŸš€ 7. ë°°í¬ ì „ëµ

### 7.1 ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸

```bash
# ë¡œì»¬ í™˜ê²½
NODE_ENV=development npm start

# í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:
1. Pong2 ê°€ì… â†’ êµìœ¡ ì½˜í…ì¸  ì ‘ê·¼ â†’ 403 í™•ì¸
2. í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì… â†’ êµìœ¡ ì½˜í…ì¸  ì ‘ê·¼ â†’ 200 OK
3. ì„¼í„° ê°œì„¤ â†’ SMS ì¸ì¦ â†’ Trial ìƒì„± í™•ì¸
4. ê²°ì œ (Sandbox) â†’ êµ¬ë… í™œì„±í™” í™•ì¸
```

### 7.2 ìŠ¤í…Œì´ì§• ë°°í¬

```bash
# NCP ìŠ¤í…Œì´ì§• ì„œë²„
git checkout staging
git merge main
pm2 restart educosmo-staging

# ë² íƒ€ í…ŒìŠ¤íŠ¸:
# - ì½”ë”©ì•¤í”Œë ˆì´ í”„ëœì°¨ì´ì¦ˆ 3ê°œ ì„¼í„°
# - 2ì£¼ ëª¨ë‹ˆí„°ë§
```

### 7.3 í”„ë¡œë•ì…˜ ë°°í¬ (ì ì§„ì )

```bash
# Step 1: í”„ëœì°¨ì´ì¦ˆ 50ê°œ Professional ë¬´ë£Œ ì œê³µ
UPDATE center_subscriptions
SET plan_type = 'standard',
    status = 'active',
    price_monthly = 0,
    next_billing_date = '2027-12-31'
WHERE center_id IN (SELECT id FROM Centers WHERE center_name LIKE '%ì½”ë”©ì•¤í”Œë ˆì´%');

# Step 2: ì¼ë°˜ í•™ì› ì˜¤í”ˆ (2ì£¼ í›„)
# /subscription/plans í˜ì´ì§€ ê³µê°œ

# Step 3: Toss Payments Production ëª¨ë“œ (1ê°œì›” í›„)
# .env ë³€ê²½: test_ck_... â†’ live_ck_...
```

---

## ğŸ“ 8. ë¬¸ì˜ ë° ì§€ì›

**ê°œë°œíŒ€ ì—°ë½ì²˜**:
- ì´ë©”ì¼: dev@codingnplay.co.kr
- ì „í™”: 070-4337-4337

**Toss Payments ì§€ì›**:
- ê°œë°œì ì„¼í„°: https://developers.tosspayments.com
- ê³ ê°ì„¼í„°: 1544-7772

**ë¬¸ì„œ ë²„ì „**: 1.0
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-01-22
**ë‹¤ìŒ ë¦¬ë·°**: Phase 1 ì™„ë£Œ í›„

---

## ğŸ“Œ 9. í•µì‹¬ ìš”ì•½

### í˜„ì¬ ìƒíƒœ (2026-01-22)

âœ… **êµ¬í˜„ ì™„ë£Œ**:
- account_type êµ¬ë¶„ (pong2, center_student, center_admin)
- **Pong2 ê°€ì…** (ë³„ë„ í”„ë¡ íŠ¸ì—”ë“œ pong2.appì—ì„œ ì™„ì „íˆ ë¶„ë¦¬ ìš´ì˜ ì¤‘)
- ì„¼í„° ê°œì„¤ (SMS ì¸ì¦ í¬í•¨)
- Trial ìë™ ìƒì„± (14ì¼)
- ê¶Œí•œ ì œì–´ ë¯¸ë“¤ì›¨ì–´ (requireEducationAccess, requireCenterUser)
- ì„¼í„° ê´€ë¦¬ API (ì´ˆëŒ€ ì½”ë“œ, í•™ìƒ ê´€ë¦¬)

âŒ **êµ¬í˜„ í•„ìš”**:
- educosmoì˜ GET /auth/register ìš©ë„ ë³€ê²½ (í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì…)
- í•™ìƒ ì´ˆëŒ€ ì½”ë“œ ê°€ì… API (POST /auth/api/verify-invite-code)
- Toss Payments ê²°ì œ ì—°ë™
- Trial ë§Œë£Œ Cron Job
- êµ¬ë… ê´€ë¦¬ UI

### í•µì‹¬ ì°¨ë³„í™”

```
Pong2 (pong2.app):
  â†’ ë¬´ë£Œ, ì»¤ë®¤ë‹ˆí‹° ì „ìš©, êµìœ¡ ì½˜í…ì¸  ì°¨ë‹¨
  â†’ ë³„ë„ í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œì íŠ¸ (JWT ì¸ì¦)
  â†’ íšŒì›ê°€ì…: pong2.app ìì²´ UIì—ì„œ ì²˜ë¦¬

ì„¼í„° (app.codingnplay.co.kr):
  â†’ ìœ ë£Œ (â‚©110,000/ì›”), êµìœ¡ ì½˜í…ì¸  ì „ì²´, ì„¼í„° ê´€ë¦¬ ê¸°ëŠ¥
  â†’ educosmo í”„ë¡œì íŠ¸ (Session ì¸ì¦)
  â†’ íšŒì›ê°€ì…: /auth/register (í•™ìƒ), /auth/register-center (ì„¼í„° ê°œì„¤)
```

### ë‹¤ìŒ ë‹¨ê³„

1. **ì´ë²ˆ ì£¼**: Phase 1 (íšŒì›ê°€ì… í˜ì´ì§€ ë¶„ë¦¬)
2. **ë‹¤ìŒ ì£¼**: Phase 2 ì‹œì‘ (Toss Payments ì—°ë™)
3. **1ê°œì›” í›„**: í”„ë¡œë•ì…˜ ë°°í¬

