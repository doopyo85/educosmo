### Project Summary for ChatGPT Continuation

#### Environment Setup
- **Frontend**: EJS (Embedded JavaScript), CSS (Bootstrap 및 Custom Styling), JavaScript, jQuery
- **Backend**: Node.js with Express.js, Redis for session management, NCP Object Storage for problem storage
- **APIs**: Google Sheets API for dynamic problem loading
- **Authentication**: JWT for user authentication, session cookies for session handling
- **Infrastructure**: NCP (Naver Cloud Platform) - AWS 서비스 모두 종료 및 NCP로 이관 완료

#### Key Variables
- **currentProblemNumber**: Manages the current problem being displayed (1 by default).
- **totalProblems**: Total number of problems available (set to 10 by default).
- **problemData**: Array containing problem details loaded via Google Sheets API.
- **currentExamName**: Stores the currently selected exam for problem loading.
- **spreadsheetId**: Google Sheets ID for fetching menu and problem data.
- **googleApiKey**: API key for Google Sheets API.

#### Application Flow
1. **Page Load (Frontend)**:
   - The page fetches user session data and renders the **header** with username.
   - Google API loads the **menu** and **problem data** dynamically from Google Sheets.
   - The **navigation menu** is rendered with collapsible submenus.
   - A **problem** is loaded into an iframe upon selection, and the **Ace Editor** is initialized for user input.

2. **Problem Navigation**:
   - Users can navigate between problems using "previous" and "next" buttons.
   - **Problem data** is dynamically loaded and displayed in an iframe.
   - The problem's **title** and **details** are updated on selection.

3. **Code Execution**:
   - Users can write code in the **Ace Editor** and click "Run Code" to send the code to the backend.
   - The backend runs the code in a Python environment and returns the output, which is displayed in the **output area**.

4. **Authentication & Session**:
   - The backend checks user session and JWT authentication for protected routes.
   - Session management is handled by Redis, ensuring users remain logged in across requests.

#### Key Files & Components
1. **test.ejs**: Main template rendering the navigation, content, and Ace Editor layout.
2. **test.css**: Handles the overall styling of the page, including layout and responsiveness.
3. **test.js**: Handles Google API initialization, problem loading, menu interaction, and code execution logic with Ace Editor.
4. **server.js**: Node.js backend setup, including session management, API routes, and rendering.
5. **header.js**: Manages user session display and logout functionality.

#### API Routes
- `/get-user-session`: Retrieves the current user session.
- `/run-python`: Executes user-submitted Python code on the server and returns the output.
- `/auth`: Manages user authentication routes like login and logout.

#### Database Schema
**Centers Table**: 센터 관리 테이블
- id (PK): 센터 ID
- center_name: 센터 이름
- contact_name: 담당자 이름
- contact_email: 담당자 이메일
- plan_type: 요금제 (free/basic/premium)
- storage_limit_bytes: 스토리지 제한 (바이트)
- status: 상태 (ACTIVE/INACTIVE/SUSPENDED)
- created_at, updated_at: 생성/수정 시간

**Users Table**: 사용자 테이블
- centerID (FK): Centers 테이블 참조 (ON DELETE SET NULL, ON UPDATE CASCADE)
- role: admin, kinder, school, manager, teacher, student, guest

#### Helper Functions (lib_login/accountHelper.js)
센터 기반 계정 관리를 위한 헬퍼 함수들:

1. **getUserCenter(userID)**: 사용자가 속한 센터 정보 조회
2. **getCenterUsers(centerID, options)**: 센터의 모든 사용자 목록 조회 (role, subscription_status 필터링 가능)
3. **getCenterUserCount(centerID, options)**: 센터의 사용자 수 조회 (필터링 가능)
4. **isUserInCenter(userID, centerID)**: 사용자가 특정 센터에 속해있는지 확인
5. **moveUserToCenter(userID, newCenterID)**: 사용자를 다른 센터로 이동
6. **getCenterStorageUsage(centerID)**: 센터의 스토리지 사용량 계산 (used, limit, percentage 반환)
7. **getCenterActivityLogs(centerID, options)**: 센터의 활동 로그 조회 (limit, actionType, userId 필터링 가능)
8. **getCenterStats(centerID)**: 센터의 종합 통계 정보 조회 (사용자 수, 역할별 분포, 활성 구독, 스토리지, 최근 활동)
9. **getAccessibleCenters(userID, role)**: 사용자 역할에 따른 접근 가능한 센터 목록 조회
   - admin: 모든 ACTIVE 센터 접근 가능
   - kinder/school/manager: 자신의 센터만 접근 가능
   - teacher/student/guest: 센터 목록 접근 불가

#### Key Functionality Enhancements (For Next Steps):
1. **Improve Error Handling**: Implement better error messages when the Google API or problem data fails to load.
2. **Extend Problem Features**: Add features such as problem hints or solution checking within the IDE.
3. **Responsive Design**: Ensure better mobile compatibility, especially for the IDE section.
4. **User Progress**: Track user progress by saving completed problems or submission history in the session.
