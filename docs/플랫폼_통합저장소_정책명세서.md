# í”Œë«í¼ í†µí•© ì €ì¥ì†Œ ì •ì±… ëª…ì„¸ì„œ

> **ë¬¸ì„œ ë²„ì „**: 1.0  
> **ì‘ì„±ì¼**: 2025-12-18  
> **ìƒíƒœ**: ìŠ¹ì¸ë¨  
> **ì ìš© ë²”ìœ„**: Entry, Scratch, Python, AppInventor ë“± ëª¨ë“  ì½”ë”© í”Œë«í¼

---

## ğŸ“‹ ê°œìš”

### ëª©ì 
educodingnplayì˜ ëª¨ë“  ì½”ë”© í”Œë«í¼(Entry, Scratch, Python, AppInventor ë“±)ì—ì„œ ì‚¬ìš©ì íŒŒì¼ ì €ì¥ ì‹œ ì¼ê´€ëœ ì •ì±…ì„ ì ìš©í•˜ì—¬:
1. **ì‚¬ìš©ì ê²½í—˜ í†µì¼** - ë™ì¼í•œ UIì—ì„œ "ë‚´ ì‘í’ˆ" ê´€ë¦¬
2. **ì €ì¥ì†Œ êµ¬ì¡° í‘œì¤€í™”** - S3ì—ì„œ ì‚¬ìš©ì ì¤‘ì‹¬ í´ë” êµ¬ì¡°
3. **ìœ ì§€ë³´ìˆ˜ ê²½ì œì„±** - ê³µí†µ ë¡œì§ ì¬ì‚¬ìš©

### í•µì‹¬ ì›ì¹™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        í†µì¼ ì˜ì—­                             â”‚
â”‚  â€¢ S3 ì €ì¥ ê²½ë¡œ ê·œì¹™                                         â”‚
â”‚  â€¢ API ì‘ë‹µ í˜•ì‹                                             â”‚
â”‚  â€¢ í”„ë¡ íŠ¸ì—”ë“œ UI ì»´í¬ë„ŒíŠ¸                                     â”‚
â”‚  â€¢ ìš©ëŸ‰ ì²´í¬ ë¡œì§ (quotaChecker)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ë¶„ë¦¬ ì˜ì—­                             â”‚
â”‚  â€¢ í”Œë«í¼ë³„ DB í…Œì´ë¸” (ë¶„ì„ ë°ì´í„° íŠ¹í™”)                       â”‚
â”‚  â€¢ í”Œë«í¼ë³„ API ì—”ë“œí¬ì¸íŠ¸                                    â”‚
â”‚  â€¢ í”Œë«í¼ë³„ íŒŒì¼ ì²˜ë¦¬ ë¡œì§ (ENT, SB3, PY ë“±)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ S3 ì €ì¥ ê²½ë¡œ ê·œì¹™ (í•„ìˆ˜ ì¤€ìˆ˜)

### í‘œì¤€ ê²½ë¡œ í˜•ì‹

```
users/{userID}/{platform}/{saveType}/{fileName}
```

| ì„¸ê·¸ë¨¼íŠ¸ | ì„¤ëª… | ì˜ˆì‹œ |
|----------|------|------|
| `userID` | ì‚¬ìš©ì ê³ ìœ  ID | `student001`, `teacher_kim` |
| `platform` | í”Œë«í¼ ì‹ë³„ì | `entry`, `scratch`, `python`, `appinventor` |
| `saveType` | ì €ì¥ ìœ í˜• | `projects`, `autosave`, `submissions` |
| `fileName` | íŒŒì¼ëª… | `my_game_20251218.ent` |

### í”Œë«í¼ë³„ ê²½ë¡œ ì˜ˆì‹œ

```
# Entry í”„ë¡œì íŠ¸
users/student001/entry/projects/my_game_20251218.ent
users/student001/entry/autosave/autosave_latest.ent
users/student001/entry/submissions/final_20251218.ent

# Scratch í”„ë¡œì íŠ¸
users/student001/scratch/projects/animation_20251218.sb3
users/student001/scratch/autosave/autosave_latest.sb3

# Python íŒŒì¼
users/student001/python/projects/calculator.py
users/student001/python/notebooks/data_analysis.ipynb

# AppInventor í”„ë¡œì íŠ¸
users/student001/appinventor/projects/my_app.aia
```

### ì¸ë„¤ì¼ ê²½ë¡œ ê·œì¹™

```
users/{userID}/{platform}/thumbnails/{projectId}_thumb.png
```

---

## ğŸ“¡ API ì‘ë‹µ í˜•ì‹ í‘œì¤€ (í•„ìˆ˜ ì¤€ìˆ˜)

### í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ ì‘ë‹µ

ëª¨ë“  í”Œë«í¼ì˜ `/api/{platform}/projects` ì—”ë“œí¬ì¸íŠ¸ëŠ” ì•„ë˜ í˜•ì‹ì„ ë”°ë¦„:

```json
{
  "success": true,
  "projects": [
    {
      "id": 123,
      "title": "ë‚˜ì˜ ê²Œì„",
      "platform": "entry",
      "saveType": "projects",
      "s3Url": "https://...",
      "thumbnailUrl": "https://...",
      "fileSize": 1024000,
      "fileSizeFormatted": "1 MB",
      "createdAt": "2025-12-18T10:30:00Z",
      "updatedAt": "2025-12-18T15:45:00Z",
      "metadata": {
        "blocksCount": 45,
        "objectsCount": 3
      }
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 45,
    "totalPages": 3
  }
}
```

### í”„ë¡œì íŠ¸ ì €ì¥ ì‘ë‹µ

```json
{
  "success": true,
  "message": "í”„ë¡œì íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "project": {
    "id": 123,
    "title": "ë‚˜ì˜ ê²Œì„",
    "s3Url": "https://...",
    "fileSize": 1024000
  }
}
```

### ì˜¤ë¥˜ ì‘ë‹µ

```json
{
  "success": false,
  "error": "QUOTA_EXCEEDED",
  "message": "ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.",
  "details": {
    "currentUsage": 524288000,
    "limit": 524288000,
    "required": 1048576
  }
}
```

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì •ì±…

### ì›ì¹™: í”Œë«í¼ë³„ í…Œì´ë¸” ë¶„ë¦¬

ê° í”Œë«í¼ì€ **ìì²´ í…Œì´ë¸”**ì„ ì‚¬ìš©í•˜ì—¬ í”Œë«í¼ íŠ¹í™” ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

| í”Œë«í¼ | í…Œì´ë¸”ëª… | íŠ¹í™” í•„ë“œ |
|--------|----------|-----------|
| Entry | `ProjectSubmissions` | blocks_count, sprites_count, complexity_score |
| Scratch | `ScratchProjects` (ì˜ˆì •) | blocks_count, sprites_count |
| Python | `PythonFiles` (ì˜ˆì •) | lines_count, functions_count |
| AppInventor | `AppInventorProjects` (ì˜ˆì •) | screens_count, components_count |

### ê³µí†µ í•„ë“œ (ëª¨ë“  í…Œì´ë¸”ì— í•„ìˆ˜)

```sql
-- ëª¨ë“  í”„ë¡œì íŠ¸ í…Œì´ë¸”ì˜ ê³µí†µ í•„ë“œ
id              INT PRIMARY KEY AUTO_INCREMENT,
user_id         INT NOT NULL,           -- Users.id FK
center_id       INT,                     -- ì„¼í„°ë³„ ê´€ë¦¬ìš©
project_name    VARCHAR(255) NOT NULL,
save_type       ENUM('projects', 'autosave', 'submissions'),
s3_url          VARCHAR(500),
s3_key          VARCHAR(500),           -- S3 ê²½ë¡œ (ì‚­ì œìš©)
file_size_kb    INT,
thumbnail_url   VARCHAR(500),
created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at      TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
is_deleted      BOOLEAN DEFAULT FALSE   -- ì†Œí”„íŠ¸ ì‚­ì œ
```

### ìš©ëŸ‰ ê´€ë¦¬ í…Œì´ë¸” (í†µí•©)

`UserStorageUsage` í…Œì´ë¸”ì—ì„œ **ëª¨ë“  í”Œë«í¼ì˜ ìš©ëŸ‰ì„ í†µí•© ê´€ë¦¬**:

```sql
-- í”Œë«í¼ë³„ ì‚¬ìš©ëŸ‰ ì»¬ëŸ¼
entry_usage         BIGINT DEFAULT 0,
scratch_usage       BIGINT DEFAULT 0,
python_usage        BIGINT DEFAULT 0,
appinventor_usage   BIGINT DEFAULT 0,
total_usage         BIGINT DEFAULT 0    -- ìë™ ê³„ì‚°
```

---

## ğŸ’¾ ìš©ëŸ‰ ê´€ë¦¬ ì •ì±…

### quotaChecker ì—°ë™ (í•„ìˆ˜)

ëª¨ë“  í”Œë«í¼ì˜ ì €ì¥ APIëŠ” `quotaChecker`ë¥¼ í†µí•´ ìš©ëŸ‰ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

```javascript
// ì €ì¥ ì „ ìš©ëŸ‰ ì²´í¬
const canSave = await quotaChecker.canUpload(userId, centerId, fileSize);
if (!canSave.allowed) {
  return res.status(413).json({
    success: false,
    error: 'QUOTA_EXCEEDED',
    message: canSave.message
  });
}

// ì €ì¥ í›„ ì‚¬ìš©ëŸ‰ ì—…ë°ì´íŠ¸
await quotaChecker.increaseUsage(userId, centerId, fileSize, 'entry');

// ì‚­ì œ í›„ ì‚¬ìš©ëŸ‰ ë°˜í™˜
await quotaChecker.decreaseUsage(userId, centerId, fileSize, 'entry');
```

### í”Œëœë³„ ìš©ëŸ‰ ì œí•œ

| í”Œëœ | ì‚¬ìš©ìë‹¹ ìš©ëŸ‰ | ì„¼í„°ë‹¹ ìš©ëŸ‰ |
|------|---------------|-------------|
| Free | 500 MB | 10 GB |
| Basic | 2 GB | 50 GB |
| Pro | 5 GB | 200 GB |
| Enterprise | ë¬´ì œí•œ | 1 TB |

---

## ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ UI ì •ì±…

### í†µí•© "ë‚´ ì‘í’ˆ" ì»´í¬ë„ŒíŠ¸

ëª¨ë“  í”Œë«í¼ì—ì„œ ë™ì¼í•œ UI ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‚ ë‚´ ì‘í’ˆ                                    [ì €ì¥] [ë¶ˆëŸ¬ì˜¤ê¸°] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ì¸ë„¤ì¼   â”‚  â”‚ ì¸ë„¤ì¼   â”‚  â”‚ ì¸ë„¤ì¼   â”‚  â”‚ ì¸ë„¤ì¼   â”‚        â”‚
â”‚  â”‚  ğŸ“¦     â”‚  â”‚  ğŸ“¦     â”‚  â”‚  ğŸ“¦     â”‚  â”‚  ğŸ“¦     â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚ ì œëª©     â”‚  â”‚ ì œëª©     â”‚  â”‚ ì œëª©     â”‚  â”‚ ì œëª©     â”‚        â”‚
â”‚  â”‚ ë‚ ì§œ Â· 1MBâ”‚  â”‚ ë‚ ì§œ Â· 2MBâ”‚  â”‚ ë‚ ì§œ Â· 500KBâ”‚  â”‚ ë‚ ì§œ Â· 3MBâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê³µí†µ UI íŒŒì¼

```
public/js/components/storage/
â”œâ”€â”€ ProjectListModal.js      # ë¶ˆëŸ¬ì˜¤ê¸° ëª¨ë‹¬ (ê³µí†µ)
â”œâ”€â”€ ProjectSaveModal.js      # ì €ì¥ ëª¨ë‹¬ (ê³µí†µ)
â”œâ”€â”€ StorageUsageBar.js       # ìš©ëŸ‰ í‘œì‹œ ë°” (ê³µí†µ)
â””â”€â”€ ProjectCard.js           # í”„ë¡œì íŠ¸ ì¹´ë“œ (ê³µí†µ)
```

### í”Œë«í¼ë³„ ì–´ëŒ‘í„°

ê° í”Œë«í¼ì€ ê³µí†µ UIë¥¼ ì‚¬ìš©í•˜ë˜, **ì–´ëŒ‘í„° íŒ¨í„´**ìœ¼ë¡œ API ì—°ê²°:

```javascript
// entry/js/projectSaver.js
class EntryProjectSaver {
  constructor() {
    this.apiBase = '/entry/api';  // í”Œë«í¼ë³„ API
    this.platform = 'entry';
  }
  
  // ê³µí†µ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
  async getProjects() { /* ... */ }
  async saveProject(data) { /* ... */ }
  async loadProject(id) { /* ... */ }
  async deleteProject(id) { /* ... */ }
}
```

---

## ğŸ”§ ìƒˆ í”Œë«í¼ ì¶”ê°€ ì²´í¬ë¦¬ìŠ¤íŠ¸

ìƒˆë¡œìš´ ì½”ë”© í”Œë«í¼ ì¶”ê°€ ì‹œ ì•„ë˜ í•­ëª©ì„ í™•ì¸í•©ë‹ˆë‹¤.

### í•„ìˆ˜ êµ¬í˜„ í•­ëª©

- [ ] S3 ê²½ë¡œ ê·œì¹™ ì¤€ìˆ˜ (`users/{userID}/{platform}/...`)
- [ ] DB í…Œì´ë¸” ìƒì„± (ê³µí†µ í•„ë“œ í¬í•¨)
- [ ] API ì‘ë‹µ í˜•ì‹ ì¤€ìˆ˜
- [ ] quotaChecker ì—°ë™
- [ ] ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ëª¨ë‹¬ UI ì ìš©
- [ ] ìš©ëŸ‰ í‘œì‹œ UI ì ìš©

### ì„ íƒ êµ¬í˜„ í•­ëª©

- [ ] ìë™ì €ì¥ ê¸°ëŠ¥
- [ ] ì¸ë„¤ì¼ ìë™ ìƒì„±
- [ ] í”„ë¡œì íŠ¸ ë¶„ì„ (ë¸”ë¡ ìˆ˜, ë³µì¡ë„ ë“±)
- [ ] ë²„ì „ ê´€ë¦¬

---

## ğŸ“ ê´€ë ¨ íŒŒì¼

| íŒŒì¼ | ì—­í•  |
|------|------|
| `lib_storage/quotaChecker.js` | ìš©ëŸ‰ ì²´í¬ ë° ì‚¬ìš©ëŸ‰ ê´€ë¦¬ |
| `lib_storage/storagePolicy.js` | í”Œëœë³„ ì •ì±… ì •ì˜ |
| `lib_storage/s3Manager.js` | S3 ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ |
| `routes/api/storageRouter.js` | ìŠ¤í† ë¦¬ì§€ í†µí•© API |

---

## ğŸ“ ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë‚´ìš© |
|------|------|------|
| 2025-12-18 | 1.0 | ìµœì´ˆ ì‘ì„± - Entry/Scratch/Python í†µí•© ì •ì±… ìˆ˜ë¦½ |

---

## ğŸ”— ì°¸ê³  ë¬¸ì„œ

- [S3_ìŠ¤í† ë¦¬ì§€_API_ëª…ì„¸ì„œ.txt](../S3_ìŠ¤í† ë¦¬ì§€_API_ëª…ì„¸ì„œ.txt)
- [DB_í…Œì´ë¸”ëª…ì„¸ì„œ.txt](../DB_í…Œì´ë¸”ëª…ì„¸ì„œ.txt)
- [educodingnplayì»´í¬ë„ŒíŠ¸ì‹œìŠ¤í…œì•„í‚¤í…ì²˜ëª…ì„¸ì„œ.txt](../educodingnplayì»´í¬ë„ŒíŠ¸ì‹œìŠ¤í…œì•„í‚¤í…ì²˜ëª…ì„¸ì„œ.txt)
