# Educosmo ë¬´ë£Œ/ìœ ë£Œ ë¶„ë¦¬ êµ¬í˜„ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2026-01-15
**ëª©ì **: í˜„ì¬ êµ¬í˜„ëœ educosmoë¥¼ ë¬´ë£Œ/ìœ ë£Œ Tierë¡œ ë¶„ë¦¬í•˜ëŠ” êµ¬ì²´ì  ì‹¤í–‰ ê³„íš
**ë‚œì´ë„**: ì¤‘ (ê¸°ì¡´ ì¸í”„ë¼ í™œìš© ê°€ëŠ¥)

---

## ğŸ“‹ í˜„ì¬ êµ¬í˜„ ìƒíƒœ ë¶„ì„

### âœ… ì´ë¯¸ êµ¬í˜„ëœ ê²ƒë“¤ (í™œìš© ê°€ëŠ¥)

#### 1. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
```sql
-- Users í…Œì´ë¸”ì— êµ¬ë… ì •ë³´ ì¡´ì¬
Users.subscription_status (ENUM: active, inactive, expired)
Users.subscription_expiry (DATE)
Users.centerID (FK)

-- Centers í…Œì´ë¸”ì— í”Œëœ ì •ë³´ ì¡´ì¬
Centers.plan_type (VARCHAR 50) - 'free', 'basic', 'pro', 'enterprise'
Centers.storage_limit_bytes (BIGINT)

-- ê²°ì œ ì¶”ì  í…Œì´ë¸” ì¡´ì¬
Payments (userID, centerID, product_name, payment_date, expiry_date, amount, status)

-- ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ëŸ‰ ì¶”ì  ì¡´ì¬
CenterStorageUsage (center_id, plan_type, storage_limit, total_usage)
UserStorageUsage (user_id, center_id, total_usage, entry_usage, scratch_usage...)
```

#### 2. ê¶Œí•œ ì‹œìŠ¤í…œ
```javascript
// lib_login/permissions.json
- Role ì •ì˜: admin, manager, teacher, student, kinder, guest
- Feature ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (PPT_BUTTON, USER_MANAGE, CODE_EXECUTION ë“±)
- Page ê·¸ë£¹ ì •ì˜ (Learning, Management, Special)

// lib_login/authMiddleware.js
- authenticateUser() - JWT & Session ê²€ì¦
- checkRole(allowedRoles) - ì—­í•  ê¸°ë°˜ ì ‘ê·¼
- checkPageAccess(requiredPage) - í˜ì´ì§€ ë ˆë²¨ ê¶Œí•œ
```

#### 3. ìŠ¤í† ë¦¬ì§€ ì •ì±…
```javascript
// lib_storage/storagePolicy.js
STORAGE_PLANS = {
    free: { userLimit: 500MB, centerLimit: 10GB, monthlyPrice: 0 },
    basic: { userLimit: 2GB, centerLimit: 50GB, monthlyPrice: 9,900 },
    pro: { userLimit: 5GB, centerLimit: 200GB, monthlyPrice: 29,900 },
    enterprise: { userLimit: unlimited, centerLimit: 1TB, custom }
}

// lib_storage/quotaChecker.js
- getUserStorageUsage(userId)
- canUpload(userId, centerId, fileSize)
```

#### 4. ì¸ì¦ ì‹œìŠ¤í…œ
```javascript
// lib_login/auth.js (645 lines)
- Login/logout
- ì„¼í„° ë“±ë¡ (register-center)
- JWT ìƒì„± (SSO ì§€ì› - pong2.app)
- ì—­í•  ê¸°ë°˜ ë¦¬ë‹¤ì´ë ‰íŠ¸
```

---

### âŒ êµ¬í˜„ í•„ìš”í•œ ê²ƒë“¤

#### 1. Tier ê¸°ë°˜ Feature Gate
- í˜„ì¬: Role ê¸°ë°˜ë§Œ ì¡´ì¬ (admin, teacher, student)
- í•„ìš”: Tier ê¸°ë°˜ ê¸°ëŠ¥ ì œí•œ (free, professional, enterprise)

#### 2. ë¬´ë£Œ ë¬¸ì œ vs ìœ ë£Œ ì½˜í…ì¸  ë¶„ë¦¬
- í˜„ì¬: ëª¨ë“  ì½˜í…ì¸  ë™ì¼í•˜ê²Œ ì ‘ê·¼
- í•„ìš”: ContentMapì— `is_premium` í•„ë“œ ì¶”ê°€

#### 3. Teacher Dashboard ì ‘ê·¼ ì œì–´
- í˜„ì¬: teacher roleì´ë©´ ì ‘ê·¼ ê°€ëŠ¥
- í•„ìš”: ìœ ë£Œ êµ¬ë… ì„¼í„°ë§Œ ì ‘ê·¼ ê°€ëŠ¥

#### 4. AI ê¸°ëŠ¥ Tier ì œí•œ
- í˜„ì¬: AI ì¶”ì²œ, í˜ë¥´ì†Œë‚˜ ë¶„ì„ ë¯¸êµ¬í˜„
- í•„ìš”: êµ¬í˜„ ì‹œ ìœ ë£Œ ì „ìš©ìœ¼ë¡œ ì„¤ì •

#### 5. ê²°ì œ/êµ¬ë… ê´€ë¦¬ UI
- í˜„ì¬: Payments í…Œì´ë¸”ë§Œ ì¡´ì¬, UI ì—†ìŒ
- í•„ìš”: êµ¬ë… ê´€ë¦¬ í˜ì´ì§€ + Toss Payments ì—°ë™

---

## ğŸ¯ ë¶„ë¦¬ ì „ëµ: 3ë‹¨ê³„ ì ‘ê·¼

### Phase 1: ë°ì´í„° ë ˆì´ì–´ ë¶„ë¦¬ (1ì£¼)
### Phase 2: ë¯¸ë“¤ì›¨ì–´ & ê¶Œí•œ ë ˆì´ì–´ ë¶„ë¦¬ (1ì£¼)
### Phase 3: UI & ê²°ì œ ì—°ë™ (2ì£¼)

---

## ğŸ“¦ Phase 1: ë°ì´í„° ë ˆì´ì–´ ë¶„ë¦¬ (1ì£¼)

### Step 1-1: Centers í…Œì´ë¸” í”Œëœ ì„¤ì •

**ëª©í‘œ**: ê¸°ì¡´ ì„¼í„°ë“¤ì—ê²Œ ê¸°ë³¸ í”Œëœ ë¶€ì—¬

```sql
-- í˜„ì¬ ìƒíƒœ í™•ì¸
SELECT id, center_name, plan_type, storage_limit_bytes
FROM Centers;

-- ì½”ë”©ì•¤í”Œë ˆì´ í”„ëœì°¨ì´ì¦ˆëŠ” Professional ë¬´ë£Œ ì œê³µ
UPDATE Centers
SET plan_type = 'professional',
    storage_limit_bytes = 32212254720  -- 30GB
WHERE center_name LIKE '%ì½”ë”©ì•¤í”Œë ˆì´%'
   OR center_name LIKE '%codingnplay%';

-- ë‚˜ë¨¸ì§€ëŠ” free í”Œëœ
UPDATE Centers
SET plan_type = 'free',
    storage_limit_bytes = 10737418240  -- 10GB
WHERE plan_type IS NULL OR plan_type = '';
```

**íŒŒì¼ ìƒì„±**: `migrations/002_set_default_plans.sql`

---

### Step 1-2: ContentMapì— is_premium í•„ë“œ ì¶”ê°€

**ëª©í‘œ**: ë¬´ë£Œ ë¬¸ì œ vs ìœ ë£Œ ì½˜í…ì¸  êµ¬ë¶„

```sql
-- ContentMap í…Œì´ë¸” ìˆ˜ì •
ALTER TABLE ContentMap
ADD COLUMN is_premium BOOLEAN DEFAULT FALSE COMMENT 'ìœ ë£Œ ì½˜í…ì¸  ì—¬ë¶€',
ADD COLUMN content_tier ENUM('free', 'professional', 'enterprise') DEFAULT 'free' COMMENT 'í•„ìš” Tier',
ADD COLUMN content_category ENUM('problem', 'project', 'curriculum', 'guide') DEFAULT 'problem' COMMENT 'ì½˜í…ì¸  ìœ í˜•';

-- ê¸°ì¡´ ê³µê³µ ë¬¸ì œëŠ” ë¬´ë£Œ
UPDATE ContentMap
SET is_premium = FALSE, content_tier = 'free'
WHERE platform IN ('scratch', 'entry', 'python')
  AND s3_url LIKE '%koi%' OR s3_url LIKE '%usaco%';

-- ìì²´ ì œì‘ í”„ë¦¬ë¯¸ì—„ ì½˜í…ì¸ ëŠ” ìœ ë£Œ
UPDATE ContentMap
SET is_premium = TRUE, content_tier = 'professional'
WHERE content_type IN ('curriculum', 'guide');
```

**íŒŒì¼ ìƒì„±**: `migrations/003_add_premium_content_fields.sql`

---

### Step 1-3: FeatureFlags í…Œì´ë¸” ìƒì„±

**ëª©í‘œ**: Tierë³„ ê¸°ëŠ¥ on/off ê´€ë¦¬

```sql
CREATE TABLE IF NOT EXISTS FeatureFlags (
    id INT AUTO_INCREMENT PRIMARY KEY,
    feature_key VARCHAR(100) NOT NULL UNIQUE COMMENT 'ê¸°ëŠ¥ ì‹ë³„ì',
    feature_name VARCHAR(200) NOT NULL COMMENT 'ê¸°ëŠ¥ ì´ë¦„',
    description TEXT COMMENT 'ê¸°ëŠ¥ ì„¤ëª…',

    -- Tierë³„ í™œì„±í™”
    free_enabled BOOLEAN DEFAULT FALSE,
    professional_enabled BOOLEAN DEFAULT TRUE,
    enterprise_enabled BOOLEAN DEFAULT TRUE,

    -- ì¶”ê°€ ì œí•œ
    requires_teacher_role BOOLEAN DEFAULT FALSE COMMENT 'êµì‚¬ ê¶Œí•œ í•„ìš” ì—¬ë¶€',

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_feature_key (feature_key)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='Tierë³„ ê¸°ëŠ¥ í”Œë˜ê·¸';

-- ê¸°ë³¸ ê¸°ëŠ¥ ì •ì˜
INSERT INTO FeatureFlags (feature_key, feature_name, free_enabled, professional_enabled, enterprise_enabled, requires_teacher_role) VALUES
-- ë¬´ë£Œ ê¸°ëŠ¥
('problem_solving', 'ë¬¸ì œ í’€ì´', TRUE, TRUE, TRUE, FALSE),
('basic_progress', 'ê¸°ë³¸ ì§„ë„ ì¶”ì ', TRUE, TRUE, TRUE, FALSE),
('2d_ct_graph', '2D CT ê·¸ë˜í”„', TRUE, TRUE, TRUE, FALSE),
('gallery_upload', 'ê°¤ëŸ¬ë¦¬ ì—…ë¡œë“œ', TRUE, TRUE, TRUE, FALSE),

-- Professional ì´ìƒ ê¸°ëŠ¥
('teacher_dashboard', 'Teacher Dashboard', FALSE, TRUE, TRUE, TRUE),
('student_reports', 'í•™ìƒ ë¦¬í¬íŠ¸ ìƒì„±', FALSE, TRUE, TRUE, TRUE),
('ai_recommendations', 'AI ë§ì¶¤ ë¬¸ì œ ì¶”ì²œ', FALSE, TRUE, TRUE, FALSE),
('persona_analysis', 'í˜ë¥´ì†Œë‚˜ ë¶„ì„', FALSE, TRUE, TRUE, FALSE),
('learning_roadmap', 'í•™ìŠµ ë¡œë“œë§µ', FALSE, TRUE, TRUE, FALSE),
('parent_reports', 'í•™ë¶€ëª¨ ë¦¬í¬íŠ¸ ìë™ ë°œì†¡', FALSE, TRUE, TRUE, TRUE),

-- Enterprise ì „ìš© ê¸°ëŠ¥
('white_label', 'í™”ì´íŠ¸ë¼ë²¨', FALSE, FALSE, TRUE, TRUE),
('custom_curriculum', 'ë§ì¶¤ ì»¤ë¦¬í˜ëŸ¼', FALSE, FALSE, TRUE, TRUE),
('api_access', 'API ì ‘ê·¼', FALSE, FALSE, TRUE, TRUE),
('advanced_analytics', 'ê³ ê¸‰ ë¶„ì„', FALSE, FALSE, TRUE, TRUE);
```

**íŒŒì¼ ìƒì„±**: `migrations/004_create_feature_flags.sql`

---

### Step 1-4: êµ¬ë… ë§Œë£Œ í™•ì¸ í•¨ìˆ˜

**ëª©í‘œ**: ì„¼í„°ì˜ êµ¬ë… ìƒíƒœ ì‹¤ì‹œê°„ í™•ì¸

```sql
-- í•¨ìˆ˜ ìƒì„±: ì„¼í„° êµ¬ë… ìƒíƒœ í™•ì¸
DELIMITER $$

CREATE FUNCTION IsCenterSubscriptionActive(p_center_id INT)
RETURNS BOOLEAN
DETERMINISTIC
BEGIN
    DECLARE v_plan_type VARCHAR(50);
    DECLARE v_subscription_expiry DATE;
    DECLARE is_active BOOLEAN DEFAULT FALSE;

    SELECT plan_type INTO v_plan_type
    FROM Centers
    WHERE id = p_center_id;

    -- free í”Œëœì€ ë§Œë£Œ ì—†ìŒ
    IF v_plan_type = 'free' THEN
        RETURN FALSE;
    END IF;

    -- ìœ ë£Œ í”Œëœì€ ë§Œë£Œì¼ í™•ì¸
    SELECT subscription_expiry INTO v_subscription_expiry
    FROM Centers
    WHERE id = p_center_id;

    IF v_subscription_expiry IS NULL OR v_subscription_expiry >= CURDATE() THEN
        SET is_active = TRUE;
    END IF;

    RETURN is_active;
END$$

DELIMITER ;
```

**íŒŒì¼ ìƒì„±**: `migrations/005_subscription_functions.sql`

---

## ğŸ” Phase 2: ë¯¸ë“¤ì›¨ì–´ & ê¶Œí•œ ë ˆì´ì–´ (1ì£¼)

### Step 2-1: Tier ì²´í¬ ë¯¸ë“¤ì›¨ì–´ ìƒì„±

**íŒŒì¼**: `lib_login/tierMiddleware.js`

```javascript
const db = require('./db');

/**
 * ì„¼í„°ì˜ í”Œëœ íƒ€ì… ê°€ì ¸ì˜¤ê¸°
 */
async function getCenterPlan(centerId) {
    const query = `
        SELECT plan_type, subscription_expiry, status
        FROM Centers
        WHERE id = ?
    `;
    const [rows] = await db.query(query, [centerId]);

    if (rows.length === 0) {
        throw new Error('ì„¼í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    }

    const center = rows[0];

    // êµ¬ë… ë§Œë£Œ í™•ì¸
    if (center.plan_type !== 'free' && center.subscription_expiry) {
        const isExpired = new Date(center.subscription_expiry) < new Date();
        if (isExpired) {
            return { plan_type: 'free', expired: true };
        }
    }

    return { plan_type: center.plan_type, expired: false };
}

/**
 * Tier ìš”êµ¬ì‚¬í•­ í™•ì¸ ë¯¸ë“¤ì›¨ì–´
 * @param {string[]} requiredTiers - í—ˆìš©ë˜ëŠ” í”Œëœ ['professional', 'enterprise']
 */
function requireTier(requiredTiers) {
    return async (req, res, next) => {
        try {
            const centerId = req.session.centerID;

            if (!centerId) {
                return res.status(403).render('403', {
                    message: 'ì„¼í„°ì— ì†Œì†ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.'
                });
            }

            const { plan_type, expired } = await getCenterPlan(centerId);

            // ë§Œë£Œëœ ê²½ìš°
            if (expired) {
                return res.status(402).render('subscription-expired', {
                    message: 'êµ¬ë…ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê°±ì‹ í•´ì£¼ì„¸ìš”.',
                    center_id: centerId
                });
            }

            // Tier í™•ì¸
            if (!requiredTiers.includes(plan_type)) {
                return res.status(403).render('upgrade-required', {
                    message: 'ì´ ê¸°ëŠ¥ì€ ìœ ë£Œ í”Œëœì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                    required_tier: requiredTiers,
                    current_tier: plan_type
                });
            }

            // Tier ì •ë³´ë¥¼ reqì— ì¶”ê°€
            req.centerTier = plan_type;
            next();

        } catch (error) {
            console.error('Tier í™•ì¸ ì˜¤ë¥˜:', error);
            res.status(500).render('error', { message: 'ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' });
        }
    };
}

/**
 * ê¸°ëŠ¥ í”Œë˜ê·¸ í™•ì¸ ë¯¸ë“¤ì›¨ì–´
 * @param {string} featureKey - ê¸°ëŠ¥ ì‹ë³„ì (ì˜ˆ: 'teacher_dashboard')
 */
function requireFeature(featureKey) {
    return async (req, res, next) => {
        try {
            const centerId = req.session.centerID;
            const userRole = req.session.role;

            if (!centerId) {
                return res.status(403).render('403', {
                    message: 'ì„¼í„°ì— ì†Œì†ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.'
                });
            }

            // ì„¼í„° í”Œëœ ì¡°íšŒ
            const { plan_type } = await getCenterPlan(centerId);

            // ê¸°ëŠ¥ í”Œë˜ê·¸ ì¡°íšŒ
            const query = `
                SELECT
                    free_enabled,
                    professional_enabled,
                    enterprise_enabled,
                    requires_teacher_role
                FROM FeatureFlags
                WHERE feature_key = ?
            `;
            const [rows] = await db.query(query, [featureKey]);

            if (rows.length === 0) {
                // ê¸°ëŠ¥ í”Œë˜ê·¸ ì—†ìœ¼ë©´ ê¸°ë³¸ í—ˆìš©
                console.warn(`ê¸°ëŠ¥ í”Œë˜ê·¸ ì—†ìŒ: ${featureKey}`);
                return next();
            }

            const feature = rows[0];

            // Tierë³„ í™œì„±í™” í™•ì¸
            let isEnabled = false;
            if (plan_type === 'free') isEnabled = feature.free_enabled;
            else if (plan_type === 'professional') isEnabled = feature.professional_enabled;
            else if (plan_type === 'enterprise') isEnabled = feature.enterprise_enabled;

            if (!isEnabled) {
                return res.status(403).render('upgrade-required', {
                    message: 'ì´ ê¸°ëŠ¥ì€ ìœ ë£Œ í”Œëœì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                    feature_name: featureKey,
                    current_tier: plan_type
                });
            }

            // êµì‚¬ ê¶Œí•œ í™•ì¸
            if (feature.requires_teacher_role) {
                const teacherRoles = ['teacher', 'manager', 'admin'];
                if (!teacherRoles.includes(userRole)) {
                    return res.status(403).render('403', {
                        message: 'ì´ ê¸°ëŠ¥ì€ êµì‚¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.'
                    });
                }
            }

            next();

        } catch (error) {
            console.error('ê¸°ëŠ¥ í”Œë˜ê·¸ í™•ì¸ ì˜¤ë¥˜:', error);
            res.status(500).render('error', { message: 'ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' });
        }
    };
}

/**
 * í”„ë¦¬ë¯¸ì—„ ì½˜í…ì¸  ì ‘ê·¼ í™•ì¸
 */
async function canAccessContent(centerId, contentId) {
    try {
        const { plan_type } = await getCenterPlan(centerId);

        // ì½˜í…ì¸  Tier í™•ì¸
        const query = `
            SELECT is_premium, content_tier
            FROM ContentMap
            WHERE id = ?
        `;
        const [rows] = await db.query(query, [contentId]);

        if (rows.length === 0) {
            return { allowed: false, reason: 'ì½˜í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' };
        }

        const content = rows[0];

        // ë¬´ë£Œ ì½˜í…ì¸ ëŠ” ëª¨ë‘ ì ‘ê·¼ ê°€ëŠ¥
        if (!content.is_premium) {
            return { allowed: true };
        }

        // Tier ë¹„êµ
        const tierHierarchy = { free: 0, professional: 1, enterprise: 2 };
        const userTierLevel = tierHierarchy[plan_type] || 0;
        const contentTierLevel = tierHierarchy[content.content_tier] || 1;

        if (userTierLevel >= contentTierLevel) {
            return { allowed: true };
        } else {
            return {
                allowed: false,
                reason: 'ìœ ë£Œ ì½˜í…ì¸ ì…ë‹ˆë‹¤.',
                required_tier: content.content_tier
            };
        }

    } catch (error) {
        console.error('ì½˜í…ì¸  ì ‘ê·¼ í™•ì¸ ì˜¤ë¥˜:', error);
        return { allowed: false, reason: 'ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ' };
    }
}

module.exports = {
    getCenterPlan,
    requireTier,
    requireFeature,
    canAccessContent
};
```

---

### Step 2-2: ë¼ìš°í„°ì— Tier ë¯¸ë“¤ì›¨ì–´ ì ìš©

#### teacherRouter.js ìˆ˜ì •

```javascript
const express = require('express');
const router = express.Router();
const { authenticateUser, checkRole } = require('../lib_login/authMiddleware');
const { requireFeature } = require('../lib_login/tierMiddleware');

// Teacher Dashboard - Professional ì´ìƒ í•„ìš”
router.get('/dashboard',
    authenticateUser,
    checkRole(['teacher', 'manager', 'admin']),
    requireFeature('teacher_dashboard'),  // ğŸ†• ì¶”ê°€
    (req, res) => {
        res.render('teacher/dashboard');
    }
);

// í•™ìƒ ì§„ë„ ê´€ë¦¬ - Professional ì´ìƒ í•„ìš”
router.get('/student-progress',
    authenticateUser,
    checkRole(['teacher', 'manager', 'admin']),
    requireFeature('teacher_dashboard'),  // ğŸ†• ì¶”ê°€
    async (req, res) => {
        // ê¸°ì¡´ ë¡œì§...
    }
);

// í•™ë¶€ëª¨ ë¦¬í¬íŠ¸ - Professional ì´ìƒ í•„ìš”
router.post('/api/send-parent-report/:userId',
    authenticateUser,
    checkRole(['teacher', 'manager', 'admin']),
    requireFeature('parent_reports'),  // ğŸ†• ì¶”ê°€
    async (req, res) => {
        // í•™ë¶€ëª¨ ë¦¬í¬íŠ¸ ë°œì†¡ ë¡œì§
    }
);

module.exports = router;
```

#### myUniverseRouter.js ìˆ˜ì •

```javascript
const express = require('express');
const router = express.Router();
const { authenticateUser } = require('../lib_login/authMiddleware');
const { requireFeature } = require('../lib_login/tierMiddleware');

// CT Connectome - ê¸°ë³¸ ê¸°ëŠ¥ (ë¬´ë£Œ)
router.get('/connectome/:userId',
    authenticateUser,
    async (req, res) => {
        // 2D ë²„ì „ì€ ë¬´ë£Œ
        res.render('my-universe/connectome-2d');
    }
);

// 3D Galaxy - Professional ì´ìƒ í•„ìš”
router.get('/galaxy/:userId',
    authenticateUser,
    requireFeature('persona_analysis'),  // ğŸ†• ì¶”ê°€
    async (req, res) => {
        res.render('my-universe/galaxy-3d');
    }
);

// í˜ë¥´ì†Œë‚˜ ë¶„ì„ - Professional ì´ìƒ í•„ìš”
router.get('/persona/:userId',
    authenticateUser,
    requireFeature('persona_analysis'),  // ğŸ†• ì¶”ê°€
    async (req, res) => {
        // í˜ë¥´ì†Œë‚˜ ë¶„ì„ ë¡œì§
    }
);

// í•™ìŠµ ë¡œë“œë§µ - Professional ì´ìƒ í•„ìš”
router.get('/roadmap/:userId',
    authenticateUser,
    requireFeature('learning_roadmap'),  // ğŸ†• ì¶”ê°€
    async (req, res) => {
        // ë¡œë“œë§µ ì¶”ì²œ ë¡œì§
    }
);

module.exports = router;
```

#### learningRouter.js ìˆ˜ì • (ì½˜í…ì¸  ì ‘ê·¼ ì œì–´)

```javascript
const express = require('express');
const router = express.Router();
const { authenticateUser } = require('../lib_login/authMiddleware');
const { canAccessContent } = require('../lib_login/tierMiddleware');

// ì½˜í…ì¸  ë¡œë“œ ì‹œ Tier í™•ì¸
router.get('/content/:contentId',
    authenticateUser,
    async (req, res) => {
        const contentId = req.params.contentId;
        const centerId = req.session.centerID;

        // ì½˜í…ì¸  ì ‘ê·¼ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        const access = await canAccessContent(centerId, contentId);

        if (!access.allowed) {
            return res.status(403).render('upgrade-required', {
                message: access.reason,
                required_tier: access.required_tier
            });
        }

        // ì½˜í…ì¸  ë¡œë“œ
        // ê¸°ì¡´ ë¡œì§...
    }
);

module.exports = router;
```

---

### Step 2-3: ì—…ê·¸ë ˆì´ë“œ í•„ìš” í˜ì´ì§€ ìƒì„±

**íŒŒì¼**: `views/upgrade-required.ejs`

```html
<!DOCTYPE html>
<html>
<head>
    <title>ì—…ê·¸ë ˆì´ë“œ í•„ìš”</title>
    <style>
        .upgrade-container {
            max-width: 600px;
            margin: 100px auto;
            text-align: center;
            padding: 40px;
            border: 2px solid #ffa500;
            border-radius: 10px;
        }
        .upgrade-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        .upgrade-message {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .current-tier {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }
        .upgrade-button {
            padding: 15px 40px;
            font-size: 18px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .feature-list {
            text-align: left;
            margin: 30px auto;
            max-width: 400px;
        }
        .feature-item {
            padding: 10px;
            margin: 5px 0;
            background: #f5f5f5;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="upgrade-container">
        <div class="upgrade-icon">ğŸ”’</div>
        <div class="upgrade-message"><%= message || 'ì´ ê¸°ëŠ¥ì€ ìœ ë£Œ í”Œëœì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.' %></div>
        <div class="current-tier">
            í˜„ì¬ í”Œëœ: <strong><%= current_tier %></strong>
            <% if (required_tier) { %>
                â†’ í•„ìš” í”Œëœ: <strong><%= required_tier %></strong>
            <% } %>
        </div>

        <div class="feature-list">
            <h3>Professional í”Œëœ í˜œíƒ</h3>
            <div class="feature-item">âœ… Teacher Dashboard</div>
            <div class="feature-item">âœ… AI ë§ì¶¤ ë¬¸ì œ ì¶”ì²œ</div>
            <div class="feature-item">âœ… í˜ë¥´ì†Œë‚˜ ë¶„ì„</div>
            <div class="feature-item">âœ… í•™ë¶€ëª¨ ë¦¬í¬íŠ¸ ìë™ ë°œì†¡</div>
            <div class="feature-item">âœ… ì›” 1íšŒ ê°•ì‚¬ êµìœ¡</div>
            <div class="feature-item">âœ… í•™ìƒ 30ëª…ê¹Œì§€</div>
        </div>

        <button class="upgrade-button" onclick="location.href='/subscription/plans'">
            í”Œëœ ì—…ê·¸ë ˆì´ë“œí•˜ê¸°
        </button>

        <div style="margin-top: 20px;">
            <a href="/">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>
</body>
</html>
```

---

## ğŸ’³ Phase 3: UI & ê²°ì œ ì—°ë™ (2ì£¼)

### Step 3-1: í”Œëœ ì„ íƒ í˜ì´ì§€

**íŒŒì¼**: `views/subscription/plans.ejs`

```html
<!DOCTYPE html>
<html>
<head>
    <title>í”Œëœ ì„ íƒ</title>
    <style>
        .plans-container {
            max-width: 1200px;
            margin: 50px auto;
            display: flex;
            gap: 30px;
            justify-content: center;
        }
        .plan-card {
            flex: 1;
            max-width: 350px;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: transform 0.3s;
        }
        .plan-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .plan-card.recommended {
            border-color: #4CAF50;
            border-width: 3px;
        }
        .plan-name {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .plan-price {
            font-size: 36px;
            color: #4CAF50;
            margin: 20px 0;
        }
        .plan-features {
            text-align: left;
            margin: 20px 0;
        }
        .feature-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .subscribe-button {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .subscribe-button:hover {
            background: #45a049;
        }
        .recommended-badge {
            background: #4CAF50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <%- include('../partials/header') %>

    <div class="plans-container">
        <!-- Free Plan -->
        <div class="plan-card">
            <div class="plan-name">Free</div>
            <div class="plan-price">â‚©0<span style="font-size:16px">/ì›”</span></div>
            <div class="plan-features">
                <div class="feature-item">âœ… ë¬´ë£Œ ë¬¸ì œ 1,000ê°œ</div>
                <div class="feature-item">âœ… ê¸°ë³¸ ì§„ë„ ì¶”ì </div>
                <div class="feature-item">âœ… 2D CT ê·¸ë˜í”„</div>
                <div class="feature-item">âŒ Teacher Dashboard</div>
                <div class="feature-item">âŒ AI ì¶”ì²œ</div>
                <div class="feature-item">âŒ í˜ë¥´ì†Œë‚˜ ë¶„ì„</div>
            </div>
            <button class="subscribe-button" disabled style="background:#ccc">í˜„ì¬ í”Œëœ</button>
        </div>

        <!-- Professional Plan -->
        <div class="plan-card recommended">
            <div class="recommended-badge">ì¶”ì²œ</div>
            <div class="plan-name">Professional</div>
            <div class="plan-price">â‚©55,000<span style="font-size:16px">/ì›”</span></div>
            <div class="plan-features">
                <div class="feature-item">âœ… Free í”Œëœ ì „ì²´ ê¸°ëŠ¥</div>
                <div class="feature-item">âœ… Teacher Dashboard</div>
                <div class="feature-item">âœ… AI ë§ì¶¤ ë¬¸ì œ ì¶”ì²œ</div>
                <div class="feature-item">âœ… í˜ë¥´ì†Œë‚˜ ë¶„ì„</div>
                <div class="feature-item">âœ… í•™ë¶€ëª¨ ë¦¬í¬íŠ¸ ìë™ ë°œì†¡</div>
                <div class="feature-item">âœ… ì›” 1íšŒ ê°•ì‚¬ êµìœ¡</div>
                <div class="feature-item">âœ… í•™ìƒ 30ëª…ê¹Œì§€</div>
            </div>
            <button class="subscribe-button" onclick="subscribeToPlan('professional')">êµ¬ë…í•˜ê¸°</button>
        </div>

        <!-- Enterprise Plan -->
        <div class="plan-card">
            <div class="plan-name">Enterprise</div>
            <div class="plan-price">â‚©110,000<span style="font-size:16px">/ì›”</span></div>
            <div class="plan-features">
                <div class="feature-item">âœ… Professional í”Œëœ ì „ì²´</div>
                <div class="feature-item">âœ… í™”ì´íŠ¸ë¼ë²¨</div>
                <div class="feature-item">âœ… ì›” 2íšŒ ê°•ì‚¬ êµìœ¡</div>
                <div class="feature-item">âœ… 1:1 ê¸°ìˆ  ì§€ì›</div>
                <div class="feature-item">âœ… ê²½ì˜ ëŒ€ì‹œë³´ë“œ</div>
                <div class="feature-item">âœ… ë§ì¶¤ ì»¤ë¦¬í˜ëŸ¼</div>
                <div class="feature-item">âœ… í•™ìƒ 100ëª…ê¹Œì§€</div>
            </div>
            <button class="subscribe-button" onclick="subscribeToPlan('enterprise')">êµ¬ë…í•˜ê¸°</button>
        </div>
    </div>

    <script>
        function subscribeToPlan(planType) {
            // Toss Payments ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™
            location.href = `/subscription/checkout?plan=${planType}`;
        }
    </script>

    <%- include('../partials/footer') %>
</body>
</html>
```

---

### Step 3-2: ê²°ì œ ë¼ìš°í„° ìƒì„±

**íŒŒì¼**: `routes/subscriptionRouter.js`

```javascript
const express = require('express');
const router = express.Router();
const { authenticateUser, checkRole } = require('../lib_login/authMiddleware');
const db = require('../lib_login/db');

// í”Œëœ ì„ íƒ í˜ì´ì§€
router.get('/plans', authenticateUser, (req, res) => {
    res.render('subscription/plans', {
        current_plan: req.session.centerPlan || 'free'
    });
});

// ê²°ì œ í˜ì´ì§€
router.get('/checkout',
    authenticateUser,
    checkRole(['manager', 'admin']),  // ì„¼í„°ì¥ë§Œ ê²°ì œ ê°€ëŠ¥
    async (req, res) => {
        const planType = req.query.plan;
        const centerId = req.session.centerID;

        if (!planType || !['professional', 'enterprise'].includes(planType)) {
            return res.status(400).send('ì˜ëª»ëœ í”Œëœì…ë‹ˆë‹¤.');
        }

        // í”Œëœ ê°€ê²© ì •ë³´
        const plans = {
            professional: { price: 55000, name: 'Professional', students: 30 },
            enterprise: { price: 110000, name: 'Enterprise', students: 100 }
        };

        const plan = plans[planType];

        res.render('subscription/checkout', {
            plan_type: planType,
            plan_name: plan.name,
            price: plan.price,
            center_id: centerId
        });
    }
);

// Toss Payments ê²°ì œ ì„±ê³µ ì½œë°±
router.get('/success',
    authenticateUser,
    async (req, res) => {
        try {
            const { paymentKey, orderId, amount } = req.query;
            const centerId = req.session.centerID;

            // Toss Payments APIë¡œ ê²°ì œ ìŠ¹ì¸
            const paymentResponse = await confirmTossPayment(paymentKey, orderId, amount);

            if (paymentResponse.status === 'DONE') {
                // DB ì—…ë°ì´íŠ¸: Centers í”Œëœ ë³€ê²½
                const planType = orderId.split('_')[0];  // ì˜ˆ: professional_20260115_123
                const expiryDate = new Date();
                expiryDate.setMonth(expiryDate.getMonth() + 1);  // 1ê°œì›” í›„

                await db.query(`
                    UPDATE Centers
                    SET plan_type = ?,
                        subscription_expiry = ?,
                        status = 'ACTIVE'
                    WHERE id = ?
                `, [planType, expiryDate, centerId]);

                // Payments í…Œì´ë¸”ì— ê¸°ë¡
                await db.query(`
                    INSERT INTO Payments (centerID, product_name, payment_date, expiry_date, amount, status, payment_key)
                    VALUES (?, ?, NOW(), ?, ?, 'completed', ?)
                `, [centerId, planType, expiryDate, amount, paymentKey]);

                res.render('subscription/success', {
                    plan_type: planType,
                    expiry_date: expiryDate
                });
            } else {
                throw new Error('ê²°ì œ ìŠ¹ì¸ ì‹¤íŒ¨');
            }

        } catch (error) {
            console.error('ê²°ì œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
            res.status(500).render('subscription/failure', {
                message: 'ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
            });
        }
    }
);

// Toss Payments ê²°ì œ ì‹¤íŒ¨ ì½œë°±
router.get('/fail', (req, res) => {
    const { code, message } = req.query;
    res.render('subscription/failure', {
        code: code,
        message: message
    });
});

// Toss Payments ê²°ì œ ìŠ¹ì¸ API í˜¸ì¶œ
async function confirmTossPayment(paymentKey, orderId, amount) {
    const fetch = require('node-fetch');
    const secretKey = process.env.TOSS_SECRET_KEY;

    const response = await fetch('https://api.tosspayments.com/v1/payments/confirm', {
        method: 'POST',
        headers: {
            'Authorization': `Basic ${Buffer.from(secretKey + ':').toString('base64')}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            paymentKey: paymentKey,
            orderId: orderId,
            amount: amount
        })
    });

    return await response.json();
}

module.exports = router;
```

**app.jsì— ë¼ìš°í„° ë“±ë¡**:
```javascript
const subscriptionRouter = require('./routes/subscriptionRouter');
app.use('/subscription', subscriptionRouter);
```

---

### Step 3-3: Cron Jobìœ¼ë¡œ êµ¬ë… ë§Œë£Œ ì²´í¬

**íŒŒì¼**: `lib_cron/subscriptionChecker.js`

```javascript
const cron = require('node-cron');
const db = require('../lib_login/db');

/**
 * ë§¤ì¼ ìì •ì— êµ¬ë… ë§Œë£Œ ì²´í¬
 */
function startSubscriptionChecker() {
    cron.schedule('0 0 * * *', async () => {
        console.log('êµ¬ë… ë§Œë£Œ ì²´í¬ ì‹œì‘:', new Date());

        try {
            // ë§Œë£Œëœ êµ¬ë… ì°¾ê¸°
            const query = `
                SELECT id, center_name, plan_type, subscription_expiry
                FROM Centers
                WHERE plan_type IN ('professional', 'enterprise')
                  AND subscription_expiry < CURDATE()
                  AND status = 'ACTIVE'
            `;

            const [expiredCenters] = await db.query(query);

            for (const center of expiredCenters) {
                // í”Œëœì„ freeë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œ
                await db.query(`
                    UPDATE Centers
                    SET plan_type = 'free',
                        status = 'SUSPENDED',
                        storage_limit_bytes = 10737418240  -- 10GB
                    WHERE id = ?
                `, [center.id]);

                console.log(`ì„¼í„° ${center.center_name} (${center.id}) êµ¬ë… ë§Œë£Œ - freeë¡œ ì „í™˜`);

                // TODO: ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡
                // sendSubscriptionExpiryEmail(center);
            }

            console.log(`êµ¬ë… ë§Œë£Œ ì²´í¬ ì™„ë£Œ: ${expiredCenters.length}ê°œ ì„¼í„° ì²˜ë¦¬`);

        } catch (error) {
            console.error('êµ¬ë… ë§Œë£Œ ì²´í¬ ì˜¤ë¥˜:', error);
        }
    });

    console.log('êµ¬ë… ë§Œë£Œ ì²´ì»¤ ì‹œì‘ë¨ (ë§¤ì¼ 00:00 ì‹¤í–‰)');
}

module.exports = { startSubscriptionChecker };
```

**app.jsì— Cron ë“±ë¡**:
```javascript
const { startSubscriptionChecker } = require('./lib_cron/subscriptionChecker');

// ì„œë²„ ì‹œì‘ ì‹œ Cron Job ì‹¤í–‰
startSubscriptionChecker();
```

---

## ğŸ“‹ ì „ì²´ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ë°ì´í„° ë ˆì´ì–´ (1ì£¼)
- [ ] `migrations/002_set_default_plans.sql` - ì„¼í„° í”Œëœ ì´ˆê¸° ì„¤ì •
- [ ] `migrations/003_add_premium_content_fields.sql` - ContentMapì— is_premium í•„ë“œ
- [ ] `migrations/004_create_feature_flags.sql` - FeatureFlags í…Œì´ë¸” ìƒì„±
- [ ] `migrations/005_subscription_functions.sql` - êµ¬ë… ìƒíƒœ í™•ì¸ í•¨ìˆ˜
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

### Phase 2: ë¯¸ë“¤ì›¨ì–´ & ê¶Œí•œ (1ì£¼)
- [ ] `lib_login/tierMiddleware.js` - Tier ì²´í¬ ë¯¸ë“¤ì›¨ì–´ ìƒì„±
- [ ] `routes/teacherRouter.js` - requireFeature ì ìš©
- [ ] `routes/myUniverseRouter.js` - requireFeature ì ìš©
- [ ] `routes/learningRouter.js` - canAccessContent ì ìš©
- [ ] `views/upgrade-required.ejs` - ì—…ê·¸ë ˆì´ë“œ í˜ì´ì§€ ìƒì„±
- [ ] `views/subscription-expired.ejs` - êµ¬ë… ë§Œë£Œ í˜ì´ì§€ ìƒì„±
- [ ] ë¯¸ë“¤ì›¨ì–´ í…ŒìŠ¤íŠ¸ (free ê³„ì •ìœ¼ë¡œ ìœ ë£Œ ê¸°ëŠ¥ ì ‘ê·¼ ì‹œë„)

### Phase 3: UI & ê²°ì œ (2ì£¼)
- [ ] `views/subscription/plans.ejs` - í”Œëœ ì„ íƒ í˜ì´ì§€
- [ ] `views/subscription/checkout.ejs` - ê²°ì œ í˜ì´ì§€
- [ ] `views/subscription/success.ejs` - ê²°ì œ ì„±ê³µ í˜ì´ì§€
- [ ] `views/subscription/failure.ejs` - ê²°ì œ ì‹¤íŒ¨ í˜ì´ì§€
- [ ] `routes/subscriptionRouter.js` - ê²°ì œ ë¼ìš°í„° ìƒì„±
- [ ] Toss Payments ì—°ë™ (API Key ì„¤ì •)
- [ ] `lib_cron/subscriptionChecker.js` - êµ¬ë… ë§Œë£Œ Cron Job
- [ ] ê²°ì œ í…ŒìŠ¤íŠ¸ (Sandbox í™˜ê²½)

### Phase 4: í…ŒìŠ¤íŠ¸ & ë°°í¬ (1ì£¼)
- [ ] Free ê³„ì • í…ŒìŠ¤íŠ¸ (ê¸°ë³¸ ê¸°ëŠ¥ë§Œ ì ‘ê·¼ ê°€ëŠ¥)
- [ ] Professional ê³„ì • í…ŒìŠ¤íŠ¸ (Teacher Dashboard ì ‘ê·¼)
- [ ] Enterprise ê³„ì • í…ŒìŠ¤íŠ¸ (í™”ì´íŠ¸ë¼ë²¨ í™•ì¸)
- [ ] ê²°ì œ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ (Toss Payments)
- [ ] êµ¬ë… ë§Œë£Œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- [ ] í”„ëœì°¨ì´ì¦ˆ 50ê°œ Professional ë¬´ë£Œ ì œê³µ
- [ ] í”„ë¡œë•ì…˜ ë°°í¬

---

## ğŸ¯ ìš°ì„ ìˆœìœ„ ì‘ì—… (ì´ë²ˆ ì£¼)

### Day 1-2: ë°ì´í„° ì¤€ë¹„
```bash
# 1. ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
cd migrations
touch 002_set_default_plans.sql
touch 003_add_premium_content_fields.sql
touch 004_create_feature_flags.sql
touch 005_subscription_functions.sql

# 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
mysql -u root -p educodingnplay < migrations/002_set_default_plans.sql
mysql -u root -p educodingnplay < migrations/003_add_premium_content_fields.sql
mysql -u root -p educodingnplay < migrations/004_create_feature_flags.sql
mysql -u root -p educodingnplay < migrations/005_subscription_functions.sql
```

### Day 3-4: ë¯¸ë“¤ì›¨ì–´ êµ¬í˜„
```bash
# 1. Tier ë¯¸ë“¤ì›¨ì–´ ìƒì„±
touch lib_login/tierMiddleware.js

# 2. ì—…ê·¸ë ˆì´ë“œ í˜ì´ì§€ ìƒì„±
mkdir -p views/subscription
touch views/upgrade-required.ejs
touch views/subscription-expired.ejs
```

### Day 5-7: ë¼ìš°í„° ì ìš© & í…ŒìŠ¤íŠ¸
```bash
# 1. teacherRouter.js ìˆ˜ì • (requireFeature ì¶”ê°€)
# 2. myUniverseRouter.js ìˆ˜ì •
# 3. learningRouter.js ìˆ˜ì •
# 4. í…ŒìŠ¤íŠ¸: free ê³„ì •ìœ¼ë¡œ Teacher Dashboard ì ‘ê·¼ ì‹œë„
```

---

## ğŸ“Š ì˜ˆìƒ ì¼ì •

| Week | Phase | ì‘ì—… ë‚´ìš© | ì‚°ì¶œë¬¼ |
|------|-------|-----------|--------|
| 1ì£¼ì°¨ | Phase 1 | ë°ì´í„° ë ˆì´ì–´ ë¶„ë¦¬ | 4ê°œ ë§ˆì´ê·¸ë ˆì´ì…˜ SQL |
| 2ì£¼ì°¨ | Phase 2 | ë¯¸ë“¤ì›¨ì–´ & ê¶Œí•œ | tierMiddleware.js + 3ê°œ ë¼ìš°í„° ìˆ˜ì • |
| 3ì£¼ì°¨ | Phase 3-1 | UI ê°œë°œ | í”Œëœ ì„ íƒ/ê²°ì œ í˜ì´ì§€ |
| 4ì£¼ì°¨ | Phase 3-2 | ê²°ì œ ì—°ë™ & Cron | Toss Payments + êµ¬ë… ì²´ì»¤ |
| 5ì£¼ì°¨ | Phase 4 | í…ŒìŠ¤íŠ¸ & ë°°í¬ | í”„ë¡œë•ì…˜ ë°°í¬ |

**ì´ ì†Œìš” ê¸°ê°„**: 5ì£¼ (1.25ê°œì›”)

---

## ğŸš€ ë°°í¬ ì „ëµ

### 1. ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸
```bash
NODE_ENV=development npm start
# Free ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ â†’ Teacher Dashboard ì ‘ê·¼ â†’ 403 í™•ì¸
```

### 2. ìŠ¤í…Œì´ì§• ë°°í¬
```bash
# NCP ìŠ¤í…Œì´ì§• ì„œë²„
git checkout staging
git merge main
pm2 restart educosmo-staging
```

### 3. í”„ë¡œë•ì…˜ ë°°í¬ (ì ì§„ì )
```bash
# Step 1: ì½”ë”©ì•¤í”Œë ˆì´ í”„ëœì°¨ì´ì¦ˆ 50ê°œë§Œ ë¨¼ì €
# Professional í”Œëœ ë¬´ë£Œ ì œê³µ (ë¡œì—´í‹°ì— í¬í•¨)

# Step 2: 2ì£¼ ëª¨ë‹ˆí„°ë§ í›„ ì¼ë°˜ í•™ì› ì˜¤í”ˆ
# í”Œëœ ì„ íƒ í˜ì´ì§€ ê³µê°œ

# Step 3: ê²°ì œ ì—°ë™ í™œì„±í™”
# Toss Payments Production ëª¨ë“œ
```

---

## ğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸ ìš”ì•½

### âœ… ì´ë¯¸ ìˆëŠ” ê²ƒ (í™œìš©)
- Users/Centers í…Œì´ë¸”ì— subscription í•„ë“œ ì¡´ì¬
- Role ê¸°ë°˜ ê¶Œí•œ ì‹œìŠ¤í…œ (authenticateUser, checkRole)
- Storage ì •ì±… ë° Quota Checker
- Payments í…Œì´ë¸”

### ğŸ†• ì¶”ê°€í•  ê²ƒ
- FeatureFlags í…Œì´ë¸” (Tierë³„ ê¸°ëŠ¥ on/off)
- tierMiddleware.js (requireTier, requireFeature, canAccessContent)
- ContentMap.is_premium í•„ë“œ
- í”Œëœ ì„ íƒ/ê²°ì œ UI
- Toss Payments ì—°ë™
- êµ¬ë… ë§Œë£Œ Cron Job

### ğŸ¯ í•µì‹¬ ì°¨ë³„í™”
- í•™ìƒ: ë¬´ë£Œ (ë¬¸ì œ 1,000ê°œ)
- ì„ ìƒë‹˜: ìœ ë£Œ (â‚©55,000 ~ â‚©110,000)
- Teacher Dashboard, AI ì¶”ì²œ, í˜ë¥´ì†Œë‚˜ ë¶„ì„ â†’ ìœ ë£Œ ì „ìš©
- í”„ëœì°¨ì´ì¦ˆ 50ê°œ â†’ Professional ë¬´ë£Œ (ë§ˆì¼€íŒ…)

---

**ì‘ì„±ì**: Claude Code Assistant
**ê²€í†  í•„ìš”**: ê°œë°œíŒ€ (êµ¬í˜„ ì¼ì •), ê²½ì˜íŒ€ (ê°€ê²© ì •ì±…)
**ë‹¤ìŒ ë‹¨ê³„**: Phase 1 ë§ˆì´ê·¸ë ˆì´ì…˜ SQL ì‘ì„± ì‹œì‘
