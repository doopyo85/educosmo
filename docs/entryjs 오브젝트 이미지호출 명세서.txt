ğŸ” educodingnplay EntryJS ì´ë¯¸ì§€ íŒŒì¼ í˜¸ì¶œ ì‹œìŠ¤í…œ ëª…ì„¸ì„œ
ğŸ“‹ ì‹œìŠ¤í…œ ê°œìš”
ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜: 3000ë²ˆ(ë©”ì¸) + 8070ë²ˆ(EntryJS) ë¶„ë¦¬í˜• í•˜ì´ë¸Œë¦¬ë“œ
ì´ë¯¸ì§€ ì„œë¹™ ë°©ì‹: Apache Alias + ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œ
ë°ì´í„° ì†ŒìŠ¤: AWS S3 ENT íŒŒì¼ â†’ ë¡œì»¬ ì„ì‹œ ë””ë ‰í† ë¦¬ ì¶”ì¶œ
ì‘ì„±ì¼: 2025ë…„ 8ì›” 5ì¼
ìƒíƒœ: ğŸŸ¡ ìš´ì˜ ì¤‘ (ì´ë¯¸ì§€ ë¡œë“œ ê²½ë¡œ ìµœì í™” í•„ìš”)

ğŸ—ï¸ ì „ì²´ ì•„í‚¤í…ì²˜ íë¦„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì‚¬ìš©ì ë¸Œë¼ìš°ì €   â”‚    â”‚   3000ë²ˆ ë©”ì¸ì„œë²„   â”‚    â”‚   8070ë²ˆ EntryJS  â”‚
â”‚                â”‚    â”‚   (ENT íŒŒì‹±)      â”‚    â”‚   (ì›Œí¬ìŠ¤í˜ì´ìŠ¤)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚ 1. ì¹´ë“œ í´ë¦­            â”‚                       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚
         â”‚                       â”‚ 2. S3 ENT ë‹¤ìš´ë¡œë“œ     â”‚
         â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
         â”‚                       â”‚ 3. TAR ì••ì¶• í•´ì œ      â”‚â”‚
         â”‚                       â”‚ 4. ì´ë¯¸ì§€ íŒŒì¼ ì¶”ì¶œ    â”‚â”‚
         â”‚                       â”‚ 5. /temp/current/ ë³µì‚¬â”‚â”‚
         â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
         â”‚                       â”‚                       â”‚
         â”‚ 6. 8070ë²ˆ ë¦¬ë‹¤ì´ë ‰íŠ¸    â”‚                       â”‚
         â”‚ (Base64 í”„ë¡œì íŠ¸ ë°ì´í„°) â”‚                       â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
         â”‚                                               â”‚
         â”‚ 7. EntryJS ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë¡œë“œ                     â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
         â”‚                                               â”‚
         â”‚ 8. ì´ë¯¸ì§€ ìš”ì²­ (/temp/xx/xx/image/...)          â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
         â”‚                                               â”‚
         â”‚ 9. Apache Alias ê²½ë¡œë¡œ ì´ë¯¸ì§€ ì„œë¹™               â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

ğŸ“‚ ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ êµ¬ì¡°
ğŸ”¹ S3 ENT íŒŒì¼ ë‚´ë¶€ êµ¬ì¡°
cpe1-1a.ent (TAR.GZ ì••ì¶•)
â””â”€â”€ temp/
    â”œâ”€â”€ project.json             # EntryJS í”„ë¡œì íŠ¸ ë°ì´í„°
    â”œâ”€â”€ 60/62/image/             # ì´ë¯¸ì§€ ë””ë ‰í† ë¦¬ (filename ê¸°ë°˜)
    â”‚   â””â”€â”€ 6062p3x0ly...png     # ì‹¤ì œ ì´ë¯¸ì§€ íŒŒì¼
    â”œâ”€â”€ yk/c6/image/
    â”‚   â””â”€â”€ ykc640e3ly...png
    â””â”€â”€ [ê¸°íƒ€ ì‚¬ìš´ë“œ/ì¸ë„¤ì¼ ë””ë ‰í† ë¦¬ë“¤]
ğŸ”¹ 3000ë²ˆ ì„œë²„ ë¡œì»¬ ì €ì¥ êµ¬ì¡°
/var/www/html/temp/ent_files/
â”œâ”€â”€ current/                     # ê³ ì • ê²½ë¡œ (Apache Alias ëŒ€ìƒ)
â”‚   â”œâ”€â”€ 60/62/image/
â”‚   â”‚   â””â”€â”€ 6062p3x0ly...png    # S3ì—ì„œ ì¶”ì¶œëœ ì´ë¯¸ì§€
â”‚   â”œâ”€â”€ yk/c6/image/
â”‚   â”‚   â””â”€â”€ ykc640e3ly...png
â”‚   â””â”€â”€ project.json
â”œâ”€â”€ parse_123456789_abc123/      # ì„ì‹œ íŒŒì‹± ë””ë ‰í† ë¦¬ (ìë™ì‚­ì œ)
â””â”€â”€ [ê¸°íƒ€ ì„ì‹œ ë””ë ‰í† ë¦¬ë“¤]
ğŸ”¹ EntryJSì—ì„œ ìš”ì²­í•˜ëŠ” ì´ë¯¸ì§€ ê²½ë¡œ
ë¸Œë¼ìš°ì € ìš”ì²­: /temp/60/62/image/6062p3x0ly...png
ì‹¤ì œ íŒŒì¼:   /var/www/html/temp/ent_files/current/60/62/image/6062p3x0ly...png

ğŸ”§ í•µì‹¬ ì²˜ë¦¬ ê³¼ì •
Phase 1: ENT íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë° íŒŒì‹± (3000ë²ˆ ì„œë²„)
1.1 íŒŒì¼ ë‹¤ìš´ë¡œë“œ
ìœ„ì¹˜: lib/entFileManager.js â†’ downloadFromS3()
javascript// S3ì—ì„œ ENT íŒŒì¼ ë‹¤ìš´ë¡œë“œ
const response = await fetch(s3Url, {
    method: 'GET',
    timeout: 30000,
    headers: { 'User-Agent': 'educodingnplay-server/1.0' }
});
const entBuffer = await response.buffer();
1.2 TAR ì••ì¶• í•´ì œ
ìœ„ì¹˜: lib/entFileManager.js â†’ parseEntFile()
javascript// EntryJS í‘œì¤€ TAR ì••ì¶• í•´ì œ
await tar.x({
    file: entFilePath,
    cwd: tempParseDir,
    filter: (path, entry) => {
        return entry.type !== 'SymbolicLink' && entry.size < maxFileSize;
    }
});
1.3 ì´ë¯¸ì§€ íŒŒì¼ ê³ ì • ê²½ë¡œ ë³µì‚¬
ìœ„ì¹˜: lib/entFileManager.js â†’ copyAssetsToFixedPath()
javascript// ì„ì‹œ ë””ë ‰í† ë¦¬ì—ì„œ ê³ ì • ê²½ë¡œë¡œ ë³µì‚¬
const fixedAssetsPath = '/var/www/html/temp/ent_files/current';
await this.copyDirectory(tempDir, fixedAssetsPath);
await this.chmodRecursive(fixedAssetsPath, 0o755); // Apache ì ‘ê·¼ ê¶Œí•œ
Phase 2: í”„ë¡œì íŠ¸ ë°ì´í„° ì²˜ë¦¬ (3000ë²ˆ ì„œë²„)
2.1 ì´ë¯¸ì§€ ê²½ë¡œ ìˆ˜ì •
ìœ„ì¹˜: lib/entFileManager.js â†’ parseEntFile() í•˜ë‹¨
javascript// EntryJS í˜¸í™˜ ê²½ë¡œë¡œ ìˆ˜ì •
projectData.objects.forEach((obj) => {
    if (obj.sprite && obj.sprite.pictures) {
        obj.sprite.pictures.forEach((picture) => {
            if (picture.filename && !picture.fileurl) {
                const filename = picture.filename;
                const imageType = picture.imageType || 'png';
                const folderPath = `${filename.substring(0, 2)}/${filename.substring(2, 4)}/image`;
                picture.fileurl = `/temp/${folderPath}/${filename}.${imageType}`;
            }
        });
    }
});
2.2 Base64 ì¸ì½”ë”© ë° ë¦¬ë‹¤ì´ë ‰íŠ¸
ìœ„ì¹˜: routes/entryRouter.js
javascriptconst projectDataEncoded = Buffer.from(JSON.stringify(result.projectData)).toString('base64');
const entryServerUrl = `https://app.codingnplay.co.kr/entry_editor/?userID=${userID}&role=${role}&project=${projectDataEncoded}`;
return res.redirect(entryServerUrl);
Phase 3: EntryJS ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë¡œë“œ (8070ë²ˆ ì„œë²„)
3.1 í”„ë¡œì íŠ¸ ë°ì´í„° ë””ì½”ë”©
ìœ„ì¹˜: entry/js/app.mjs â†’ loadProjectFromBase64()
javascriptconst decodedJson = atob(base64ProjectData);
const projectData = JSON.parse(decodedJson);
Entry.loadProject(projectData);
3.2 ì´ë¯¸ì§€ ë¡œë“œ ìš”ì²­
EntryJS ë‚´ë¶€ì—ì„œ ìë™ìœ¼ë¡œ picture.fileurl ê²½ë¡œë¡œ ì´ë¯¸ì§€ ìš”ì²­:
GET /temp/60/62/image/6062p3x0ly...png
Phase 4: Apache ì´ë¯¸ì§€ ì„œë¹™
4.1 Apache Alias ì„¤ì •
íŒŒì¼: /etc/apache2/sites-available/000-default.conf
apache# ENT ì´ë¯¸ì§€ ê³ ì • ê²½ë¡œ ì„œë¹™
Alias /temp /var/www/html/temp/ent_files/current
<Directory "/var/www/html/temp/ent_files/current">
    Options FollowSymLinks
    AllowOverride None
    Require all granted
    Header always set Access-Control-Allow-Origin "*"
    Header always set Cache-Control "public, max-age=3600"
</Directory>

# í”„ë¡ì‹œ ì˜ˆì™¸ ì„¤ì • (ì¤‘ìš”!)
ProxyPass /temp !

ğŸ” ê´€ë ¨ íŒŒì¼ ë° ì˜ì¡´ì„±
3000ë²ˆ ë©”ì¸ ì„œë²„
íŒŒì¼ì—­í• í•µì‹¬ í•¨ìˆ˜lib/entFileManager.jsENT íŒŒì¼ ê´€ë¦¬loadProjectFromS3(), parseEntFile(), copyAssetsToFixedPath()routes/entryRouter.jsEntry ë¼ìš°íŒ…/entry, /entry_editor, /entry/api/load-projectlib/s3Manager.jsS3 ì—°ë™S3 ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ (êµ¬í˜„ ì˜ˆì •)
8070ë²ˆ EntryJS ì„œë²„
íŒŒì¼ì—­í• í•µì‹¬ í•¨ìˆ˜entry/js/app.mjsë©”ì¸ ì•±loadProjectFromBase64(), showNotification()entry/index.htmlHTML í…œí”Œë¦¿EntryJS ì»¨í…Œì´ë„ˆ ì œê³µentry/server.jsExpress ì„œë²„ì •ì  íŒŒì¼ ì„œë¹™, í—¬ìŠ¤ì²´í¬
Apache ì„¤ì •
íŒŒì¼ì—­í• í•µì‹¬ ì„¤ì •/etc/apache2/sites-available/000-default.confí”„ë¡ì‹œ ì„¤ì •Alias, ProxyPass ì˜ˆì™¸

ğŸ“Š ì´ë¯¸ì§€ ê²½ë¡œ ë§¤í•‘ í…Œì´ë¸”
ë‹¨ê³„ê²½ë¡œ í˜•íƒœì‹¤ì œ ê²½ë¡œ ì˜ˆì‹œì„¤ëª…S3 ENT ë‚´ë¶€temp/60/62/image/6062...pngS3 ì••ì¶• íŒŒì¼ ë‚´ë¶€TAR ì••ì¶•ëœ ìƒíƒœ3000ë²ˆ íŒŒì‹±parse_123.../temp/60/62/image/6062...png/var/www/html/temp/ent_files/parse_123.../ì„ì‹œ ì••ì¶• í•´ì œ3000ë²ˆ ê³ ì •current/60/62/image/6062...png/var/www/html/temp/ent_files/current/Apache Alias ëŒ€ìƒEntryJS ìš”ì²­/temp/60/62/image/6062...pngë¸Œë¼ìš°ì € HTTP ìš”ì²­ìƒëŒ€ ê²½ë¡œApache ì„œë¹™/var/www/html/temp/ent_files/current/60/62/image/6062...pngì‹¤ì œ íŒŒì¼ ì‹œìŠ¤í…œAlias ë§¤í•‘ ê²°ê³¼
