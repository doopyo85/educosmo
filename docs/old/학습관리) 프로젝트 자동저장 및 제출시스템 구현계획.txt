ğŸ¯ ìŠ¤í¬ë˜ì¹˜/ì—”íŠ¸ë¦¬ ìë™ì €ì¥ ë° ì œì¶œ ì‹œìŠ¤í…œ êµ¬í˜„ ê³„íš
ğŸ“‹ ë¬¸ì œ í•´ê²° ë°©í–¥ ìš”ì•½
í˜„ì¬ ìƒí™©

âœ… S3 â†’ ë¡œì»¬ â†’ í”Œë«í¼ (ë‹¤ìš´ë¡œë“œ/íŒŒì‹±) êµ¬í˜„ ì™„ë£Œ
âŒ í”Œë«í¼ â†’ ë¡œì»¬ â†’ S3 (ì €ì¥/ì—…ë¡œë“œ) ë¯¸êµ¬í˜„
âŒ ìë™ì €ì¥, ìˆ˜ë™ì €ì¥, ì œì¶œ ê¸°ëŠ¥ ì—†ìŒ

êµ¬í˜„ ëª©í‘œ

ìë™ì €ì¥: 3ë¶„ë§ˆë‹¤ ë¸Œë¼ìš°ì € localStorageì— ì„ì‹œ ì €ì¥ â†’ ì°½ ì¬ì ‘ì† ì‹œ ë³µêµ¬ íŒì—…
ìˆ˜ë™ì €ì¥: "ì €ì¥í•˜ê¸°" ë²„íŠ¼ â†’ S3ì— ì‚¬ìš©ì í”„ë¡œì íŠ¸ ì €ì¥ (draft ìƒíƒœ)
ì œì¶œí•˜ê¸°: "ì œì¶œí•˜ê¸°" ë²„íŠ¼ â†’ S3 ì €ì¥ + DBì— ì œì¶œ ê¸°ë¡ (final ìƒíƒœ)


ğŸ—‚ï¸ S3 í´ë” êµ¬ì¡° ì„¤ê³„
s3://educodingnplaycontents/
â”œâ”€â”€ ent/                          # ê¸°ì¡´ êµìœ¡ìš© ì½˜í…ì¸  (ì½ê¸° ì „ìš©)
â”‚   â”œâ”€â”€ cpe1-1a.ent
â”‚   â””â”€â”€ cpe1-1b.ent
â”œâ”€â”€ scratch/                      # ê¸°ì¡´ êµìœ¡ìš© ì½˜í…ì¸  (ì½ê¸° ì „ìš©)
â”‚   â”œâ”€â”€ game_basic.sb3
â”‚   â””â”€â”€ animation_intro.sb3
â””â”€â”€ users/                        # ğŸ”¥ ì‹ ê·œ: ì‚¬ìš©ì ì‘í’ˆ ì €ì¥ì†Œ
    â”œâ”€â”€ {userID}/
    â”‚   â”œâ”€â”€ scratch/
    â”‚   â”‚   â”œâ”€â”€ drafts/           # ì„ì‹œ ì €ì¥
    â”‚   â”‚   â”‚   â”œâ”€â”€ my_game_draft_2025-01-05.sb3
    â”‚   â”‚   â”‚   â””â”€â”€ my_game_draft_2025-01-05.json  # ë©”íƒ€ë°ì´í„°
    â”‚   â”‚   â””â”€â”€ final/            # ì œì¶œ ì™„ë£Œ
    â”‚   â”‚       â”œâ”€â”€ my_game_final_2025-01-05.sb3
    â”‚   â”‚       â””â”€â”€ my_game_final_2025-01-05.json
    â”‚   â””â”€â”€ entry/
    â”‚       â”œâ”€â”€ drafts/
    â”‚       â”‚   â”œâ”€â”€ my_animation_draft_2025-01-05.ent
    â”‚       â”‚   â””â”€â”€ my_animation_draft_2025-01-05.json
    â”‚       â””â”€â”€ final/
    â”‚           â”œâ”€â”€ my_animation_final_2025-01-05.ent
    â”‚           â””â”€â”€ my_animation_final_2025-01-05.json

ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ í™•ì¥
1. ProjectSubmissions í…Œì´ë¸” í™œìš©
sql-- ì´ë¯¸ ëª…ì„¸ì„œì— ì •ì˜ëœ í…Œì´ë¸” í™œìš©
-- lib_storage/s3Manager.jsì—ì„œ ì—…ë¡œë“œ í›„ ì—¬ê¸°ì— ê¸°ë¡

INSERT INTO ProjectSubmissions (
    user_id, 
    platform,           -- 'scratch' or 'entry'
    project_name,
    submission_type,    -- 'draft' or 'final'
    s3_file_path,
    file_size_kb,
    submitted_at
) VALUES (?, ?, ?, ?, ?, ?, NOW());
2. ìë™ì €ì¥ìš© ë³„ë„ í…Œì´ë¸” (ì„ íƒì‚¬í•­)
sql-- ë¸Œë¼ìš°ì € localStorage ê¸°ë°˜ì´ë¯€ë¡œ DB ë¶ˆí•„ìš”
-- ë‹¨, ë³µêµ¬ ì´ë ¥ ì¶”ì ì„ ìœ„í•´ ì„ íƒì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥
CREATE TABLE AutoSaveLogs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    platform VARCHAR(20),
    project_name VARCHAR(255),
    last_autosave_at TIMESTAMP,
    INDEX idx_user_platform (user_id, platform)
);

ğŸ”„ ì‹œìŠ¤í…œ íë¦„ë„
1ï¸âƒ£ ìë™ì €ì¥ (ë¸Œë¼ìš°ì € localStorage)
ì‚¬ìš©ì ì‘ì—… (3ë¶„ ê°„ê²©)
    â†“
JavaScript setInterval
    â†“
Scratch: vm.saveProjectSb3()
Entry: Entry.exportProject()
    â†“
localStorage.setItem('autosave_scratch_2025-01-05', projectData)
    â†“
í˜ì´ì§€ ì¬ì ‘ì† ì‹œ
    â†“
localStorage í™•ì¸ â†’ ë³µêµ¬ íŒì—… í‘œì‹œ
    â†“
"ë³µêµ¬í•˜ê¸°" í´ë¦­ â†’ Entry.loadProject(data)
2ï¸âƒ£ ìˆ˜ë™ ì €ì¥ (S3 ì—…ë¡œë“œ)
"ì €ì¥í•˜ê¸°" ë²„íŠ¼ í´ë¦­
    â†“
í”„ë¡œì íŠ¸ ë°ì´í„° ì¶”ì¶œ
    â†“
POST /api/save-project
{
  platform: 'scratch',
  projectName: 'ë‚´ê²Œì„',
  projectData: <Blob or Base64>,
  saveType: 'draft'
}
    â†“
3000ë²ˆ ì„œë²„: lib_storage/s3Manager.js
    â†“
S3 ì—…ë¡œë“œ: users/{userID}/scratch/drafts/ë‚´ê²Œì„_2025-01-05.sb3
    â†“
ProjectSubmissions í…Œì´ë¸”ì— ê¸°ë¡
    â†“
ì‘ë‹µ: { success: true, s3Path: '...' }
3ï¸âƒ£ ì œì¶œí•˜ê¸° (S3 + DB + êµì‚¬ ëŒ€ì‹œë³´ë“œ)
"ì œì¶œí•˜ê¸°" ë²„íŠ¼ í´ë¦­
    â†“
í™•ì¸ íŒì—…: "ì •ë§ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
    â†“
POST /api/submit-project
{
  platform: 'entry',
  projectName: 'ë‚´ì• ë‹ˆë©”ì´ì…˜',
  projectData: <Blob>,
  saveType: 'final'
}
    â†“
S3 ì—…ë¡œë“œ: users/{userID}/entry/final/ë‚´ì• ë‹ˆë©”ì´ì…˜_2025-01-05.ent
    â†“
ProjectSubmissions í…Œì´ë¸”: submission_type = 'final'
    â†“
ì‘ë‹µ: { success: true, submissionId: 123 }
    â†“
UI í”¼ë“œë°±: "ì œì¶œ ì™„ë£Œ! ì„ ìƒë‹˜ì´ í™•ì¸í•  ì˜ˆì •ì…ë‹ˆë‹¤."

ğŸ“ êµ¬í˜„ íŒŒì¼ êµ¬ì¡°
educodingnplay/
â”œâ”€â”€ lib_storage/
â”‚   â”œâ”€â”€ s3Manager.js              # ğŸ”¥ S3 ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ í†µí•©
â”‚   â”œâ”€â”€ scratchProjectManager.js  # ğŸ”¥ ì‹ ê·œ: Scratch í”„ë¡œì íŠ¸ ê´€ë¦¬
â”‚   â””â”€â”€ entryProjectManager.js    # ğŸ”¥ ì‹ ê·œ: Entry í”„ë¡œì íŠ¸ ê´€ë¦¬
â”œâ”€â”€ routes/api/
â”‚   â”œâ”€â”€ scratchProjectRouter.js   # ğŸ”¥ ì‹ ê·œ: Scratch ì €ì¥/ì œì¶œ API
â”‚   â””â”€â”€ entryProjectRouter.js     # ê¸°ì¡´ íŒŒì¼ í™•ì¥
â”œâ”€â”€ public/js/
â”‚   â”œâ”€â”€ autosave.js               # ğŸ”¥ ì‹ ê·œ: ìë™ì €ì¥ í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ projectUpload.js          # ğŸ”¥ ì‹ ê·œ: ì—…ë¡œë“œ ìœ í‹¸ë¦¬í‹°
â””â”€â”€ views/
    â”œâ”€â”€ scratch_project.ejs       # ê¸°ì¡´ íŒŒì¼ ìˆ˜ì • (íˆ´ë°” ì¶”ê°€)
    â””â”€â”€ entry_project.ejs         # ê¸°ì¡´ íŒŒì¼ ìˆ˜ì • (íˆ´ë°” ì¶”ê°€)

ğŸ› ï¸ ë‹¨ê³„ë³„ êµ¬í˜„ ê³„íš
STEP 1: ìë™ì €ì¥ (í´ë¼ì´ì–¸íŠ¸ë§Œ êµ¬í˜„, 1ì¼)
ëª©í‘œ: ë¸Œë¼ìš°ì € localStorage ê¸°ë°˜ ìë™ì €ì¥ + ë³µêµ¬ íŒì—…
ì‘ì—… íŒŒì¼:

public/js/autosave.js (ì‹ ê·œ)
views/scratch_project.ejs (ìˆ˜ì •)
views/entry_project.ejs (ìˆ˜ì •)

ê¸°ëŠ¥:
javascript// autosave.js
class AutoSaveManager {
  constructor(platform) {
    this.platform = platform;
    this.interval = 3 * 60 * 1000; // 3ë¶„
    this.storageKey = `autosave_${platform}_${new Date().toISOString().split('T')[0]}`;
  }
  
  startAutoSave() {
    setInterval(() => {
      const projectData = this.getProjectData();
      localStorage.setItem(this.storageKey, JSON.stringify(projectData));
      console.log('ìë™ì €ì¥ ì™„ë£Œ:', new Date().toLocaleTimeString());
    }, this.interval);
  }
  
  checkRecovery() {
    const saved = localStorage.getItem(this.storageKey);
    if (saved) {
      this.showRecoveryModal(JSON.parse(saved));
    }
  }
}

STEP 2: S3 ì—…ë¡œë“œ ì¸í”„ë¼ êµ¬ì¶• (2ì¼)
ëª©í‘œ: 3000ë²ˆ ì„œë²„ì—ì„œ Scratch/Entry íŒŒì¼ì„ S3ì— ì—…ë¡œë“œí•˜ëŠ” ê³µí†µ ëª¨ë“ˆ êµ¬í˜„
ì‘ì—… íŒŒì¼:

lib_storage/s3Manager.js (í™•ì¥)
lib_storage/scratchProjectManager.js (ì‹ ê·œ)
lib_storage/entryProjectManager.js (ì‹ ê·œ)

í•µì‹¬ ë©”ì„œë“œ:
javascript// s3Manager.js
class S3Manager {
  async uploadUserProject(userId, platform, fileName, fileBuffer, saveType) {
    const s3Key = `users/${userId}/${platform}/${saveType}/${fileName}`;
    // AWS SDK S3 ì—…ë¡œë“œ ë¡œì§
    // return s3Path
  }
}

STEP 3: ì €ì¥í•˜ê¸° API êµ¬í˜„ (2ì¼)
ëª©í‘œ: ì‚¬ìš©ìê°€ "ì €ì¥í•˜ê¸°" ë²„íŠ¼ í´ë¦­ ì‹œ S3 ì—…ë¡œë“œ + DB ê¸°ë¡
ì‘ì—… íŒŒì¼:

routes/api/scratchProjectRouter.js (ì‹ ê·œ)
routes/api/entryProjectRouter.js (í™•ì¥)

API ì—”ë“œí¬ì¸íŠ¸:
javascript// POST /api/scratch/save-project
router.post('/save-project', authenticateUser, async (req, res) => {
  const { projectName, projectData } = req.body;
  const userId = req.session.userID;
  
  // 1. íŒŒì¼ ìƒì„±
  const buffer = Buffer.from(projectData, 'base64');
  
  // 2. S3 ì—…ë¡œë“œ
  const s3Path = await s3Manager.uploadUserProject(
    userId, 
    'scratch', 
    `${projectName}_${Date.now()}.sb3`, 
    buffer, 
    'draft'
  );
  
  // 3. DB ê¸°ë¡
  await db.query(
    'INSERT INTO ProjectSubmissions (user_id, platform, project_name, submission_type, s3_file_path) VALUES (?, ?, ?, ?, ?)',
    [userId, 'scratch', projectName, 'draft', s3Path]
  );
  
  res.json({ success: true, s3Path });
});

STEP 4: ì œì¶œí•˜ê¸° API êµ¬í˜„ (1ì¼)
ëª©í‘œ: "ì œì¶œí•˜ê¸°" ë²„íŠ¼ â†’ submission_type = 'final'ë¡œ ì €ì¥
ì°¨ì´ì :

saveType: 'final'ë¡œ S3 ì €ì¥
DBì— submission_type = 'final' ê¸°ë¡
ì œì¶œ ì™„ë£Œ ì•Œë¦¼


STEP 5: UI í†µí•© (2ì¼)
ëª©í‘œ: Scratch/Entry ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— íˆ´ë°” ì¶”ê°€
Scratch (8601ë²ˆ):
html<!-- /var/www/html/scratch/index.html ìˆ˜ì • -->
<div class="custom-toolbar">
  <button id="autosave-restore">ë³µêµ¬í•˜ê¸°</button>
  <button id="save-draft">ì €ì¥í•˜ê¸°</button>
  <button id="submit-final">ì œì¶œí•˜ê¸°</button>
</div>

<script src="/js/autosave.js"></script>
<script>
  const autoSave = new AutoSaveManager('scratch');
  autoSave.startAutoSave();
  autoSave.checkRecovery();
  
  document.getElementById('save-draft').onclick = async () => {
    const projectData = await vm.saveProjectSb3();
    const blob = new Blob([projectData]);
    // FormDataë¡œ ì—…ë¡œë“œ
  };
</script>
Entry (8070ë²ˆ):
html<!-- /var/www/html/entry/index.html ìˆ˜ì • -->
<div class="entry-toolbar">
  <button onclick="saveProject('draft')">ì €ì¥í•˜ê¸°</button>
  <button onclick="saveProject('final')">ì œì¶œí•˜ê¸°</button>
</div>

<script>
  function saveProject(type) {
    const projectData = Entry.exportProject();
    fetch('/api/entry/save-project', {
      method: 'POST',
      body: JSON.stringify({ projectName: 'ë‚´ì‘í’ˆ', projectData, saveType: type })
    });
  }
</script>

âœ… ì²´í¬í¬ì¸íŠ¸
STEP 1 ì™„ë£Œ ì¡°ê±´

 3ë¶„ë§ˆë‹¤ localStorageì— ìë™ì €ì¥ í™•ì¸
 í˜ì´ì§€ ì¬ì ‘ì† ì‹œ ë³µêµ¬ íŒì—… í‘œì‹œ
 "ë³µêµ¬í•˜ê¸°" í´ë¦­ ì‹œ í”„ë¡œì íŠ¸ ë¡œë“œ

STEP 2 ì™„ë£Œ ì¡°ê±´

 S3ì— users/{userID}/scratch/drafts/ í´ë” ìƒì„± í™•ì¸
 .sb3, .ent íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ
 ì—…ë¡œë“œ í›„ S3 ì½˜ì†”ì—ì„œ íŒŒì¼ í™•ì¸ ê°€ëŠ¥

STEP 3 ì™„ë£Œ ì¡°ê±´

 "ì €ì¥í•˜ê¸°" ë²„íŠ¼ í´ë¦­ â†’ S3 ì—…ë¡œë“œ ì„±ê³µ
 ProjectSubmissions í…Œì´ë¸”ì— draft ê¸°ë¡
 ì„±ê³µ ë©”ì‹œì§€ UI í‘œì‹œ

STEP 4 ì™„ë£Œ ì¡°ê±´

 "ì œì¶œí•˜ê¸°" ë²„íŠ¼ í´ë¦­ â†’ final ìƒíƒœë¡œ ì €ì¥
 DBì—ì„œ submission_type = 'final' í™•ì¸