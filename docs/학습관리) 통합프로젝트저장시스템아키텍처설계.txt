üéØ ÌÜµÌï© ÌîÑÎ°úÏ†ùÌä∏ Ï†ÄÏû• ÏãúÏä§ÌÖú ÏïÑÌÇ§ÌÖçÏ≤ò ÏÑ§Í≥Ñ
üìã ÏÑ§Í≥Ñ Ï≤†Ìïô
ÌïµÏã¨ ÏõêÏπô:

ÌîåÎû´Ìèº ÎèÖÎ¶ΩÏ†ÅÏù∏ Í≥µÌÜµ Î†àÏù¥Ïñ¥ - Î™®Îì† ÌîåÎû´ÌèºÏù¥ ÎèôÏùºÌïú API ÏÇ¨Ïö©
ÌîåÎû´ÌèºÎ≥Ñ Ïñ¥ÎåëÌÑ∞ Ìå®ÌÑ¥ - Í∞Å ÌîåÎû´Ìèº ÌäπÏÑ±Ïóê ÎßûÎäî Ï≤òÎ¶¨
3000Î≤à Ï§ëÏïô ÏßëÏ§ëÏãù Í¥ÄÎ¶¨ - Ïù∏Ï¶ù, Í∂åÌïú, DB, S3 ÌÜµÌï©
8070/8601/8888ÏùÄ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ïó≠Ìï† - Ï†ÄÏû• Î°úÏßÅÏùÄ 3000Î≤àÏóê ÏúÑÏûÑ


üèóÔ∏è Ï†ÑÏ≤¥ ÏïÑÌÇ§ÌÖçÏ≤ò
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Client Side (Í∞Å Ìè¨Ìä∏)                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  8070 (Entry)    8601 (Scratch)    8888 (AppInventor)  ‚îÇ
‚îÇ      ‚Üì                 ‚Üì                    ‚Üì           ‚îÇ
‚îÇ  projectSaver.js   scratchSaver.js   aiSaver.js        ‚îÇ
‚îÇ      ‚Üì                 ‚Üì                    ‚Üì           ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                        ‚Üì                                ‚îÇ
‚îÇ           POST /api/projects/save (ÌÜµÌï© API)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Server Side (3000Î≤à ÌÜµÌï©)                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  routes/api/projectRouter.js (ÌÜµÌï© ÎùºÏö∞ÌÑ∞)              ‚îÇ
‚îÇ      ‚Üì                                                   ‚îÇ
‚îÇ  lib_project/ProjectManager.js (Í≥µÌÜµ ÎπÑÏ¶àÎãàÏä§ Î°úÏßÅ)     ‚îÇ
‚îÇ      ‚Üì                                                   ‚îÇ
‚îÇ  lib_project/adapters/ (ÌîåÎû´ÌèºÎ≥Ñ Ïñ¥ÎåëÌÑ∞)                ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ EntryAdapter.js                                ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ ScratchAdapter.js                              ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ AppInventorAdapter.js                          ‚îÇ
‚îÇ      ‚Üì                                                   ‚îÇ
‚îÇ  lib_storage/s3Manager.js (S3 ÌÜµÌï©)                     ‚îÇ
‚îÇ  lib_storage/dbManager.js (DB ÌÜµÌï©)                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Storage Layer                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  S3: educodingnplaycontents/projects/                   ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ entry/{userID}/                                ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ scratch/{userID}/                              ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ appinventor/{userID}/                          ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  MySQL: ProjectSubmissions ÌÖåÏù¥Î∏î (ÌÜµÌï©)                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

üìä Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïä§ÌÇ§Îßà (ÌÜµÏùºÎêú Íµ¨Ï°∞)
sql-- üî• ÌÜµÌï© ÌîÑÎ°úÏ†ùÌä∏ Ï†úÏ∂ú ÌÖåÏù¥Î∏î
CREATE TABLE ProjectSubmissions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    center_id INT,
    
    -- ÌîåÎû´Ìèº Íµ¨Î∂Ñ
    platform ENUM('entry', 'scratch', 'appinventor', 'python', 'jupyter') NOT NULL,
    
    -- ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥
    project_name VARCHAR(255) NOT NULL,
    original_filename VARCHAR(255),
    
    -- Ï†ÄÏû• ÌÉÄÏûÖ
    save_type ENUM('draft', 'final', 'autosave') DEFAULT 'draft',
    
    -- ÌååÏùº Ï†ïÎ≥¥
    s3_url VARCHAR(500) NOT NULL,
    s3_key VARCHAR(500) NOT NULL,
    file_size_kb INT,
    
    -- ÌîåÎû´ÌèºÎ≥Ñ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ (JSON)
    metadata JSON,
    
    -- ÏûêÎèô Î∂ÑÏÑù Í≤∞Í≥º
    complexity_score DECIMAL(5,2),
    blocks_count INT,
    
    -- ÌÉÄÏûÑÏä§ÌÉ¨ÌîÑ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- Ïù∏Îç±Ïä§
    FOREIGN KEY (user_id) REFERENCES Users(id) ON DELETE CASCADE,
    INDEX idx_user_platform (user_id, platform),
    INDEX idx_save_type (save_type),
    INDEX idx_created (created_at)
);

-- üî• ÌïôÏäµ Î°úÍ∑∏ Ïó∞Îèô (Í∏∞Ï°¥ LearningLogs ÌôïÏû•)
ALTER TABLE LearningLogs 
ADD COLUMN project_submission_id INT,
ADD FOREIGN KEY (project_submission_id) REFERENCES ProjectSubmissions(id);
```

---

## üìÅ ÌååÏùº Íµ¨Ï°∞
```
educodingnplay/
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ projectRouter.js          # üî• ÌÜµÌï© ÌîÑÎ°úÏ†ùÌä∏ API ÎùºÏö∞ÌÑ∞
‚îÇ
‚îú‚îÄ‚îÄ lib_project/                      # üî• Ïã†Í∑ú Ìè¥Îçî
‚îÇ   ‚îú‚îÄ‚îÄ ProjectManager.js             # Í≥µÌÜµ ÎπÑÏ¶àÎãàÏä§ Î°úÏßÅ
‚îÇ   ‚îú‚îÄ‚îÄ ProjectValidator.js           # ÏûÖÎ†• Í≤ÄÏ¶ù
‚îÇ   ‚îú‚îÄ‚îÄ ProjectAnalyzer.js            # ÌîÑÎ°úÏ†ùÌä∏ Î∂ÑÏÑù
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ adapters/                     # ÌîåÎû´ÌèºÎ≥Ñ Ïñ¥ÎåëÌÑ∞
‚îÇ       ‚îú‚îÄ‚îÄ BaseAdapter.js            # Ï∂îÏÉÅ Î≤†Ïù¥Ïä§ ÌÅ¥ÎûòÏä§
‚îÇ       ‚îú‚îÄ‚îÄ EntryAdapter.js           # Entry Ï†ÑÏö©
‚îÇ       ‚îú‚îÄ‚îÄ ScratchAdapter.js         # Scratch Ï†ÑÏö©
‚îÇ       ‚îú‚îÄ‚îÄ AppInventorAdapter.js     # AppInventor Ï†ÑÏö©
‚îÇ       ‚îú‚îÄ‚îÄ PythonAdapter.js          # Python Ï†ÑÏö©
‚îÇ       ‚îî‚îÄ‚îÄ JupyterAdapter.js         # Jupyter Ï†ÑÏö©
‚îÇ
‚îú‚îÄ‚îÄ lib_storage/                      # Í∏∞Ï°¥ Ìè¥Îçî ÌôïÏû•
‚îÇ   ‚îú‚îÄ‚îÄ s3Manager.js                  # S3 ÌÜµÌï© Í¥ÄÎ¶¨
‚îÇ   ‚îî‚îÄ‚îÄ dbManager.js                  # DB ÌÜµÌï© Í¥ÄÎ¶¨
‚îÇ
‚îî‚îÄ‚îÄ entry/js/                         # ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ (8070)
    ‚îî‚îÄ‚îÄ projectSaver.js               # Entry ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏

üîß ÌïµÏã¨ ÏΩîÎìú Íµ¨Ï°∞
1. ÌÜµÌï© API ÏóîÎìúÌè¨Ïù∏Ìä∏ (projectRouter.js)
javascript// routes/api/projectRouter.js
const express = require('express');
const router = express.Router();
const ProjectManager = require('../../lib_project/ProjectManager');
const { authenticateUser } = require('../../lib_login/authMiddleware');

// üî• Î™®Îì† ÌîåÎû´Ìèº ÌÜµÌï© Ï†ÄÏû• API
router.post('/save', authenticateUser, async (req, res) => {
    try {
        const {
            platform,        // 'entry', 'scratch', 'appinventor' Îì±
            projectName,
            projectData,
            saveType,        // 'draft', 'final', 'autosave'
            metadata         // ÌîåÎû´ÌèºÎ≥Ñ Ï∂îÍ∞Ä Ï†ïÎ≥¥
        } = req.body;

        const userId = req.session.userID;
        const centerId = req.session.centerID;

        // Í≥µÌÜµ Îß§ÎãàÏ†ÄÎ°ú Ï≤òÎ¶¨
        const projectManager = new ProjectManager();
        const result = await projectManager.saveProject({
            platform,
            projectName,
            projectData,
            saveType,
            userId,
            centerId,
            metadata
        });

        res.json(result);
        
    } catch (error) {
        console.error('ÌîÑÎ°úÏ†ùÌä∏ Ï†ÄÏû• Ïò§Î•ò:', error);
        res.status(500).json({
            success: false,
            error: error.message
        });
    }
});

// üî• Î™©Î°ù Ï°∞Ìöå (ÌîåÎû´ÌèºÎ≥Ñ ÌïÑÌÑ∞ÎßÅ)
router.get('/list', authenticateUser, async (req, res) => {
    try {
        const { platform, saveType } = req.query;
        const userId = req.session.userID;

        const projectManager = new ProjectManager();
        const projects = await projectManager.listProjects({
            userId,
            platform,
            saveType
        });

        res.json({ success: true, projects });
        
    } catch (error) {
        res.status(500).json({
            success: false,
            error: error.message
        });
    }
});

// üî• Î∂àÎü¨Ïò§Í∏∞
router.get('/load/:id', authenticateUser, async (req, res) => {
    try {
        const projectId = req.params.id;
        const userId = req.session.userID;

        const projectManager = new ProjectManager();
        const project = await projectManager.loadProject(projectId, userId);

        res.json({
            success: true,
            projectData: project.data,
            metadata: project.metadata
        });
        
    } catch (error) {
        res.status(500).json({
            success: false,
            error: error.message
        });
    }
});

// üî• ÏÇ≠Ï†ú
router.delete('/:id', authenticateUser, async (req, res) => {
    try {
        const projectId = req.params.id;
        const userId = req.session.userID;

        const projectManager = new ProjectManager();
        await projectManager.deleteProject(projectId, userId);

        res.json({ success: true });
        
    } catch (error) {
        res.status(500).json({
            success: false,
            error: error.message
        });
    }
});

module.exports = router;

2. Í≥µÌÜµ ÎπÑÏ¶àÎãàÏä§ Î°úÏßÅ (ProjectManager.js)
javascript// lib_project/ProjectManager.js
const EntryAdapter = require('./adapters/EntryAdapter');
const ScratchAdapter = require('./adapters/ScratchAdapter');
const AppInventorAdapter = require('./adapters/AppInventorAdapter');
const S3Manager = require('../lib_storage/s3Manager');
const db = require('../lib_login/db');

class ProjectManager {
    constructor() {
        this.adapters = {
            entry: new EntryAdapter(),
            scratch: new ScratchAdapter(),
            appinventor: new AppInventorAdapter()
        };
        this.s3Manager = new S3Manager();
    }

    /**
     * üî• ÌÜµÌï© ÌîÑÎ°úÏ†ùÌä∏ Ï†ÄÏû•
     */
    async saveProject(options) {
        const {
            platform,
            projectName,
            projectData,
            saveType,
            userId,
            centerId,
            metadata
        } = options;

        // 1. ÌîåÎû´ÌèºÎ≥Ñ Ïñ¥ÎåëÌÑ∞ ÏÑ†ÌÉù
        const adapter = this.adapters[platform];
        if (!adapter) {
            throw new Error(`ÏßÄÏõêÌïòÏßÄ ÏïäÎäî ÌîåÎû´Ìèº: ${platform}`);
        }

        // 2. ÌîåÎû´ÌèºÎ≥Ñ Í≤ÄÏ¶ù
        await adapter.validate(projectData);

        // 3. ÌîåÎû´ÌèºÎ≥Ñ Î≥ÄÌôò (ÌïÑÏöîÏãú)
        const processedData = await adapter.process(projectData);

        // 4. S3Ïóê ÏóÖÎ°úÎìú
        const s3Key = this.generateS3Key(platform, userId, projectName, saveType);
        const s3Url = await this.s3Manager.uploadProject(
            s3Key,
            processedData,
            adapter.getContentType()
        );

        // 5. ÌîåÎû´ÌèºÎ≥Ñ Î∂ÑÏÑù (Î≥µÏû°ÎèÑ, Î∏îÎ°ù Ïàò Îì±)
        const analysis = await adapter.analyze(projectData);

        // 6. DB Ï†ÄÏû•
        const submissionId = await this.saveToDatabase({
            userId,
            centerId,
            platform,
            projectName,
            saveType,
            s3Url,
            s3Key,
            fileSize: processedData.length,
            metadata: {
                ...metadata,
                ...analysis
            },
            complexityScore: analysis.complexity,
            blocksCount: analysis.blocks
        });

        // 7. LearningLogs Ïó∞Îèô
        await this.logLearningActivity(userId, centerId, platform, submissionId);

        return {
            success: true,
            submissionId,
            s3Url,
            projectName,
            analysis
        };
    }

    /**
     * üî• S3 ÌÇ§ ÏÉùÏÑ± (ÌÜµÏùºÎêú Í∑úÏπô)
     */
    generateS3Key(platform, userId, projectName, saveType) {
        const timestamp = Date.now();
        const sanitized = projectName.replace(/[^a-zA-Z0-9Í∞Ä-Ìû£_-]/g, '_');
        return `projects/${platform}/${userId}/${sanitized}_${timestamp}.${this.getExtension(platform)}`;
    }

    getExtension(platform) {
        const extensions = {
            entry: 'ent',
            scratch: 'sb3',
            appinventor: 'aia',
            python: 'py',
            jupyter: 'ipynb'
        };
        return extensions[platform] || 'json';
    }

    /**
     * üî• DB Ï†ÄÏû•
     */
    async saveToDatabase(data) {
        const query = `
            INSERT INTO ProjectSubmissions 
            (user_id, center_id, platform, project_name, save_type, 
             s3_url, s3_key, file_size_kb, metadata, 
             complexity_score, blocks_count)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        `;

        const result = await db.queryDatabase(query, [
            data.userId,
            data.centerId,
            data.platform,
            data.projectName,
            data.saveType,
            data.s3Url,
            data.s3Key,
            Math.round(data.fileSize / 1024),
            JSON.stringify(data.metadata),
            data.complexityScore,
            data.blocksCount
        ]);

        return result.insertId;
    }

    /**
     * üî• ÌïôÏäµ Î°úÍ∑∏ Í∏∞Î°ù
     */
    async logLearningActivity(userId, centerId, platform, submissionId) {
        const query = `
            INSERT INTO LearningLogs 
            (user_id, center_id, content_type, content_name, 
             start_time, end_time, duration, project_submission_id)
            VALUES (?, ?, ?, ?, NOW(), NOW(), 0, ?)
        `;

        await db.queryDatabase(query, [
            userId,
            centerId,
            platform,
            `${platform}_project_save`,
            submissionId
        ]);
    }

    /**
     * üî• ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù Ï°∞Ìöå
     */
    async listProjects(options) {
        const { userId, platform, saveType } = options;

        let query = `
            SELECT 
                id,
                platform,
                project_name,
                save_type,
                s3_url,
                file_size_kb,
                complexity_score,
                blocks_count,
                created_at,
                updated_at
            FROM ProjectSubmissions
            WHERE user_id = ?
        `;

        const params = [userId];

        if (platform) {
            query += ` AND platform = ?`;
            params.push(platform);
        }

        if (saveType) {
            query += ` AND save_type = ?`;
            params.push(saveType);
        }

        query += ` ORDER BY created_at DESC`;

        return await db.queryDatabase(query, params);
    }

    /**
     * üî• ÌîÑÎ°úÏ†ùÌä∏ Î∂àÎü¨Ïò§Í∏∞
     */
    async loadProject(projectId, userId) {
        // 1. DBÏóêÏÑú Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï°∞Ìöå
        const [project] = await db.queryDatabase(
            `SELECT * FROM ProjectSubmissions WHERE id = ? AND user_id = ?`,
            [projectId, userId]
        );

        if (!project) {
            throw new Error('ÌîÑÎ°úÏ†ùÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        }

        // 2. S3ÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Îã§Ïö¥Î°úÎìú
        const projectData = await this.s3Manager.downloadProject(project.s3_key);

        // 3. ÌîåÎû´ÌèºÎ≥Ñ Ïñ¥ÎåëÌÑ∞Î°ú ÌõÑÏ≤òÎ¶¨
        const adapter = this.adapters[project.platform];
        const processedData = await adapter.postProcess(projectData);

        return {
            data: processedData,
            metadata: JSON.parse(project.metadata || '{}')
        };
    }

    /**
     * üî• ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú
     */
    async deleteProject(projectId, userId) {
        // 1. DB Ï°∞Ìöå
        const [project] = await db.queryDatabase(
            `SELECT * FROM ProjectSubmissions WHERE id = ? AND user_id = ?`,
            [projectId, userId]
        );

        if (!project) {
            throw new Error('ÌîÑÎ°úÏ†ùÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        }

        // 2. S3 ÏÇ≠Ï†ú
        await this.s3Manager.deleteProject(project.s3_key);

        // 3. DB ÏÇ≠Ï†ú
        await db.queryDatabase(
            `DELETE FROM ProjectSubmissions WHERE id = ?`,
            [projectId]
        );
    }
}

module.exports = ProjectManager;

3. Ïñ¥ÎåëÌÑ∞ Ìå®ÌÑ¥ (BaseAdapter.js)
javascript// lib_project/adapters/BaseAdapter.js
class BaseAdapter {
    /**
     * ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ Í≤ÄÏ¶ù
     */
    async validate(projectData) {
        throw new Error('validate() Î©îÏÑúÎìúÎ•º Íµ¨ÌòÑÌï¥Ïïº Ìï©ÎãàÎã§.');
    }

    /**
     * ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ Ï†ÑÏ≤òÎ¶¨
     */
    async process(projectData) {
        throw new Error('process() Î©îÏÑúÎìúÎ•º Íµ¨ÌòÑÌï¥Ïïº Ìï©ÎãàÎã§.');
    }

    /**
     * ÌîÑÎ°úÏ†ùÌä∏ Î∂ÑÏÑù
     */
    async analyze(projectData) {
        throw new Error('analyze() Î©îÏÑúÎìúÎ•º Íµ¨ÌòÑÌï¥Ïïº Ìï©ÎãàÎã§.');
    }

    /**
     * Content-Type Î∞òÌôò
     */
    getContentType() {
        return 'application/json';
    }

    /**
     * ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ ÌõÑÏ≤òÎ¶¨ (Î∂àÎü¨Ïò§Í∏∞ Ïãú)
     */
    async postProcess(projectData) {
        return projectData;
    }
}

module.exports = BaseAdapter;

4. Entry Ïñ¥ÎåëÌÑ∞ ÏòàÏãú
javascript// lib_project/adapters/EntryAdapter.js
const BaseAdapter = require('./BaseAdapter');
const JSZip = require('jszip');

class EntryAdapter extends BaseAdapter {
    async validate(projectData) {
        if (!projectData || !projectData.objects) {
            throw new Error('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Entry ÌîÑÎ°úÏ†ùÌä∏ Îç∞Ïù¥ÌÑ∞ÏûÖÎãàÎã§.');
        }
    }

    async process(projectData) {
        // EntryÎäî JSONÏúºÎ°ú Ï†ÄÏû•
        return Buffer.from(JSON.stringify(projectData));
    }

    async analyze(projectData) {
        const objects = projectData.objects || [];
        const totalBlocks = objects.reduce((sum, obj) => {
            return sum + (obj.script?.length || 0);
        }, 0);

        return {
            complexity: this.calculateComplexity(totalBlocks),
            blocks: totalBlocks,
            sprites: objects.length,
            variables: this.countVariables(projectData),
            functions: this.countFunctions(projectData)
        };
    }

    calculateComplexity(blocks) {
        // Í∞ÑÎã®Ìïú Î≥µÏû°ÎèÑ Í≥ÑÏÇ∞
        if (blocks < 10) return 1;
        if (blocks < 30) return 2;
        if (blocks < 50) return 3;
        if (blocks < 100) return 4;
        return 5;
    }

    countVariables(projectData) {
        return projectData.variables?.length || 0;
    }

    countFunctions(projectData) {
        return projectData.functions?.length || 0;
    }

    getContentType() {
        return 'application/json';
    }
}

module.exports = EntryAdapter;

üåê Apache ÌîÑÎ°ùÏãú ÏÑ§Ï†ï
apache# /api/projectsÎäî ÌÜµÌï© ÌîÑÎ°úÏ†ùÌä∏ APIÎ°ú
ProxyPass /api/projects/ http://localhost:3000/api/projects/
ProxyPassReverse /api/projects/ http://localhost:3000/api/projects/

# Î†àÍ±∞Ïãú Ìò∏ÌôòÏÑ± Ïú†ÏßÄ
ProxyPass /api/entry-project/ http://localhost:3000/api/projects/
ProxyPassReverse /api/entry-project/ http://localhost:3000/api/projects/

üé® ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÇ¨Ïö© ÏòàÏãú (ÌÜµÏùºÎêú Ïù∏ÌÑ∞ÌéòÏù¥Ïä§)
Entry (8070)
javascriptawait fetch('/api/projects/save', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        platform: 'entry',
        projectName: 'my_game',
        projectData: Entry.exportProject(),
        saveType: 'draft'
    })
});
Scratch (8601)
javascriptawait fetch('/api/projects/save', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        platform: 'scratch',
        projectName: 'my_animation',
        projectData: vm.saveProjectSb3(),
        saveType: 'draft'
    })
});
AppInventor (8888)
javascriptawait fetch('/api/projects/save', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        platform: 'appinventor',
        projectName: 'my_app',
        projectData: aiaFileData,
        saveType: 'final'
    })
});

‚úÖ Ïù¥ Íµ¨Ï°∞Ïùò Ïû•Ï†ê

ÌôïÏû•ÏÑ±: ÏÉà ÌîåÎû´Ìèº Ï∂îÍ∞Ä Ïãú Ïñ¥ÎåëÌÑ∞Îßå Ï∂îÍ∞Ä
Ïú†ÏßÄÎ≥¥Ïàò: Í≥µÌÜµ Î°úÏßÅ Ìïú Í≥≥ÏóêÏÑú Í¥ÄÎ¶¨
ÏùºÍ¥ÄÏÑ±: Î™®Îì† ÌîåÎû´ÌèºÏù¥ ÎèôÏùºÌïú API ÏÇ¨Ïö©
Î∂ÑÏÑù: ÌîåÎû´Ìèº Í∞Ñ ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ ÎπÑÍµê Í∞ÄÎä•
Î≥¥Ïïà: Ïù∏Ï¶ù/Í∂åÌïúÏù¥ 3000Î≤àÏóêÏÑú ÌÜµÌï© Í¥ÄÎ¶¨