<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EntryJS Base í‘œì¤€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ - ì½”ë”©ì•¤í”Œë ˆì´</title>
    
    <!-- SEO ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="EntryJS Base í‘œì¤€ êµ¬ì¡° ê¸°ë°˜ ë¸”ë¡ ì½”ë”© ë° Python ì½”ë”© í†µí•© í™˜ê²½">
    <meta name="keywords" content="EntryJS, Base, ë¸”ë¡ì½”ë”©, íŒŒì´ì¬, êµìœ¡, í”„ë¡œê·¸ë˜ë°">
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" href="<%= baseUrl %>/resource/favicon.ico" type="image/x-icon">
    
    <!-- Base í‘œì¤€ CSS (ìˆœì„œ ì¤‘ìš”!) -->
    <link rel="stylesheet" href="<%= cssPath %>/entry.css">
    <link rel="stylesheet" href="<%= cssPath %>/workspace.css">
    <link rel="stylesheet" href="<%= cssPath %>/modal.css">
    
    <!-- Entry-tool CSS (CDN ìš°ì„ , ë¡œì»¬ fallback) -->
    <link rel="stylesheet" href="https://playentry.org/lib/entry-tool/dist/entry-tool.css" 
          onerror="this.onerror=null; this.href='<%= libPath %>/entry-tool/dist/entry-tool.css';">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* Base í‘œì¤€ EntryJS ì „ìš© ìŠ¤íƒ€ì¼ */
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8f9fa;
            overflow: hidden;
        }
        
        #workspace {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: #ffffff;
        }
        
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .loading-content {
            text-align: center;
            animation: fadeInUp 0.6s ease-out;
            max-width: 400px;
            padding: 40px;
        }
        
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        .loading-text {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .loading-subtext {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .loading-progress {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
            margin: 20px auto;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: #ffffff;
            width: 0%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        .loading-details {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 15px;
        }
        
        .error-container {
            text-align: center;
            color: #e74c3c;
            padding: 40px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 700px;
            margin: 0 auto;
        }
        
        .error-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .error-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #e74c3c;
        }
        
        .error-message {
            font-size: 16px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .error-details {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 4px;
            margin: 16px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            text-align: left;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .retry-button {
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.2s ease;
            margin: 0 5px;
        }
        
        .retry-button:hover {
            background: #2980b9;
        }
        
        .retry-button.secondary {
            background: #95a5a6;
        }
        
        .retry-button.secondary:hover {
            background: #7f8c8d;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .loading-progress {
                width: 250px;
            }
            
            .loading-content {
                padding: 20px;
            }
            
            .error-container {
                margin: 20px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loading" class="loading-container">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">EntryJS Base í‘œì¤€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤</div>
            <div class="loading-subtext">
                ë¸”ë¡ ì½”ë”©ê³¼ Python í†µí•© í™˜ê²½ì„ Base í‘œì¤€ êµ¬ì¡°ë¡œ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤
            </div>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="progress-bar"></div>
            </div>
            <div class="loading-details" id="loading-details">
                Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì¤‘...
            </div>
        </div>
    </div>
    
    <!-- ì˜¤ë¥˜ í™”ë©´ (ìˆ¨ê¹€ ìƒíƒœ) -->
    <div id="error" class="loading-container" style="display: none;">
        <div class="error-container">
            <div class="error-icon">âš ï¸</div>
            <div class="error-title">Base í‘œì¤€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë¡œë”© ì‹¤íŒ¨</div>
            <div class="error-message" id="error-message">
                EntryJS Base í‘œì¤€ êµ¬ì¡° ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ ë¡œë”©í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
            </div>
            <div class="error-details" id="error-details" style="display: none;"></div>
            <div style="margin-top: 20px;">
                <button class="retry-button" onclick="location.reload()">
                    ğŸ”„ ë‹¤ì‹œ ì‹œë„
                </button>
                <button class="retry-button secondary" onclick="window.history.back()">
                    â† ì´ì „ í˜ì´ì§€ë¡œ
                </button>
                <button class="retry-button secondary" onclick="checkLibraries()">
                    ğŸ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒíƒœ í™•ì¸
                </button>
            </div>
        </div>
    </div>
    
    <!-- EntryJS ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì»¨í…Œì´ë„ˆ -->
    <div id="workspace" style="display: none;"></div>
    
    <!-- Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© (ìˆœì„œ ë§¤ìš° ì¤‘ìš”!) -->
    
    <!-- 1. ë¡œë”© ì§„í–‰ë¥  ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        console.log('ğŸš€ EntryJS Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì‹œì‘...');
        
        window.BaseLoader = {
            progress: 0,
            total: 12,
            loadedLibs: [],
            errors: [],
            
            updateProgress: function(step, libName) {
                this.progress = step;
                this.loadedLibs.push(libName);
                
                const percentage = Math.round((step / this.total) * 100);
                const progressBar = document.getElementById('progress-bar');
                const loadingDetails = document.getElementById('loading-details');
                
                if (progressBar) {
                    progressBar.style.width = percentage + '%';
                }
                
                if (loadingDetails) {
                    loadingDetails.textContent = `${libName} ë¡œë“œ ì™„ë£Œ (${percentage}%)`;
                }
                
                console.log(`ğŸ“Š Base í‘œì¤€ ë¡œë”© ì§„í–‰ë¥ : ${percentage}% - ${libName}`);
            },
            
            logError: function(libName, error) {
                this.errors.push({ lib: libName, error: error });
                console.error(`âŒ ${libName} ë¡œë“œ ì‹¤íŒ¨:`, error);
            },
            
            getStatus: function() {
                return {
                    progress: this.progress,
                    total: this.total,
                    percentage: Math.round((this.progress / this.total) * 100),
                    loadedLibs: this.loadedLibs,
                    errors: this.errors,
                    isComplete: this.progress >= this.total
                };
            }
        };
        
        function checkLibraries() {
            fetch('/api/check-libs')
                .then(response => response.json())
                .then(data => {
                    console.log('ğŸ“‹ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒíƒœ:', data);
                    const missingLibs = Object.entries(data.libraries)
                        .filter(([name, status]) => !status)
                        .map(([name]) => name);
                    
                    if (missingLibs.length > 0) {
                        alert(`ëˆ„ë½ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬: ${missingLibs.join(', ')}\n\nì½˜ì†”(F12)ì—ì„œ ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
                    } else {
                        alert('ëª¨ë“  Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                    }
                })
                .catch(error => {
                    console.error('ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                    alert('ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                });
        }
    </script>
    
    <!-- 2. Base í‘œì¤€ í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ìˆœì„œ ì¤‘ìš”!) -->
    
    <!-- jQuery (Base í‘œì¤€ í•„ìˆ˜) -->
    <script src="<%= libPath %>/jquery/jquery.min.js" 
            onload="console.log('âœ… jQuery ë¡œë“œ ì™„ë£Œ'); window.BaseLoader.updateProgress(1, 'jQuery');"
            onerror="console.error('âŒ jQuery ë¡œë“œ ì‹¤íŒ¨'); window.BaseLoader.logError('jQuery', 'Load failed'); loadLibraryFallback('jquery', 'https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js');"></script>
    
    <!-- Lodash (Base í‘œì¤€ í•„ìˆ˜) -->
    <script src="<%= libPath %>/lodash/dist/lodash.min.js" 
            onload="console.log('âœ… Lodash ë¡œë“œ ì™„ë£Œ'); window.BaseLoader.updateProgress(2, 'Lodash');"
            onerror="console.error('âŒ Lodash ë¡œë“œ ì‹¤íŒ¨'); window.BaseLoader.logError('Lodash', 'Load failed'); loadLibraryFallback('lodash', 'https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js');"></script>
    
    <!-- Fabric.js (Base í‘œì¤€ í•„ìˆ˜) -->
    <script src="<%= libPath %>/fabric.min.js" 
            onload="console.log('âœ… Fabric.js ë¡œë“œ ì™„ë£Œ'); window.BaseLoader.updateProgress(3, 'Fabric.js');"
            onerror="console.error('âŒ Fabric.js ë¡œë“œ ì‹¤íŒ¨'); window.BaseLoader.logError('Fabric.js', 'Load failed'); loadLibraryFallback('fabric', 'https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.6.0/fabric.min.js');"></script>
    
    <!-- 3. CreateJS ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ (Base í‘œì¤€ ê²½ë¡œ) -->
    
    <!-- PreloadJS -->
    <script src="<%= libPath %>/PreloadJS/lib/preloadjs-0.6.0.min.js" 
            onload="console.log('âœ… PreloadJS ë¡œë“œ ì™„ë£Œ'); window.BaseLoader.updateProgress(4, 'PreloadJS');"
            onerror="console.error('âŒ PreloadJS ë¡œë“œ ì‹¤íŒ¨'); window.BaseLoader.logError('PreloadJS', 'Load failed');"></script>
    
    <!-- EaselJS -->
    <script src="<%= libPath %>/EaselJS/lib/easeljs-0.8.0.min.js" 
            onload="console.log('âœ… EaselJS ë¡œë“œ ì™„ë£Œ'); window.BaseLoader.updateProgress(5, 'EaselJS');"
            onerror="console.error('âŒ EaselJS ë¡œë“œ ì‹¤íŒ¨'); window.BaseLoader.logError('EaselJS', 'Load failed');"></script>
    
    <!-- SoundJS -->
    <script src="<%= libPath %>/SoundJS/lib/soundjs-0.6.0.min.js" 
            onload="console.log('âœ… SoundJS ë¡œë“œ ì™„ë£Œ'); window.BaseLoader.updateProgress(6, 'SoundJS');"
            onerror="console.error('âŒ SoundJS ë¡œë“œ ì‹¤íŒ¨'); window.BaseLoader.logError('SoundJS', 'Load failed');"></script>
    
    <!-- 4. Entry-tool (Entry.jsë³´ë‹¤ ë¨¼ì € ë¡œë“œ - ìˆœì„œ ë³€ê²½!) -->
    <script src="https://playentry.org/lib/entry-tool/dist/entry-tool.js" 
            onload="console.log('âœ… Entry-tool ë¡œë“œ ì™„ë£Œ (ë¡œì»¬)'); window.BaseLoader.updateProgress(7, 'Entry-tool (CDN)');"
            onerror="console.error('âŒ Entry-tool ë¡œì»¬ ë¡œë“œ ì‹¤íŒ¨'); window.BaseLoader.logError('Entry-tool', 'Local load failed'); showError('Entry-tool ë¡œì»¬ íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'ë¡œì»¬ íŒŒì¼ ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”: https://playentry.org/lib/entry-tool/dist/entry-tool.js');"></script>
    
<!-- 5. EntryJS npm íŒ¨í‚¤ì§€ë“¤ (ì˜¬ë°”ë¥¸ íŒŒì¼ëª… ì‚¬ìš©) -->
    
    <!-- EntryVideoLegacy (npm) - ì˜¬ë°”ë¥¸ íŒŒì¼ëª…: index.js -->
    <script src="https://playentry.org/lib/entry-js/dist/legacy-video.min.js" 
            onload="console.log('âœ… EntryVideoLegacy ë¡œë“œ ì™„ë£Œ (CDN)'); window.BaseLoader.updateProgress(8, 'EntryVideoLegacy');"
            onerror="console.error('âŒ EntryVideoLegacy ë¡œë“œ ì‹¤íŒ¨'); window.BaseLoader.logError('EntryVideoLegacy', 'npm package not found'); showError('EntryVideoLegacy npm íŒ¨í‚¤ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'npm install @entrylabs/legacy-video ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜í•´ì£¼ì„¸ìš”.');"></script>
    
    <!-- EntryJS ë©”ì¸ ì—”ì§„ (npm) - ì˜¬ë°”ë¥¸ íŒŒì¼ëª…: entry.min.js -->
    <script src="https://playentry.org/lib/entry-js/dist/entry.min.js" 
            onload="console.log('âœ… Entry.js ë©”ì¸ ì—”ì§„ ë¡œë“œ ì™„ë£Œ (CDN)'); window.BaseLoader.updateProgress(9, 'Entry.js');"
            onerror="console.error('âŒ Entry.js ë¡œë“œ ì‹¤íŒ¨'); window.BaseLoader.logError('Entry.js', 'npm package not found'); showError('EntryJS ë©”ì¸ ì—”ì§„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'npm install @entrylabs/entry ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜í•´ì£¼ì„¸ìš”.');"></script>    
    <!-- 6. ë¼ì´ë¸ŒëŸ¬ë¦¬ Fallback ë° ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // CDN Fallback í•¨ìˆ˜ë“¤
        function loadLibraryFallback(name, url) {
            console.log(`ğŸ”„ ${name} CDN fallback ì‹œë„: ${url}`);
            
            const script = document.createElement('script');
            script.src = url;
            script.onload = () => {
                console.log(`âœ… ${name} CDN fallback ì„±ê³µ`);
                window.BaseLoader.updateProgress(window.BaseLoader.progress + 0.5, `${name} (CDN Fallback)`);
            };
            script.onerror = () => {
                console.error(`âŒ ${name} CDN fallback ì‹¤íŒ¨`);
                window.BaseLoader.logError(name, 'CDN fallback failed');
            };
            document.head.appendChild(script);
        }
        
        function loadEntryToolLocal() {
            const script = document.createElement('script');
            script.src = 'https://playentry.org/lib/entry-tool/dist/entry-tool.js';
            script.onload = () => {
                console.log('âœ… Entry-tool ë¡œë“œ ì™„ë£Œ (ë¡œì»¬)');
                window.BaseLoader.updateProgress(9, 'Entry-tool (CDN)');
            };
            script.onerror = () => {
                console.error('âŒ Entry-tool ë¡œì»¬ ë¡œë“œ ì‹¤íŒ¨');
                window.BaseLoader.logError('Entry-tool', 'Local and CDN failed');
                showError('Entry-toolì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'CDNê³¼ ë¡œì»¬ ëª¨ë‘ì—ì„œ Entry-tool ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            };
            document.head.appendChild(script);
        }
        
        function showError(message, details) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'flex';
            document.getElementById('error-message').textContent = message;
            
            if (details) {
                document.getElementById('error-details').style.display = 'block';
                document.getElementById('error-details').textContent = details;
            }
        }
        
        // ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì™„ë£Œ ì²´í¬
        function checkLibraryCompletion() {
            const status = window.BaseLoader.getStatus();
            
            if (status.errors.length > 0) {
                console.warn('âš ï¸ ì¼ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', status.errors);
            }
            
            if (status.progress >= 9) { // Entry-toolê¹Œì§€ ë¡œë“œ ì™„ë£Œ
                console.log('ğŸ“š Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì™„ë£Œ, EntryJS ì´ˆê¸°í™” ì‹œì‘...');
                setTimeout(initializeEntryJS, 500);
            }
        }
        
        // ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì™„ë£Œ ê°ì§€ (í´ë§)
        let checkInterval = setInterval(() => {
            const status = window.BaseLoader.getStatus();
            if (status.progress >= 9 || status.errors.length >= 3) {
                clearInterval(checkInterval);
                checkLibraryCompletion();
            }
        }, 100);
        
        // íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ (10ì´ˆ)
        setTimeout(() => {
            const status = window.BaseLoader.getStatus();
            if (status.progress < 9) {
                clearInterval(checkInterval);
                console.error('âŒ Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ íƒ€ì„ì•„ì›ƒ');
                showError(
                    'Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.',
                    `ë¡œë“œëœ ë¼ì´ë¸ŒëŸ¬ë¦¬: ${status.loadedLibs.join(', ')}\n\nì˜¤ë¥˜: ${status.errors.map(e => e.lib).join(', ')}`
                );
            }
        }, 10000);
        
        // EntryJS Base í‘œì¤€ ì´ˆê¸°í™” í•¨ìˆ˜
        async function initializeEntryJS() {
            try {
                console.log('ğŸ¯ EntryJS Base í‘œì¤€ ì´ˆê¸°í™” ì‹œì‘...');
                window.BaseLoader.updateProgress(10, 'EntryJS ì´ˆê¸°í™”');
                
                // í•„ìˆ˜ ê°ì²´ í™•ì¸
                if (typeof Entry === 'undefined') {
                    throw new Error('Entry ê°ì²´ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. @entrylabs/entry íŒ¨í‚¤ì§€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
                
                if (typeof Entry.init !== 'function') {
                    throw new Error('Entry.init í•¨ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤. EntryJS íŒ¨í‚¤ì§€ ë²„ì „ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
                
                if (typeof EntryVideoLegacy === 'undefined') {
                    console.warn('âš ï¸ EntryVideoLegacyê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ. ë¹„ë””ì˜¤ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                }
                
                // Base í‘œì¤€ ì´ˆê¸°í™” ì˜µì…˜
                const initOptions = {
                    type: 'workspace',
                    libDir: '<%= libPath %>',                                    // Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²½ë¡œ
                    entryDir: '<%= npmPath %>/@entrylabs/entry/images',          // Entry ì´ë¯¸ì§€ ë¦¬ì†ŒìŠ¤
                    defaultDir: '<%= npmPath %>/@entrylabs/entry',               // ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ê²½ë¡œ
                    soundDir: 'sounds/',                                         // ì‚¬ìš´ë“œ ê²½ë¡œ
                    baseUrl: '<%= baseUrl %>',                                   // API ê¸°ë³¸ URL
                    
                    // ì‚¬ìš©ì ì •ë³´ (3000ë²ˆ ì„œë²„ì—ì„œ ì „ë‹¬)
                    userID: '<%= userID %>',
                    userRole: '<%= role %>',
                    
                    // Base í‘œì¤€ ê¸°ëŠ¥ í™œì„±í™” ì„¤ì • (ì „ì²´ í™œì„±í™”)
                    objectAddable: true,
                    objectEditable: true,
                    objectDeletable: true,
                    soundEditable: true,
                    pictureEditable: true,
                    sceneEditable: true,
                    functionEnable: true,
                    messageEnable: true,
                    variableEnable: true,
                    listEnable: true,
                    aiLearningEnable: true,
                    textCodingEnable: true,
                    hardwareEnable: true,
                    expansionDisable: false,          // í™•ì¥ë¸”ë¡ ì‚¬ìš© ê°€ëŠ¥
                    aiUtilizeDisable: false,          // AI ë¸”ë¡ ì‚¬ìš© ê°€ëŠ¥
                    blockSaveImageEnable: true,       // ë¸”ë¡ ì´ë¯¸ì§€ ì €ì¥ ê°€ëŠ¥
                    
                    // Base í‘œì¤€ í°íŠ¸ ì„¤ì •
                    fonts: [
                        {
                            name: 'Noto Sans KR',
                            url: 'https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap'
                        }
                    ]
                };
                
                console.log('ğŸ¯ Base í‘œì¤€ EntryJS ì´ˆê¸°í™” ì˜µì…˜:', {
                    userID: '<%= userID %>',
                    role: '<%= role %>',
                    project: '<%= project %>',
                    type: initOptions.type,
                    paths: {
                        lib: initOptions.libDir,
                        entry: initOptions.entryDir,
                        default: initOptions.defaultDir
                    }
                });
                
                // EntryJS ì´ˆê¸°í™” ì‹¤í–‰
                Entry.init(document.getElementById('workspace'), initOptions);
                window.BaseLoader.updateProgress(11, 'EntryJS ì›Œí¬ìŠ¤í˜ì´ìŠ¤');
                
                // Entry-tool íŒì—… ì‹œìŠ¤í…œ ì´ˆê¸°í™” (Base í‘œì¤€)
                if (window.EntryTool && window.EntryTool.Popup) {
                    console.log('ğŸ­ Entry-tool Base í‘œì¤€ íŒì—… ì‹œìŠ¤í…œ ì´ˆê¸°í™”...');
                    
                    const popup = new EntryTool.Popup({
                        container: document.body,
                        theme: 'entry',
                        isShow: false
                    });
                    
                    // Base í‘œì¤€ íŒì—… ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
                    setupBasePopupHandlers(popup);
                    
                    console.log('âœ… Entry-tool Base í‘œì¤€ íŒì—… ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
                } else {
                    console.warn('âš ï¸ Entry-toolì´ ë¡œë“œë˜ì§€ ì•ŠìŒ. íŒì—… ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤.');
                }
                
                // Base ëª¨ë“ˆ ì‹œìŠ¤í…œ ë¡œë“œ (ê¸°ì¡´ êµ¬ì¡° í™œìš©)
                try {
                    await loadBaseModules();
                    window.BaseLoader.updateProgress(12, 'Base ëª¨ë“ˆ ì‹œìŠ¤í…œ');
                } catch (error) {
                    console.warn('âš ï¸ Base ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨:', error.message);
                    window.BaseLoader.updateProgress(12, 'Base ëª¨ë“ˆ (ì¼ë¶€ ì‹¤íŒ¨)');
                }
                
                // í”„ë¡œì íŠ¸ ë¡œë“œ (URL íŒŒë¼ë¯¸í„° ê¸°ë°˜)
                const project = '<%= project %>';
                if (project && project !== 'new') {
                    console.log('ğŸ“ Base í‘œì¤€ í”„ë¡œì íŠ¸ ë¡œë“œ ì‹œë„:', project);
                    await loadProjectFromServer(project);
                } else {
                    console.log('ğŸ“„ Base í‘œì¤€ ìƒˆ í”„ë¡œì íŠ¸ ì‹œì‘');
                    Entry.loadProject();
                }
                
                // ë¡œë”© í™”ë©´ ì œê±° ë° ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í‘œì‹œ
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('workspace').style.display = 'block';
                    
                    console.log('âœ… EntryJS Base í‘œì¤€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ!');
                    
                    // ì´ˆê¸°í™” ì™„ë£Œ ì´ë²¤íŠ¸ ë°œìƒ (Base í‘œì¤€)
                    if (typeof Entry.dispatchEvent === 'function') {
                        Entry.dispatchEvent('workspaceReady', {
                            userID: '<%= userID %>',
                            role: '<%= role %>',
                            baseStructure: 'enabled',
                            version: 'base-standard',
                            timestamp: new Date().toISOString()
                        });
                    }
                    
                    // ì „ì—­ ë””ë²„ê¹… ê°ì²´ ë“±ë¡
                    window.EntryBaseDebug = createBaseDebugTools();
                    
                }, 500);
                
            } catch (error) {
                console.error('âŒ EntryJS Base í‘œì¤€ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                
                showError(
                    'EntryJS Base í‘œì¤€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
                    `ì˜¤ë¥˜ ìƒì„¸: ${error.message}\n\nìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤:\n${error.stack}`
                );
            }
        }
        
        // Base í‘œì¤€ íŒì—… ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜
        function setupBasePopupHandlers(popup) {
            // ì˜¤ë¸Œì íŠ¸(ìŠ¤í”„ë¼ì´íŠ¸) ì¶”ê°€ íŒì—…
            Entry.addEventListener('openSpriteManager', () => {
                console.log('ğŸ­ Base í‘œì¤€ ìŠ¤í”„ë¼ì´íŠ¸ ë§¤ë‹ˆì € ì—´ê¸°');
                popup.show({ type: 'sprite' });
            });
            
            // ëª¨ì–‘(ê·¸ë¦¼) ì¶”ê°€ íŒì—…
            Entry.addEventListener('openPictureManager', () => {
                console.log('ğŸ–¼ï¸ Base í‘œì¤€ ëª¨ì–‘ ë§¤ë‹ˆì € ì—´ê¸°');
                popup.show({ type: 'picture' });
            });
            
            // ì†Œë¦¬ ì¶”ê°€ íŒì—…
            Entry.addEventListener('openSoundManager', () => {
                console.log('ğŸ”Š Base í‘œì¤€ ì‚¬ìš´ë“œ ë§¤ë‹ˆì € ì—´ê¸°');
                popup.show({ type: 'sound' });
            });
            
            // í™•ì¥ë¸”ë¡ íŒì—…
            Entry.addEventListener('openExpansionBlockManager', () => {
                console.log('ğŸ§© Base í‘œì¤€ í™•ì¥ë¸”ë¡ ë§¤ë‹ˆì € ì—´ê¸°');
                popup.show({ type: 'expansion' });
            });
            
            // ì¸ê³µì§€ëŠ¥ ë¸”ë¡ íŒì—…
            Entry.addEventListener('openAIUtilizeBlockManager', () => {
                console.log('ğŸ¤– Base í‘œì¤€ AI ë¸”ë¡ ë§¤ë‹ˆì € ì—´ê¸°');
                popup.show({ type: 'aiUtilize' });
            });
            
            // í•˜ë“œì›¨ì–´ ì—°ê²° íŒì—…
            Entry.addEventListener('openHardwareLiteBlockManager', () => {
                console.log('ğŸ”Œ Base í‘œì¤€ í•˜ë“œì›¨ì–´ ì—°ê²° ë§¤ë‹ˆì € ì—´ê¸°');
                popup.show({ type: 'hardwareLite' });
            });
            
            // ëª¨ì–‘ ê°€ì ¸ì˜¤ê¸° íŒì—…
            Entry.addEventListener('openPictureImport', () => {
                console.log('ğŸ“¥ Base í‘œì¤€ ëª¨ì–‘ ê°€ì ¸ì˜¤ê¸° ë§¤ë‹ˆì € ì—´ê¸°');
                popup.show({ type: 'paint' });
            });
        }
        
        // Base ëª¨ë“ˆ ì‹œìŠ¤í…œ ë¡œë“œ (ê¸°ì¡´ êµ¬ì¡° í™œìš©)
        async function loadBaseModules() {
            try {
                console.log('ğŸ“¦ Base í‘œì¤€ ëª¨ë“ˆ ì‹œìŠ¤í…œ ë¡œë“œ ì‹œì‘...');
                
                // Base ëª¨ë“ˆë“¤ ë™ì  ë¡œë“œ (ê¸°ì¡´ êµ¬ì¡° í™œìš©)
                const modules = [
                    '<%= jsPath %>/app.mjs',
                    '<%= jsPath %>/event.mjs',
                    '<%= jsPath %>/util.mjs'
                ];
                
                const loadPromises = modules.map(async (moduleUrl) => {
                    try {
                        const module = await import(moduleUrl);
                        console.log(`âœ… Base ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ: ${moduleUrl}`);
                        return { url: moduleUrl, success: true, module };
                    } catch (error) {
                        console.warn(`âš ï¸ Base ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨: ${moduleUrl}`, error.message);
                        return { url: moduleUrl, success: false, error: error.message };
                    }
                });
                
                const results = await Promise.all(loadPromises);
                const successCount = results.filter(r => r.success).length;
                
                console.log(`ğŸ“Š Base ëª¨ë“ˆ ë¡œë“œ ê²°ê³¼: ${successCount}/${modules.length} ì„±ê³µ`);
                
                return results;
                
            } catch (error) {
                console.warn('âš ï¸ Base ëª¨ë“ˆ ì‹œìŠ¤í…œ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error.message);
                throw error;
            }
        }
        
        // ì„œë²„ í”„ë¡œì íŠ¸ ë¡œë“œ í•¨ìˆ˜ (3000ë²ˆ ì„œë²„ API ì—°ë™)
        async function loadProjectFromServer(projectFile) {
            try {
                console.log('ğŸ“ Base í‘œì¤€ ì„œë²„ì—ì„œ í”„ë¡œì íŠ¸ ë¡œë“œ:', projectFile);
                
                const response = await fetch(`/api/load-project?file=${encodeURIComponent(projectFile)}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const projectData = await response.json();
                    
                    if (projectData && typeof projectData === 'object') {
                        Entry.loadProject(projectData);
                        console.log('âœ… Base í‘œì¤€ í”„ë¡œì íŠ¸ ë¡œë“œ ì™„ë£Œ:', projectFile);
                    } else {
                        throw new Error('í”„ë¡œì íŠ¸ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                } else {
                    const errorText = await response.text();
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜ (${response.status}): ${errorText}`);
                }
                
            } catch (error) {
                console.error('âŒ Base í‘œì¤€ í”„ë¡œì íŠ¸ ë¡œë“œ ì˜¤ë¥˜:', error);
                console.log('ğŸ“„ ìƒˆ í”„ë¡œì íŠ¸ë¡œ ëŒ€ì²´');
                Entry.loadProject(); // ìƒˆ í”„ë¡œì íŠ¸ë¡œ ëŒ€ì²´
            }
        }
        
        // Base í‘œì¤€ ë””ë²„ê¹… ë„êµ¬ ìƒì„±
        function createBaseDebugTools() {
            return {
                // í˜„ì¬ Base í‘œì¤€ ìƒíƒœ í™•ì¸
                getStatus: () => ({
                    baseStructure: 'enabled',
                    entryLoaded: typeof Entry !== 'undefined',
                    entryInitialized: typeof Entry.init === 'function',
                    entryToolLoaded: typeof EntryTool !== 'undefined',
                    legacyVideoLoaded: typeof EntryVideoLegacy !== 'undefined',
                    loaderStatus: window.BaseLoader.getStatus(),
                    userID: '<%= userID %>',
                    role: '<%= role %>',
                    project: '<%= project %>',
                    paths: {
                        lib: '<%= libPath %>',
                        css: '<%= cssPath %>',
                        js: '<%= jsPath %>',
                        npm: '<%= npmPath %>'
                    },
                    timestamp: new Date().toISOString()
                }),
                
                // Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒíƒœ í™•ì¸
                checkLibraries: async () => {
                    try {
                        const response = await fetch('/api/check-libs');
                        return await response.json();
                    } catch (error) {
                        console.error('Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                        return null;
                    }
                },
                
                // ê°•ì œ ì¬ë¡œë“œ
                forceReload: () => {
                    console.log('ğŸ”„ Base í‘œì¤€ EntryJS ê°•ì œ ì¬ë¡œë“œ...');
                    location.reload();
                },
                
                // Base í‘œì¤€ í”„ë¡œì íŠ¸ ë‚´ë³´ë‚´ê¸°
                exportProject: () => {
                    if (typeof Entry !== 'undefined' && typeof Entry.exportProject === 'function') {
                        return Entry.exportProject();
                    } else {
                        console.error('Entry.exportProject í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        return null;
                    }
                },
                
                // Base ë¡œë” ìƒíƒœ
                getLoaderStatus: () => window.BaseLoader.getStatus(),
                
                // Base í‘œì¤€ í™˜ê²½ ì •ë³´
                getEnvironment: () => ({
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    platform: navigator.platform,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    screen: {
                        width: screen.width,
                        height: screen.height,
                        colorDepth: screen.colorDepth
                    },
                    window: {
                        width: window.innerWidth,
                        height: window.innerHeight
                    }
                })
            };
        }
        
        // ì „ì—­ ì˜¤ë¥˜ í•¸ë“¤ëŸ¬ (Base í‘œì¤€)
        window.addEventListener('error', (event) => {
            console.error('ğŸ’¥ Base í‘œì¤€ ì „ì—­ JavaScript ì˜¤ë¥˜:', {
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                error: event.error
            });
            
            // EntryJS ì´ˆê¸°í™” ê´€ë ¨ ì˜¤ë¥˜ì¸ ê²½ìš° ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
            if (event.message.includes('Entry') || event.message.includes('EntryTool')) {
                if (document.getElementById('workspace').style.display === 'none') {
                    showError(
                        'EntryJS Base í‘œì¤€ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                        `ì˜¤ë¥˜: ${event.message}\níŒŒì¼: ${event.filename}:${event.lineno}`
                    );
                }
            }
        });
        
        // Promise ê±°ë¶€ í•¸ë“¤ëŸ¬
        window.addEventListener('unhandledrejection', (event) => {
            console.error('ğŸ’¥ Base í‘œì¤€ ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', event.reason);
            
            if (document.getElementById('workspace').style.display === 'none') {
                showError(
                    'Base í‘œì¤€ ë¡œë”© ì¤‘ ë¹„ë™ê¸° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                    `Promise ê±°ë¶€: ${event.reason.message || event.reason}`
                );
            }
        });
        
        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬ (Base í‘œì¤€)
        window.addEventListener('beforeunload', () => {
            console.log('ğŸ”„ EntryJS Base í‘œì¤€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì¢…ë£Œ ì¤‘...');
            
            // Entry ì´ë²¤íŠ¸ ì •ë¦¬
            if (typeof Entry !== 'undefined' && typeof Entry.removeAllEventListener === 'function') {
                const events = [
                    'openSpriteManager', 'openPictureManager', 'openSoundManager', 
                    'openExpansionBlockManager', 'openAIUtilizeBlockManager',
                    'openHardwareLiteBlockManager', 'openPictureImport'
                ];
                
                events.forEach(eventName => {
                    Entry.removeAllEventListener(eventName);
                });
            }
        });
        
        console.log('ğŸ¯ EntryJS Base í‘œì¤€ í…œí”Œë¦¿ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
    </script>
    
    <!-- ê°œë°œì ë„êµ¬ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ) -->
    <% if (environment !== 'production') { %>
    <script>
        console.log('ğŸ› ï¸ Base í‘œì¤€ ê°œë°œ ëª¨ë“œ: EntryBaseDebug ê°ì²´ê°€ ë“±ë¡ë©ë‹ˆë‹¤.');
        console.log('Base í‘œì¤€ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:');
        console.log('- EntryBaseDebug.getStatus(): Base í‘œì¤€ í˜„ì¬ ìƒíƒœ í™•ì¸');
        console.log('- EntryBaseDebug.checkLibraries(): Base í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒíƒœ í™•ì¸');
        console.log('- EntryBaseDebug.forceReload(): ê°•ì œ ì¬ë¡œë“œ');
        console.log('- EntryBaseDebug.exportProject(): í”„ë¡œì íŠ¸ ë‚´ë³´ë‚´ê¸°');
        console.log('- EntryBaseDebug.getLoaderStatus(): Base ë¡œë” ìƒíƒœ');
        console.log('- EntryBaseDebug.getEnvironment(): í™˜ê²½ ì •ë³´');
        
        // Base í‘œì¤€ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
        if (window.performance && window.performance.mark) {
            window.performance.mark('entryjs-base-template-start');
            
            window.addEventListener('load', () => {
                window.performance.mark('entryjs-base-template-end');
                window.performance.measure('entryjs-base-template-load', 'entryjs-base-template-start', 'entryjs-base-template-end');
                
                const measure = window.performance.getEntriesByName('entryjs-base-template-load')[0];
                console.log(`â±ï¸ Base í‘œì¤€ í…œí”Œë¦¿ ë¡œë“œ ì‹œê°„: ${measure.duration.toFixed(2)}ms`);
            });
        }
    </script>
    <% } %>
</body>
</html>